var No=Object.defineProperty;var Fo=(i,t,e)=>t in i?No(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var $=(i,t,e)=>Fo(i,typeof t!="symbol"?t+"":t,e);var Er=(i=>(i[i.DEBUG=0]="DEBUG",i[i.INFO=1]="INFO",i[i.WARN=2]="WARN",i[i.ERROR=3]="ERROR",i))(Er||{});class Sn{constructor(t="Worker",e=1){$(this,"logLevel",1);$(this,"logs",[]);this.context=t,this.logLevel=e}setLevel(t){this.logLevel=t}log(t,e,n){if(t<this.logLevel)return;const r={timestamp:new Date().toISOString(),level:t,context:this.context,message:e,details:n};this.logs.push(r);const s=`[${this.context}] ${e}`;switch(t){case 0:console.debug(s,n||"");break;case 1:console.log(s,n||"");break;case 2:console.warn(s,n||"");break;case 3:console.error(s,n||"");break}}debug(t,e){this.log(0,t,e)}info(t,e){this.log(1,t,e)}warn(t,e){this.log(2,t,e)}error(t,e){this.log(3,t,e)}getLogs(){return[...this.logs]}clearLogs(){this.logs=[]}createChildLogger(t){return new Sn(`${this.context}:${t}`,this.logLevel)}}class Ze extends Error{constructor(e){super(e.message);$(this,"code");$(this,"originalError");$(this,"context");$(this,"details");this.name="WorkerError",this.code=e.code,this.originalError=e.originalError,this.context=e.context,this.details=e.details}toWorkerMessage(e){return{type:"error",req_id:e,message:`${this.code}: ${this.message}${this.details?` - ${JSON.stringify(this.details)}`:""}`}}}class Lo{constructor(t){this.logger=t}createError(t){var n;const e=new Ze(t);return this.logger.error(`${e.code}: ${e.message}`,{context:e.context,details:e.details,originalError:(n=e.originalError)==null?void 0:n.message}),e}handleError(t,e,n="E3001"){if(t instanceof Ze)return t;const r=t instanceof Error?t.message:String(t);return this.createError({code:n,message:r,originalError:t instanceof Error?t:void 0,context:e})}postError(t,e,n){const r=e instanceof Ze?e:this.createError(e);n(r.toWorkerMessage(t))}}const Q={databaseInitialization:(i,t)=>({code:"E3001",message:`DuckDB初期化エラー: ${i}`,originalError:t,context:"DB_INIT"}),dataRegistration:(i,t)=>({code:"E3002",message:`Arrowデータ登録エラー: ${i}`,originalError:t,context:"DATA_REGISTRATION"}),astToSqlConversion:(i,t)=>({code:"E1002",message:`戦略のSQL変換エラー: ${i}`,details:t,context:"AST_TO_SQL"}),sqlExecution:(i,t)=>({code:"E3001",message:`SQLクエリ実行エラー: ${i}`,originalError:t,context:"SQL_EXECUTION"}),resultProcessing:(i,t)=>({code:"E3001",message:`結果データ処理エラー: ${i}`,originalError:t,context:"RESULT_PROCESSING"}),missingInput:i=>({code:"E3001",message:`必須入力が不足しています: ${i}`,context:"INPUT_VALIDATION"})},ne={duckdb:{queryConfig:{castBigIntToDouble:!0},connectionTimeout:5e3,maxRetries:3},arrow:{maxTestRows:100,chunkSize:1e3,supportedMethods:["manual_table_creation","insertArrowFromIPCStream","file_registration_read_arrow","file_registration_arrow_scan","file_registration_parquet"]},timeouts:{operationTimeout:3e4,workerResponseTimeout:3e4},logging:{enableDetailedLogs:!0,logArrowBuffer:!0,maxLogEntries:1e3}};function Uo(i){var t;return{...ne,...i,duckdb:{...ne.duckdb,...i==null?void 0:i.duckdb,queryConfig:{...ne.duckdb.queryConfig,...(t=i==null?void 0:i.duckdb)==null?void 0:t.queryConfig}},arrow:{...ne.arrow,...i==null?void 0:i.arrow},timeouts:{...ne.timeouts,...i==null?void 0:i.timeouts},logging:{...ne.logging,...i==null?void 0:i.logging}}}function tu(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(i);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(i,n[r])&&(e[n[r]]=i[n[r]]);return e}function E(i,t,e,n){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(d){try{u(n.next(d))}catch(h){o(h)}}function c(d){try{u(n.throw(d))}catch(h){o(h)}}function u(d){d.done?s(d.value):r(d.value).then(a,c)}u((n=n.apply(i,t||[])).next())})}function Jn(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],n=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(i){return this instanceof A?(this.v=i,this):new A(i)}function Ot(i,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(i,t||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(B){return function(H){return Promise.resolve(H).then(B,h)}}function a(B,H){n[B]&&(r[B]=function(ut){return new Promise(function(Yi,zt){s.push([B,ut,Yi,zt])>1||c(B,ut)})},H&&(r[B]=H(r[B])))}function c(B,H){try{u(n[B](H))}catch(ut){F(s[0][3],ut)}}function u(B){B.value instanceof A?Promise.resolve(B.value.v).then(d,h):F(s[0][2],B)}function d(B){c("next",B)}function h(B){c("throw",B)}function F(B,H){B(H),s.shift(),s.length&&c(s[0][0],s[0][1])}}function ti(i){var t,e;return t={},n("next"),n("throw",function(r){throw r}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(r,s){t[r]=i[r]?function(o){return(e=!e)?{value:A(i[r](o)),done:!1}:s?s(o):o}:s}}function Zt(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=i[Symbol.asyncIterator],e;return t?t.call(i):(i=typeof Jn=="function"?Jn(i):i[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(s){e[s]=i[s]&&function(o){return new Promise(function(a,c){o=i[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}const Mo=new TextDecoder("utf-8"),an=i=>Mo.decode(i),Co=new TextEncoder,In=i=>Co.encode(i),xo=i=>typeof i=="number",Br=i=>typeof i=="boolean",Y=i=>typeof i=="function",st=i=>i!=null&&Object(i)===i,te=i=>st(i)&&Y(i.then),qe=i=>st(i)&&Y(i[Symbol.iterator]),Oe=i=>st(i)&&Y(i[Symbol.asyncIterator]),cn=i=>st(i)&&st(i.schema),Ar=i=>st(i)&&"done"in i&&"value"in i,Or=i=>st(i)&&Y(i.stat)&&xo(i.fd),Dr=i=>st(i)&&vn(i.body),$i=i=>"_getDOMStream"in i&&"_getNodeStream"in i,ko=i=>st(i)&&Y(i.abort)&&Y(i.getWriter)&&!$i(i),vn=i=>st(i)&&Y(i.cancel)&&Y(i.getReader)&&!$i(i),Po=i=>st(i)&&Y(i.end)&&Y(i.write)&&Br(i.writable)&&!$i(i),Tr=i=>st(i)&&Y(i.read)&&Y(i.pipe)&&Br(i.readable)&&!$i(i),Vo=i=>st(i)&&Y(i.clear)&&Y(i.bytes)&&Y(i.position)&&Y(i.setPosition)&&Y(i.capacity)&&Y(i.getBufferIdentifier)&&Y(i.createLong),En=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function zo(i){const t=i[0]?[i[0]]:[];let e,n,r,s;for(let o,a,c=0,u=0,d=i.length;++c<d;){if(o=t[u],a=i[c],!o||!a||o.buffer!==a.buffer||a.byteOffset<o.byteOffset){a&&(t[++u]=a);continue}if({byteOffset:e,byteLength:r}=o,{byteOffset:n,byteLength:s}=a,e+r<n||n+s<e){a&&(t[++u]=a);continue}t[u]=new Uint8Array(o.buffer,e,n-e+s)}return t}function Kn(i,t,e=0,n=t.byteLength){const r=i.byteLength,s=new Uint8Array(i.buffer,i.byteOffset,r),o=new Uint8Array(t.buffer,t.byteOffset,Math.min(n,r));return s.set(o,e),i}function Tt(i,t){const e=zo(i),n=e.reduce((d,h)=>d+h.byteLength,0);let r,s,o,a=0,c=-1;const u=Math.min(t||Number.POSITIVE_INFINITY,n);for(const d=e.length;++c<d;){if(r=e[c],s=r.subarray(0,Math.min(r.length,u-a)),u<=a+s.length){s.length<r.length?e[c]=r.subarray(s.length):s.length===r.length&&c++,o?Kn(o,s,a):o=s;break}Kn(o||(o=new Uint8Array(u)),s,a),a+=s.length}return[o||new Uint8Array(0),e.slice(c),n-(o?o.byteLength:0)]}function k(i,t){let e=Ar(t)?t.value:t;return e instanceof i?i===Uint8Array?new i(e.buffer,e.byteOffset,e.byteLength):e:e?(typeof e=="string"&&(e=In(e)),e instanceof ArrayBuffer?new i(e):e instanceof En?new i(e):Vo(e)?k(i,e.bytes()):ArrayBuffer.isView(e)?e.byteLength<=0?new i(0):new i(e.buffer,e.byteOffset,e.byteLength/i.BYTES_PER_ELEMENT):i.from(e)):new i(0)}const Te=i=>k(Int32Array,i),Xn=i=>k(BigInt64Array,i),T=i=>k(Uint8Array,i),ln=i=>(i.next(),i);function*$o(i,t){const e=function*(r){yield r},n=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof En?e(t):qe(t)?t:e(t);return yield*ln(function*(r){let s=null;do s=r.next(yield k(i,s));while(!s.done)}(n[Symbol.iterator]())),new i}const jo=i=>$o(Uint8Array,i);function Rr(i,t){return Ot(this,arguments,function*(){if(te(t))return yield A(yield A(yield*ti(Zt(Rr(i,yield A(t))))));const n=function(o){return Ot(this,arguments,function*(){yield yield A(yield A(o))})},r=function(o){return Ot(this,arguments,function*(){yield A(yield*ti(Zt(ln(function*(a){let c=null;do c=a.next(yield c==null?void 0:c.value);while(!c.done)}(o[Symbol.iterator]())))))})},s=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof En?n(t):qe(t)?r(t):Oe(t)?t:n(t);return yield A(yield*ti(Zt(ln(function(o){return Ot(this,arguments,function*(){let a=null;do a=yield A(o.next(yield yield A(k(i,a))));while(!a.done)})}(s[Symbol.asyncIterator]()))))),yield A(new i)})}const Wo=i=>Rr(Uint8Array,i);function Nr(i,t,e){if(i!==0){e=e.slice(0,t);for(let n=-1,r=e.length;++n<r;)e[n]+=i}return e.subarray(0,t)}function qo(i,t){let e=0;const n=i.length;if(n!==t.length)return!1;if(n>0)do if(i[e]!==t[e])return!1;while(++e<n);return!0}var ht={fromIterable(i){return Je(Ho(i))},fromAsyncIterable(i){return Je(Yo(i))},fromDOMStream(i){return Je(Go(i))},fromNodeStream(i){return Je(Jo(i))},toDOMStream(i,t){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(i,t){throw new Error('"toNodeStream" not available in this environment')}};const Je=i=>(i.next(),i);function*Ho(i){let t,e=!1,n=[],r,s,o,a=0;function c(){return s==="peek"?Tt(n,o)[0]:([r,n,a]=Tt(n,o),r)}({cmd:s,size:o}=(yield null)||{cmd:"read",size:0});const u=jo(i)[Symbol.iterator]();try{do if({done:t,value:r}=Number.isNaN(o-a)?u.next():u.next(o-a),!t&&r.byteLength>0&&(n.push(r),a+=r.byteLength),t||o<=a)do({cmd:s,size:o}=yield c());while(o<a);while(!t)}catch(d){(e=!0)&&typeof u.throw=="function"&&u.throw(d)}finally{e===!1&&typeof u.return=="function"&&u.return(null)}return null}function Yo(i){return Ot(this,arguments,function*(){let e,n=!1,r=[],s,o,a,c=0;function u(){return o==="peek"?Tt(r,a)[0]:([s,r,c]=Tt(r,a),s)}({cmd:o,size:a}=(yield yield A(null))||{cmd:"read",size:0});const d=Wo(i)[Symbol.asyncIterator]();try{do if({done:e,value:s}=Number.isNaN(a-c)?yield A(d.next()):yield A(d.next(a-c)),!e&&s.byteLength>0&&(r.push(s),c+=s.byteLength),e||a<=c)do({cmd:o,size:a}=yield yield A(u()));while(a<c);while(!e)}catch(h){(n=!0)&&typeof d.throw=="function"&&(yield A(d.throw(h)))}finally{n===!1&&typeof d.return=="function"&&(yield A(d.return(new Uint8Array(0))))}return yield A(null)})}function Go(i){return Ot(this,arguments,function*(){let e=!1,n=!1,r=[],s,o,a,c=0;function u(){return o==="peek"?Tt(r,a)[0]:([s,r,c]=Tt(r,a),s)}({cmd:o,size:a}=(yield yield A(null))||{cmd:"read",size:0});const d=new Qo(i);try{do if({done:e,value:s}=Number.isNaN(a-c)?yield A(d.read()):yield A(d.read(a-c)),!e&&s.byteLength>0&&(r.push(T(s)),c+=s.byteLength),e||a<=c)do({cmd:o,size:a}=yield yield A(u()));while(a<c);while(!e)}catch(h){(n=!0)&&(yield A(d.cancel(h)))}finally{n===!1?yield A(d.cancel()):i.locked&&d.releaseLock()}return yield A(null)})}class Qo{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return E(this,void 0,void 0,function*(){const{reader:e,source:n}=this;e&&(yield e.cancel(t).catch(()=>{})),n&&n.locked&&this.releaseLock()})}read(t){return E(this,void 0,void 0,function*(){if(t===0)return{done:this.reader==null,value:new Uint8Array(0)};const e=yield this.reader.read();return!e.done&&(e.value=T(e)),e})}}const Gi=(i,t)=>{const e=r=>n([t,r]);let n;return[t,e,new Promise(r=>(n=r)&&i.once(t,e))]};function Jo(i){return Ot(this,arguments,function*(){const e=[];let n="error",r=!1,s=null,o,a,c=0,u=[],d;function h(){return o==="peek"?Tt(u,a)[0]:([d,u,c]=Tt(u,a),d)}if({cmd:o,size:a}=(yield yield A(null))||{cmd:"read",size:0},i.isTTY)return yield yield A(new Uint8Array(0)),yield A(null);try{e[0]=Gi(i,"end"),e[1]=Gi(i,"error");do{if(e[2]=Gi(i,"readable"),[n,s]=yield A(Promise.race(e.map(B=>B[2]))),n==="error")break;if((r=n==="end")||(Number.isFinite(a-c)?(d=T(i.read(a-c)),d.byteLength<a-c&&(d=T(i.read()))):d=T(i.read()),d.byteLength>0&&(u.push(d),c+=d.byteLength)),r||a<=c)do({cmd:o,size:a}=yield yield A(h()));while(a<c)}while(!r)}finally{yield A(F(e,n==="error"?s:null))}return yield A(null);function F(B,H){return d=u=null,new Promise((ut,Yi)=>{for(const[zt,Ro]of B)i.off(zt,Ro);try{const zt=i.destroy;zt&&zt.call(i,H),H=void 0}catch(zt){H=zt||H}finally{H!=null?Yi(H):ut()}})}})}var q;(function(i){i[i.V1=0]="V1",i[i.V2=1]="V2",i[i.V3=2]="V3",i[i.V4=3]="V4",i[i.V5=4]="V5"})(q||(q={}));var K;(function(i){i[i.Sparse=0]="Sparse",i[i.Dense=1]="Dense"})(K||(K={}));var J;(function(i){i[i.HALF=0]="HALF",i[i.SINGLE=1]="SINGLE",i[i.DOUBLE=2]="DOUBLE"})(J||(J={}));var gt;(function(i){i[i.DAY=0]="DAY",i[i.MILLISECOND=1]="MILLISECOND"})(gt||(gt={}));var _;(function(i){i[i.SECOND=0]="SECOND",i[i.MILLISECOND=1]="MILLISECOND",i[i.MICROSECOND=2]="MICROSECOND",i[i.NANOSECOND=3]="NANOSECOND"})(_||(_={}));var Rt;(function(i){i[i.YEAR_MONTH=0]="YEAR_MONTH",i[i.DAY_TIME=1]="DAY_TIME",i[i.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(Rt||(Rt={}));const Qi=2,Et=4,Ct=4,M=4,Wt=new Int32Array(2),Zn=new Float32Array(Wt.buffer),tr=new Float64Array(Wt.buffer),Ke=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var un;(function(i){i[i.UTF8_BYTES=1]="UTF8_BYTES",i[i.UTF16_STRING=2]="UTF16_STRING"})(un||(un={}));let Ie=class Fr{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new Fr(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Wt[0]=this.readInt32(t),Zn[0]}readFloat64(t){return Wt[Ke?0:1]=this.readInt32(t),Wt[Ke?1:0]=this.readInt32(t+4),tr[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){Zn[0]=e,this.writeInt32(t,Wt[0])}writeFloat64(t,e){tr[0]=e,this.writeInt32(t,Wt[Ke?0:1]),this.writeInt32(t+4,Wt[Ke?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Et+Ct)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<Ct;e++)t+=String.fromCharCode(this.readInt8(this.position_+Et+e));return t}__offset(t,e){const n=t-this.readInt32(t);return e<this.readInt16(n)?this.readInt16(n+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const n=this.readInt32(t);t+=Et;const r=this.bytes_.subarray(t,t+n);return e===un.UTF8_BYTES?r:this.text_decoder_.decode(r)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+Et}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=Ct)throw new Error("FlatBuffers: file identifier must be length "+Ct);for(let e=0;e<Ct;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+Et+e))return!1;return!0}createScalarList(t,e){const n=[];for(let r=0;r<e;++r){const s=t(r);s!==null&&n.push(s)}return n}createObjList(t,e){const n=[];for(let r=0;r<e;++r){const s=t(r);s!==null&&n.push(s.unpack())}return n}},Lr=class Ur{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let e;t?e=t:e=1024,this.bb=Ie.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const n=~(this.bb.capacity()-this.space+e)+1&t-1;for(;this.space<n+t+e;){const r=this.bb.capacity();this.bb=Ur.growByteBuffer(this.bb),this.space+=this.bb.capacity()-r}this.pad(n)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,n){(this.force_defaults||e!=n)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,n){(this.force_defaults||e!=n)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,n){(this.force_defaults||e!=n)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,n){(this.force_defaults||e!==n)&&(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,n){(this.force_defaults||e!=n)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,n){(this.force_defaults||e!=n)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,n){(this.force_defaults||e!=n)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,n){e!=n&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(e&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const n=e<<1,r=Ie.allocate(n);return r.setPosition(n-e),r.bytes().set(t.bytes(),n-e),r}addOffset(t){this.prep(Et,0),this.writeInt32(this.offset()-t+Et)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&this.vtable[e]==0;e--);const n=e+1;for(;e>=0;e--)this.addInt16(this.vtable[e]!=0?t-this.vtable[e]:0);const r=2;this.addInt16(t-this.object_start);const s=(n+r)*Qi;this.addInt16(s);let o=0;const a=this.space;t:for(e=0;e<this.vtables.length;e++){const c=this.bb.capacity()-this.vtables[e];if(s==this.bb.readInt16(c)){for(let u=Qi;u<s;u+=Qi)if(this.bb.readInt16(a+u)!=this.bb.readInt16(c+u))continue t;o=this.vtables[e];break}}return o?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,o-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,n){const r=n?M:0;if(e){const s=e;if(this.prep(this.minalign,Et+Ct+r),s.length!=Ct)throw new TypeError("FlatBuffers: file identifier must be length "+Ct);for(let o=Ct-1;o>=0;o--)this.writeInt8(s.charCodeAt(o))}this.prep(this.minalign,Et+r),this.addOffset(t),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const n=this.bb.capacity()-t,r=n-this.bb.readInt32(n);if(!(e<this.bb.readInt16(r)&&this.bb.readInt16(r+e)!=0))throw new TypeError("FlatBuffers: field "+e+" must be set")}startVector(t,e,n){this.notNested(),this.vector_num_elems=e,this.prep(Et,t*e),this.prep(n,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(t==null)return 0;let e;return t instanceof Uint8Array?e=t:e=this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector()}createByteVector(t){return t==null?0:(this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector())}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let n=0;n<t.length;++n){const r=t[n];if(r!==null)e.push(this.createObjectOffset(r));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}};var di;(function(i){i[i.BUFFER=0]="BUFFER"})(di||(di={}));var hi;(function(i){i[i.LZ4_FRAME=0]="LZ4_FRAME",i[i.ZSTD=1]="ZSTD"})(hi||(hi={}));class qt{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBodyCompression(t,e){return(e||new qt).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,e){return t.setPosition(t.position()+M),(e||new qt).__init(t.readInt32(t.position())+t.position(),t)}codec(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):hi.LZ4_FRAME}method(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):di.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,e){t.addFieldInt8(0,e,hi.LZ4_FRAME)}static addMethod(t,e){t.addFieldInt8(1,e,di.BUFFER)}static endBodyCompression(t){return t.endObject()}static createBodyCompression(t,e,n){return qt.startBodyCompression(t),qt.addCodec(t,e),qt.addMethod(t,n),qt.endBodyCompression(t)}}class Mr{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,e,n){return t.prep(8,16),t.writeInt64(BigInt(n??0)),t.writeInt64(BigInt(e??0)),t.offset()}}let Cr=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,e,n){return t.prep(8,16),t.writeInt64(BigInt(n??0)),t.writeInt64(BigInt(e??0)),t.offset()}},Lt=class dn{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRecordBatch(t,e){return(e||new dn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,e){return t.setPosition(t.position()+M),(e||new dn).__init(t.readInt32(t.position())+t.position(),t)}length(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}nodes(t,e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new Cr).__init(this.bb.__vector(this.bb_pos+n)+t*16,this.bb):null}nodesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new Mr).__init(this.bb.__vector(this.bb_pos+n)+t*16,this.bb):null}buffersLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){const e=this.bb.__offset(this.bb_pos,10);return e?(t||new qt).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addNodes(t,e){t.addFieldOffset(1,e,0)}static startNodesVector(t,e){t.startVector(16,e,8)}static addBuffers(t,e){t.addFieldOffset(2,e,0)}static startBuffersVector(t,e){t.startVector(16,e,8)}static addCompression(t,e){t.addFieldOffset(3,e,0)}static endRecordBatch(t){return t.endObject()}},se=class hn{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryBatch(t,e){return(e||new hn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,e){return t.setPosition(t.position()+M),(e||new hn).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}data(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new Lt).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isDelta(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startDictionaryBatch(t){t.startObject(3)}static addId(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addData(t,e){t.addFieldOffset(1,e,0)}static addIsDelta(t,e){t.addFieldInt8(2,+e,0)}static endDictionaryBatch(t){return t.endObject()}};var ve;(function(i){i[i.Little=0]="Little",i[i.Big=1]="Big"})(ve||(ve={}));var fi;(function(i){i[i.DenseArray=0]="DenseArray"})(fi||(fi={}));class ct{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInt(t,e){return(e||new ct).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,e){return t.setPosition(t.position()+M),(e||new ct).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startInt(t){t.startObject(2)}static addBitWidth(t,e){t.addFieldInt32(0,e,0)}static addIsSigned(t,e){t.addFieldInt8(1,+e,0)}static endInt(t){return t.endObject()}static createInt(t,e,n){return ct.startInt(t),ct.addBitWidth(t,e),ct.addIsSigned(t,n),ct.endInt(t)}}class xt{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryEncoding(t,e){return(e||new xt).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,e){return t.setPosition(t.position()+M),(e||new xt).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}indexType(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new ct).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isOrdered(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}dictionaryKind(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):fi.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addIndexType(t,e){t.addFieldOffset(1,e,0)}static addIsOrdered(t,e){t.addFieldInt8(2,+e,0)}static addDictionaryKind(t,e){t.addFieldInt16(3,e,fi.DenseArray)}static endDictionaryEncoding(t){return t.endObject()}}class G{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsKeyValue(t,e){return(e||new G).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,e){return t.setPosition(t.position()+M),(e||new G).__init(t.readInt32(t.position())+t.position(),t)}key(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}value(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,e){t.addFieldOffset(0,e,0)}static addValue(t,e){t.addFieldOffset(1,e,0)}static endKeyValue(t){return t.endObject()}static createKeyValue(t,e,n){return G.startKeyValue(t),G.addKey(t,e),G.addValue(t,n),G.endKeyValue(t)}}let er=class Re{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBinary(t,e){return(e||new Re).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,e){return t.setPosition(t.position()+M),(e||new Re).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){return t.endObject()}static createBinary(t){return Re.startBinary(t),Re.endBinary(t)}},ir=class Ne{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBool(t,e){return(e||new Ne).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,e){return t.setPosition(t.position()+M),(e||new Ne).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){return t.endObject()}static createBool(t){return Ne.startBool(t),Ne.endBool(t)}},ei=class oe{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDate(t,e){return(e||new oe).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,e){return t.setPosition(t.position()+M),(e||new oe).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):gt.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,gt.MILLISECOND)}static endDate(t){return t.endObject()}static createDate(t,e){return oe.startDate(t),oe.addUnit(t,e),oe.endDate(t)}},ae=class jt{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDecimal(t,e){return(e||new jt).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,e){return t.setPosition(t.position()+M),(e||new jt).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,e){t.addFieldInt32(0,e,0)}static addScale(t,e){t.addFieldInt32(1,e,0)}static addBitWidth(t,e){t.addFieldInt32(2,e,128)}static endDecimal(t){return t.endObject()}static createDecimal(t,e,n,r){return jt.startDecimal(t),jt.addPrecision(t,e),jt.addScale(t,n),jt.addBitWidth(t,r),jt.endDecimal(t)}},ii=class ce{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDuration(t,e){return(e||new ce).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDuration(t,e){return t.setPosition(t.position()+M),(e||new ce).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):_.MILLISECOND}static startDuration(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,_.MILLISECOND)}static endDuration(t){return t.endObject()}static createDuration(t,e){return ce.startDuration(t),ce.addUnit(t,e),ce.endDuration(t)}},ni=class le{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeBinary(t,e){return(e||new le).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,e){return t.setPosition(t.position()+M),(e||new le).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeBinary(t){return t.endObject()}static createFixedSizeBinary(t,e){return le.startFixedSizeBinary(t),le.addByteWidth(t,e),le.endFixedSizeBinary(t)}},ri=class ue{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeList(t,e){return(e||new ue).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,e){return t.setPosition(t.position()+M),(e||new ue).__init(t.readInt32(t.position())+t.position(),t)}listSize(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeList(t){return t.endObject()}static createFixedSizeList(t,e){return ue.startFixedSizeList(t),ue.addListSize(t,e),ue.endFixedSizeList(t)}};class Bt{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFloatingPoint(t,e){return(e||new Bt).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,e){return t.setPosition(t.position()+M),(e||new Bt).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):J.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,e){t.addFieldInt16(0,e,J.HALF)}static endFloatingPoint(t){return t.endObject()}static createFloatingPoint(t,e){return Bt.startFloatingPoint(t),Bt.addPrecision(t,e),Bt.endFloatingPoint(t)}}class At{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInterval(t,e){return(e||new At).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,e){return t.setPosition(t.position()+M),(e||new At).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Rt.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,Rt.YEAR_MONTH)}static endInterval(t){return t.endObject()}static createInterval(t,e){return At.startInterval(t),At.addUnit(t,e),At.endInterval(t)}}let nr=class Fe{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsLargeBinary(t,e){return(e||new Fe).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeBinary(t,e){return t.setPosition(t.position()+M),(e||new Fe).__init(t.readInt32(t.position())+t.position(),t)}static startLargeBinary(t){t.startObject(0)}static endLargeBinary(t){return t.endObject()}static createLargeBinary(t){return Fe.startLargeBinary(t),Fe.endLargeBinary(t)}},rr=class Le{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsLargeUtf8(t,e){return(e||new Le).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeUtf8(t,e){return t.setPosition(t.position()+M),(e||new Le).__init(t.readInt32(t.position())+t.position(),t)}static startLargeUtf8(t){t.startObject(0)}static endLargeUtf8(t){return t.endObject()}static createLargeUtf8(t){return Le.startLargeUtf8(t),Le.endLargeUtf8(t)}},sr=class Ue{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsList(t,e){return(e||new Ue).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,e){return t.setPosition(t.position()+M),(e||new Ue).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){return t.endObject()}static createList(t){return Ue.startList(t),Ue.endList(t)}},si=class de{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMap(t,e){return(e||new de).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,e){return t.setPosition(t.position()+M),(e||new de).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){const t=this.bb.__offset(this.bb_pos,4);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startMap(t){t.startObject(1)}static addKeysSorted(t,e){t.addFieldInt8(0,+e,0)}static endMap(t){return t.endObject()}static createMap(t,e){return de.startMap(t),de.addKeysSorted(t,e),de.endMap(t)}},or=class Me{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsNull(t,e){return(e||new Me).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,e){return t.setPosition(t.position()+M),(e||new Me).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){return t.endObject()}static createNull(t){return Me.startNull(t),Me.endNull(t)}};class Xt{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsStruct_(t,e){return(e||new Xt).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,e){return t.setPosition(t.position()+M),(e||new Xt).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){return t.endObject()}static createStruct_(t){return Xt.startStruct_(t),Xt.endStruct_(t)}}class ft{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTime(t,e){return(e||new ft).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,e){return t.setPosition(t.position()+M),(e||new ft).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):_.MILLISECOND}bitWidth(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,_.MILLISECOND)}static addBitWidth(t,e){t.addFieldInt32(1,e,32)}static endTime(t){return t.endObject()}static createTime(t,e,n){return ft.startTime(t),ft.addUnit(t,e),ft.addBitWidth(t,n),ft.endTime(t)}}class pt{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTimestamp(t,e){return(e||new pt).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,e){return t.setPosition(t.position()+M),(e||new pt).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):_.SECOND}timezone(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,_.SECOND)}static addTimezone(t,e){t.addFieldOffset(1,e,0)}static endTimestamp(t){return t.endObject()}static createTimestamp(t,e,n){return pt.startTimestamp(t),pt.addUnit(t,e),pt.addTimezone(t,n),pt.endTimestamp(t)}}class nt{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUnion(t,e){return(e||new nt).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,e){return t.setPosition(t.position()+M),(e||new nt).__init(t.readInt32(t.position())+t.position(),t)}mode(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):K.Sparse}typeIds(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+t*4):0}typeIdsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,e){t.addFieldInt16(0,e,K.Sparse)}static addTypeIds(t,e){t.addFieldOffset(1,e,0)}static createTypeIdsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addInt32(e[n]);return t.endVector()}static startTypeIdsVector(t,e){t.startVector(4,e,4)}static endUnion(t){return t.endObject()}static createUnion(t,e,n){return nt.startUnion(t),nt.addMode(t,e),nt.addTypeIds(t,n),nt.endUnion(t)}}let ar=class Ce{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUtf8(t,e){return(e||new Ce).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,e){return t.setPosition(t.position()+M),(e||new Ce).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){return t.endObject()}static createUtf8(t){return Ce.startUtf8(t),Ce.endUtf8(t)}};var V;(function(i){i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.FloatingPoint=3]="FloatingPoint",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct_=13]="Struct_",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Duration=18]="Duration",i[i.LargeBinary=19]="LargeBinary",i[i.LargeUtf8=20]="LargeUtf8",i[i.LargeList=21]="LargeList",i[i.RunEndEncoded=22]="RunEndEncoded"})(V||(V={}));let dt=class oi{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsField(t,e){return(e||new oi).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,e){return t.setPosition(t.position()+M),(e||new oi).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}nullable(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}typeType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):V.NONE}type(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__union(t,this.bb_pos+e):null}dictionary(t){const e=this.bb.__offset(this.bb_pos,12);return e?(t||new xt).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}children(t,e){const n=this.bb.__offset(this.bb_pos,14);return n?(e||new oi).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,16);return n?(e||new G).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,e){t.addFieldOffset(0,e,0)}static addNullable(t,e){t.addFieldInt8(1,+e,0)}static addTypeType(t,e){t.addFieldInt8(2,e,V.NONE)}static addType(t,e){t.addFieldOffset(3,e,0)}static addDictionary(t,e){t.addFieldOffset(4,e,0)}static addChildren(t,e){t.addFieldOffset(5,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(6,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endField(t){return t.endObject()}},It=class Ft{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSchema(t,e){return(e||new Ft).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,e){return t.setPosition(t.position()+M),(e||new Ft).__init(t.readInt32(t.position())+t.position(),t)}endianness(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ve.Little}fields(t,e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new dt).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}fieldsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new G).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb.__vector(this.bb_pos+e)+t*8):BigInt(0)}featuresLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,e){t.addFieldInt16(0,e,ve.Little)}static addFields(t,e){t.addFieldOffset(1,e,0)}static createFieldsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startFieldsVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(2,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static addFeatures(t,e){t.addFieldOffset(3,e,0)}static createFeaturesVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addInt64(e[n]);return t.endVector()}static startFeaturesVector(t,e){t.startVector(8,e,8)}static endSchema(t){return t.endObject()}static finishSchemaBuffer(t,e){t.finish(e)}static finishSizePrefixedSchemaBuffer(t,e){t.finish(e,void 0,!0)}static createSchema(t,e,n,r,s){return Ft.startSchema(t),Ft.addEndianness(t,e),Ft.addFields(t,n),Ft.addCustomMetadata(t,r),Ft.addFeatures(t,s),Ft.endSchema(t)}};var N;(function(i){i[i.NONE=0]="NONE",i[i.Schema=1]="Schema",i[i.DictionaryBatch=2]="DictionaryBatch",i[i.RecordBatch=3]="RecordBatch",i[i.Tensor=4]="Tensor",i[i.SparseTensor=5]="SparseTensor"})(N||(N={}));var l;(function(i){i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.Float=3]="Float",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct=13]="Struct",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Duration=18]="Duration",i[i.LargeBinary=19]="LargeBinary",i[i.LargeUtf8=20]="LargeUtf8",i[i.Dictionary=-1]="Dictionary",i[i.Int8=-2]="Int8",i[i.Int16=-3]="Int16",i[i.Int32=-4]="Int32",i[i.Int64=-5]="Int64",i[i.Uint8=-6]="Uint8",i[i.Uint16=-7]="Uint16",i[i.Uint32=-8]="Uint32",i[i.Uint64=-9]="Uint64",i[i.Float16=-10]="Float16",i[i.Float32=-11]="Float32",i[i.Float64=-12]="Float64",i[i.DateDay=-13]="DateDay",i[i.DateMillisecond=-14]="DateMillisecond",i[i.TimestampSecond=-15]="TimestampSecond",i[i.TimestampMillisecond=-16]="TimestampMillisecond",i[i.TimestampMicrosecond=-17]="TimestampMicrosecond",i[i.TimestampNanosecond=-18]="TimestampNanosecond",i[i.TimeSecond=-19]="TimeSecond",i[i.TimeMillisecond=-20]="TimeMillisecond",i[i.TimeMicrosecond=-21]="TimeMicrosecond",i[i.TimeNanosecond=-22]="TimeNanosecond",i[i.DenseUnion=-23]="DenseUnion",i[i.SparseUnion=-24]="SparseUnion",i[i.IntervalDayTime=-25]="IntervalDayTime",i[i.IntervalYearMonth=-26]="IntervalYearMonth",i[i.DurationSecond=-27]="DurationSecond",i[i.DurationMillisecond=-28]="DurationMillisecond",i[i.DurationMicrosecond=-29]="DurationMicrosecond",i[i.DurationNanosecond=-30]="DurationNanosecond"})(l||(l={}));var Ut;(function(i){i[i.OFFSET=0]="OFFSET",i[i.DATA=1]="DATA",i[i.VALIDITY=2]="VALIDITY",i[i.TYPE=3]="TYPE"})(Ut||(Ut={}));const Ko=void 0;function Pe(i){if(i===null)return"null";if(i===Ko)return"undefined";switch(typeof i){case"number":return`${i}`;case"bigint":return`${i}`;case"string":return`"${i}"`}return typeof i[Symbol.toPrimitive]=="function"?i[Symbol.toPrimitive]("string"):ArrayBuffer.isView(i)?i instanceof BigInt64Array||i instanceof BigUint64Array?`[${[...i].map(t=>Pe(t))}]`:`[${i}]`:ArrayBuffer.isView(i)?`[${i}]`:JSON.stringify(i,(t,e)=>typeof e=="bigint"?`${e}`:e)}function P(i){if(typeof i=="bigint"&&(i<Number.MIN_SAFE_INTEGER||i>Number.MAX_SAFE_INTEGER))throw new TypeError(`${i} is not safe to convert to a number.`);return Number(i)}function xr(i,t){return P(i/t)+P(i%t)/P(t)}const Xo=Symbol.for("isArrowBigNum");function wt(i,...t){return t.length===0?Object.setPrototypeOf(k(this.TypedArray,i),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(i,...t),this.constructor.prototype)}wt.prototype[Xo]=!0;wt.prototype.toJSON=function(){return`"${ze(this)}"`};wt.prototype.valueOf=function(i){return kr(this,i)};wt.prototype.toString=function(){return ze(this)};wt.prototype[Symbol.toPrimitive]=function(i="default"){switch(i){case"number":return kr(this);case"string":return ze(this);case"default":return ea(this)}return ze(this)};function _e(...i){return wt.apply(this,i)}function be(...i){return wt.apply(this,i)}function Ve(...i){return wt.apply(this,i)}Object.setPrototypeOf(_e.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(be.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(Ve.prototype,Object.create(Uint32Array.prototype));Object.assign(_e.prototype,wt.prototype,{constructor:_e,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(be.prototype,wt.prototype,{constructor:be,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(Ve.prototype,wt.prototype,{constructor:Ve,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});const Zo=BigInt(4294967296)*BigInt(4294967296),ta=Zo-BigInt(1);function kr(i,t){const{buffer:e,byteOffset:n,byteLength:r,signed:s}=i,o=new BigUint64Array(e,n,r/8),a=s&&o.at(-1)&BigInt(1)<<BigInt(63);let c=BigInt(0),u=0;if(a){for(const d of o)c|=(d^ta)*(BigInt(1)<<BigInt(64*u++));c*=BigInt(-1),c-=BigInt(1)}else for(const d of o)c|=d*(BigInt(1)<<BigInt(64*u++));if(typeof t=="number"){const d=BigInt(Math.pow(10,t)),h=c/d,F=c%d;return P(h)+P(F)/P(d)}return P(c)}function ze(i){if(i.byteLength===8)return`${new i.BigIntArray(i.buffer,i.byteOffset,1)[0]}`;if(!i.signed)return Ji(i);let t=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2);if(new Int16Array([t.at(-1)])[0]>=0)return Ji(i);t=t.slice();let n=1;for(let s=0;s<t.length;s++){const o=t[s],a=~o+n;t[s]=a,n&=o===0?1:0}return`-${Ji(t)}`}function ea(i){return i.byteLength===8?new i.BigIntArray(i.buffer,i.byteOffset,1)[0]:ze(i)}function Ji(i){let t="";const e=new Uint32Array(2);let n=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2);const r=new Uint32Array((n=new Uint16Array(n).reverse()).buffer);let s=-1;const o=n.length-1;do{for(e[0]=n[s=0];s<o;)n[s++]=e[1]=e[0]/10,e[0]=(e[0]-e[1]*10<<16)+n[s];n[s]=e[1]=e[0]/10,e[0]=e[0]-e[1]*10,t=`${e[0]}${t}`}while(r[0]||r[1]||r[2]||r[3]);return t??"0"}class Bn{static new(t,e){switch(e){case!0:return new _e(t);case!1:return new be(t)}switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new _e(t)}return t.byteLength===16?new Ve(t):new be(t)}static signed(t){return new _e(t)}static unsigned(t){return new be(t)}static decimal(t){return new Ve(t)}constructor(t,e){return Bn.new(t,e)}}var Pr,Vr,zr,$r,jr,Wr,qr,Hr,Yr,Gr,Qr,Jr,Kr,Xr,Zr,ts,es,is,ns,rs,ss,os;class f{static isNull(t){return(t==null?void 0:t.typeId)===l.Null}static isInt(t){return(t==null?void 0:t.typeId)===l.Int}static isFloat(t){return(t==null?void 0:t.typeId)===l.Float}static isBinary(t){return(t==null?void 0:t.typeId)===l.Binary}static isLargeBinary(t){return(t==null?void 0:t.typeId)===l.LargeBinary}static isUtf8(t){return(t==null?void 0:t.typeId)===l.Utf8}static isLargeUtf8(t){return(t==null?void 0:t.typeId)===l.LargeUtf8}static isBool(t){return(t==null?void 0:t.typeId)===l.Bool}static isDecimal(t){return(t==null?void 0:t.typeId)===l.Decimal}static isDate(t){return(t==null?void 0:t.typeId)===l.Date}static isTime(t){return(t==null?void 0:t.typeId)===l.Time}static isTimestamp(t){return(t==null?void 0:t.typeId)===l.Timestamp}static isInterval(t){return(t==null?void 0:t.typeId)===l.Interval}static isDuration(t){return(t==null?void 0:t.typeId)===l.Duration}static isList(t){return(t==null?void 0:t.typeId)===l.List}static isStruct(t){return(t==null?void 0:t.typeId)===l.Struct}static isUnion(t){return(t==null?void 0:t.typeId)===l.Union}static isFixedSizeBinary(t){return(t==null?void 0:t.typeId)===l.FixedSizeBinary}static isFixedSizeList(t){return(t==null?void 0:t.typeId)===l.FixedSizeList}static isMap(t){return(t==null?void 0:t.typeId)===l.Map}static isDictionary(t){return(t==null?void 0:t.typeId)===l.Dictionary}static isDenseUnion(t){return f.isUnion(t)&&t.mode===K.Dense}static isSparseUnion(t){return f.isUnion(t)&&t.mode===K.Sparse}constructor(t){this.typeId=t}}Pr=Symbol.toStringTag;f[Pr]=(i=>(i.children=null,i.ArrayType=Array,i.OffsetArrayType=Int32Array,i[Symbol.toStringTag]="DataType"))(f.prototype);class Ht extends f{constructor(){super(l.Null)}toString(){return"Null"}}Vr=Symbol.toStringTag;Ht[Vr]=(i=>i[Symbol.toStringTag]="Null")(Ht.prototype);class ee extends f{constructor(t,e){super(l.Int),this.isSigned=t,this.bitWidth=e}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}zr=Symbol.toStringTag;ee[zr]=(i=>(i.isSigned=null,i.bitWidth=null,i[Symbol.toStringTag]="Int"))(ee.prototype);class $e extends ee{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}Object.defineProperty($e.prototype,"ArrayType",{value:Int32Array});class pi extends f{constructor(t){super(l.Float),this.precision=t}get ArrayType(){switch(this.precision){case J.HALF:return Uint16Array;case J.SINGLE:return Float32Array;case J.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}$r=Symbol.toStringTag;pi[$r]=(i=>(i.precision=null,i[Symbol.toStringTag]="Float"))(pi.prototype);class yi extends f{constructor(){super(l.Binary)}toString(){return"Binary"}}jr=Symbol.toStringTag;yi[jr]=(i=>(i.ArrayType=Uint8Array,i[Symbol.toStringTag]="Binary"))(yi.prototype);class gi extends f{constructor(){super(l.LargeBinary)}toString(){return"LargeBinary"}}Wr=Symbol.toStringTag;gi[Wr]=(i=>(i.ArrayType=Uint8Array,i.OffsetArrayType=BigInt64Array,i[Symbol.toStringTag]="LargeBinary"))(gi.prototype);class mi extends f{constructor(){super(l.Utf8)}toString(){return"Utf8"}}qr=Symbol.toStringTag;mi[qr]=(i=>(i.ArrayType=Uint8Array,i[Symbol.toStringTag]="Utf8"))(mi.prototype);class _i extends f{constructor(){super(l.LargeUtf8)}toString(){return"LargeUtf8"}}Hr=Symbol.toStringTag;_i[Hr]=(i=>(i.ArrayType=Uint8Array,i.OffsetArrayType=BigInt64Array,i[Symbol.toStringTag]="LargeUtf8"))(_i.prototype);class bi extends f{constructor(){super(l.Bool)}toString(){return"Bool"}}Yr=Symbol.toStringTag;bi[Yr]=(i=>(i.ArrayType=Uint8Array,i[Symbol.toStringTag]="Bool"))(bi.prototype);class wi extends f{constructor(t,e,n=128){super(l.Decimal),this.scale=t,this.precision=e,this.bitWidth=n}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}}Gr=Symbol.toStringTag;wi[Gr]=(i=>(i.scale=null,i.precision=null,i.ArrayType=Uint32Array,i[Symbol.toStringTag]="Decimal"))(wi.prototype);class Si extends f{constructor(t){super(l.Date),this.unit=t}toString(){return`Date${(this.unit+1)*32}<${gt[this.unit]}>`}get ArrayType(){return this.unit===gt.DAY?Int32Array:BigInt64Array}}Qr=Symbol.toStringTag;Si[Qr]=(i=>(i.unit=null,i[Symbol.toStringTag]="Date"))(Si.prototype);class Ii extends f{constructor(t,e){super(l.Time),this.unit=t,this.bitWidth=e}toString(){return`Time${this.bitWidth}<${_[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}Jr=Symbol.toStringTag;Ii[Jr]=(i=>(i.unit=null,i.bitWidth=null,i[Symbol.toStringTag]="Time"))(Ii.prototype);class vi extends f{constructor(t,e){super(l.Timestamp),this.unit=t,this.timezone=e}toString(){return`Timestamp<${_[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}Kr=Symbol.toStringTag;vi[Kr]=(i=>(i.unit=null,i.timezone=null,i.ArrayType=BigInt64Array,i[Symbol.toStringTag]="Timestamp"))(vi.prototype);class Ei extends f{constructor(t){super(l.Interval),this.unit=t}toString(){return`Interval<${Rt[this.unit]}>`}}Xr=Symbol.toStringTag;Ei[Xr]=(i=>(i.unit=null,i.ArrayType=Int32Array,i[Symbol.toStringTag]="Interval"))(Ei.prototype);class Bi extends f{constructor(t){super(l.Duration),this.unit=t}toString(){return`Duration<${_[this.unit]}>`}}Zr=Symbol.toStringTag;Bi[Zr]=(i=>(i.unit=null,i.ArrayType=BigInt64Array,i[Symbol.toStringTag]="Duration"))(Bi.prototype);class Ai extends f{constructor(t){super(l.List),this.children=[t]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}}ts=Symbol.toStringTag;Ai[ts]=(i=>(i.children=null,i[Symbol.toStringTag]="List"))(Ai.prototype);class Z extends f{constructor(t){super(l.Struct),this.children=t}toString(){return`Struct<{${this.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}}es=Symbol.toStringTag;Z[es]=(i=>(i.children=null,i[Symbol.toStringTag]="Struct"))(Z.prototype);class Oi extends f{constructor(t,e,n){super(l.Union),this.mode=t,this.children=n,this.typeIds=e=Int32Array.from(e),this.typeIdToChildIndex=e.reduce((r,s,o)=>(r[s]=o)&&r||r,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(t=>`${t.type}`).join(" | ")}>`}}is=Symbol.toStringTag;Oi[is]=(i=>(i.mode=null,i.typeIds=null,i.children=null,i.typeIdToChildIndex=null,i.ArrayType=Int8Array,i[Symbol.toStringTag]="Union"))(Oi.prototype);class Di extends f{constructor(t){super(l.FixedSizeBinary),this.byteWidth=t}toString(){return`FixedSizeBinary[${this.byteWidth}]`}}ns=Symbol.toStringTag;Di[ns]=(i=>(i.byteWidth=null,i.ArrayType=Uint8Array,i[Symbol.toStringTag]="FixedSizeBinary"))(Di.prototype);class Ti extends f{constructor(t,e){super(l.FixedSizeList),this.listSize=t,this.children=[e]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}rs=Symbol.toStringTag;Ti[rs]=(i=>(i.children=null,i.listSize=null,i[Symbol.toStringTag]="FixedSizeList"))(Ti.prototype);class Ri extends f{constructor(t,e=!1){var n,r,s;if(super(l.Map),this.children=[t],this.keysSorted=e,t&&(t.name="entries",!((n=t==null?void 0:t.type)===null||n===void 0)&&n.children)){const o=(r=t==null?void 0:t.type)===null||r===void 0?void 0:r.children[0];o&&(o.name="key");const a=(s=t==null?void 0:t.type)===null||s===void 0?void 0:s.children[1];a&&(a.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}}ss=Symbol.toStringTag;Ri[ss]=(i=>(i.children=null,i.keysSorted=null,i[Symbol.toStringTag]="Map_"))(Ri.prototype);const ia=(i=>()=>++i)(-1);class Ee extends f{constructor(t,e,n,r){super(l.Dictionary),this.indices=e,this.dictionary=t,this.isOrdered=r||!1,this.id=n==null?ia():P(n)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}os=Symbol.toStringTag;Ee[os]=(i=>(i.id=null,i.indices=null,i.isOrdered=null,i.dictionary=null,i[Symbol.toStringTag]="Dictionary"))(Ee.prototype);function Mt(i){const t=i;switch(i.typeId){case l.Decimal:return i.bitWidth/32;case l.Interval:return 1+t.unit;case l.FixedSizeList:return t.listSize;case l.FixedSizeBinary:return t.byteWidth;default:return 1}}class O{visitMany(t,...e){return t.map((n,r)=>this.visit(n,...e.map(s=>s[r])))}visit(...t){return this.getVisitFn(t[0],!1).apply(this,t)}getVisitFn(t,e=!0){return na(this,t,e)}getVisitFnByTypeId(t,e=!0){return he(this,t,e)}visitNull(t,...e){return null}visitBool(t,...e){return null}visitInt(t,...e){return null}visitFloat(t,...e){return null}visitUtf8(t,...e){return null}visitLargeUtf8(t,...e){return null}visitBinary(t,...e){return null}visitLargeBinary(t,...e){return null}visitFixedSizeBinary(t,...e){return null}visitDate(t,...e){return null}visitTimestamp(t,...e){return null}visitTime(t,...e){return null}visitDecimal(t,...e){return null}visitList(t,...e){return null}visitStruct(t,...e){return null}visitUnion(t,...e){return null}visitDictionary(t,...e){return null}visitInterval(t,...e){return null}visitDuration(t,...e){return null}visitFixedSizeList(t,...e){return null}visitMap(t,...e){return null}}function na(i,t,e=!0){return typeof t=="number"?he(i,t,e):typeof t=="string"&&t in l?he(i,l[t],e):t&&t instanceof f?he(i,cr(t),e):t!=null&&t.type&&t.type instanceof f?he(i,cr(t.type),e):he(i,l.NONE,e)}function he(i,t,e=!0){let n=null;switch(t){case l.Null:n=i.visitNull;break;case l.Bool:n=i.visitBool;break;case l.Int:n=i.visitInt;break;case l.Int8:n=i.visitInt8||i.visitInt;break;case l.Int16:n=i.visitInt16||i.visitInt;break;case l.Int32:n=i.visitInt32||i.visitInt;break;case l.Int64:n=i.visitInt64||i.visitInt;break;case l.Uint8:n=i.visitUint8||i.visitInt;break;case l.Uint16:n=i.visitUint16||i.visitInt;break;case l.Uint32:n=i.visitUint32||i.visitInt;break;case l.Uint64:n=i.visitUint64||i.visitInt;break;case l.Float:n=i.visitFloat;break;case l.Float16:n=i.visitFloat16||i.visitFloat;break;case l.Float32:n=i.visitFloat32||i.visitFloat;break;case l.Float64:n=i.visitFloat64||i.visitFloat;break;case l.Utf8:n=i.visitUtf8;break;case l.LargeUtf8:n=i.visitLargeUtf8;break;case l.Binary:n=i.visitBinary;break;case l.LargeBinary:n=i.visitLargeBinary;break;case l.FixedSizeBinary:n=i.visitFixedSizeBinary;break;case l.Date:n=i.visitDate;break;case l.DateDay:n=i.visitDateDay||i.visitDate;break;case l.DateMillisecond:n=i.visitDateMillisecond||i.visitDate;break;case l.Timestamp:n=i.visitTimestamp;break;case l.TimestampSecond:n=i.visitTimestampSecond||i.visitTimestamp;break;case l.TimestampMillisecond:n=i.visitTimestampMillisecond||i.visitTimestamp;break;case l.TimestampMicrosecond:n=i.visitTimestampMicrosecond||i.visitTimestamp;break;case l.TimestampNanosecond:n=i.visitTimestampNanosecond||i.visitTimestamp;break;case l.Time:n=i.visitTime;break;case l.TimeSecond:n=i.visitTimeSecond||i.visitTime;break;case l.TimeMillisecond:n=i.visitTimeMillisecond||i.visitTime;break;case l.TimeMicrosecond:n=i.visitTimeMicrosecond||i.visitTime;break;case l.TimeNanosecond:n=i.visitTimeNanosecond||i.visitTime;break;case l.Decimal:n=i.visitDecimal;break;case l.List:n=i.visitList;break;case l.Struct:n=i.visitStruct;break;case l.Union:n=i.visitUnion;break;case l.DenseUnion:n=i.visitDenseUnion||i.visitUnion;break;case l.SparseUnion:n=i.visitSparseUnion||i.visitUnion;break;case l.Dictionary:n=i.visitDictionary;break;case l.Interval:n=i.visitInterval;break;case l.IntervalDayTime:n=i.visitIntervalDayTime||i.visitInterval;break;case l.IntervalYearMonth:n=i.visitIntervalYearMonth||i.visitInterval;break;case l.Duration:n=i.visitDuration;break;case l.DurationSecond:n=i.visitDurationSecond||i.visitDuration;break;case l.DurationMillisecond:n=i.visitDurationMillisecond||i.visitDuration;break;case l.DurationMicrosecond:n=i.visitDurationMicrosecond||i.visitDuration;break;case l.DurationNanosecond:n=i.visitDurationNanosecond||i.visitDuration;break;case l.FixedSizeList:n=i.visitFixedSizeList;break;case l.Map:n=i.visitMap;break}if(typeof n=="function")return n;if(!e)return()=>null;throw new Error(`Unrecognized type '${l[t]}'`)}function cr(i){switch(i.typeId){case l.Null:return l.Null;case l.Int:{const{bitWidth:t,isSigned:e}=i;switch(t){case 8:return e?l.Int8:l.Uint8;case 16:return e?l.Int16:l.Uint16;case 32:return e?l.Int32:l.Uint32;case 64:return e?l.Int64:l.Uint64}return l.Int}case l.Float:switch(i.precision){case J.HALF:return l.Float16;case J.SINGLE:return l.Float32;case J.DOUBLE:return l.Float64}return l.Float;case l.Binary:return l.Binary;case l.LargeBinary:return l.LargeBinary;case l.Utf8:return l.Utf8;case l.LargeUtf8:return l.LargeUtf8;case l.Bool:return l.Bool;case l.Decimal:return l.Decimal;case l.Time:switch(i.unit){case _.SECOND:return l.TimeSecond;case _.MILLISECOND:return l.TimeMillisecond;case _.MICROSECOND:return l.TimeMicrosecond;case _.NANOSECOND:return l.TimeNanosecond}return l.Time;case l.Timestamp:switch(i.unit){case _.SECOND:return l.TimestampSecond;case _.MILLISECOND:return l.TimestampMillisecond;case _.MICROSECOND:return l.TimestampMicrosecond;case _.NANOSECOND:return l.TimestampNanosecond}return l.Timestamp;case l.Date:switch(i.unit){case gt.DAY:return l.DateDay;case gt.MILLISECOND:return l.DateMillisecond}return l.Date;case l.Interval:switch(i.unit){case Rt.DAY_TIME:return l.IntervalDayTime;case Rt.YEAR_MONTH:return l.IntervalYearMonth}return l.Interval;case l.Duration:switch(i.unit){case _.SECOND:return l.DurationSecond;case _.MILLISECOND:return l.DurationMillisecond;case _.MICROSECOND:return l.DurationMicrosecond;case _.NANOSECOND:return l.DurationNanosecond}return l.Duration;case l.Map:return l.Map;case l.List:return l.List;case l.Struct:return l.Struct;case l.Union:switch(i.mode){case K.Dense:return l.DenseUnion;case K.Sparse:return l.SparseUnion}return l.Union;case l.FixedSizeBinary:return l.FixedSizeBinary;case l.FixedSizeList:return l.FixedSizeList;case l.Dictionary:return l.Dictionary}throw new Error(`Unrecognized type '${l[i.typeId]}'`)}O.prototype.visitInt8=null;O.prototype.visitInt16=null;O.prototype.visitInt32=null;O.prototype.visitInt64=null;O.prototype.visitUint8=null;O.prototype.visitUint16=null;O.prototype.visitUint32=null;O.prototype.visitUint64=null;O.prototype.visitFloat16=null;O.prototype.visitFloat32=null;O.prototype.visitFloat64=null;O.prototype.visitDateDay=null;O.prototype.visitDateMillisecond=null;O.prototype.visitTimestampSecond=null;O.prototype.visitTimestampMillisecond=null;O.prototype.visitTimestampMicrosecond=null;O.prototype.visitTimestampNanosecond=null;O.prototype.visitTimeSecond=null;O.prototype.visitTimeMillisecond=null;O.prototype.visitTimeMicrosecond=null;O.prototype.visitTimeNanosecond=null;O.prototype.visitDenseUnion=null;O.prototype.visitSparseUnion=null;O.prototype.visitIntervalDayTime=null;O.prototype.visitIntervalYearMonth=null;O.prototype.visitDuration=null;O.prototype.visitDurationSecond=null;O.prototype.visitDurationMillisecond=null;O.prototype.visitDurationMicrosecond=null;O.prototype.visitDurationNanosecond=null;const as=new Float64Array(1),re=new Uint32Array(as.buffer);function cs(i){const t=(i&31744)>>10,e=(i&1023)/1024,n=Math.pow(-1,(i&32768)>>15);switch(t){case 31:return n*(e?Number.NaN:1/0);case 0:return n*(e?6103515625e-14*e:0)}return n*Math.pow(2,t-15)*(1+e)}function ra(i){if(i!==i)return 32256;as[0]=i;const t=(re[1]&2147483648)>>16&65535;let e=re[1]&2146435072,n=0;return e>=1089470464?re[0]>0?e=31744:(e=(e&2080374784)>>16,n=(re[1]&1048575)>>10):e<=1056964608?(n=1048576+(re[1]&1048575),n=1048576+(n<<(e>>20)-998)>>21,e=0):(e=e-1056964608>>10,n=(re[1]&1048575)+512>>10),t|e|n&65535}class b extends O{}function I(i){return(t,e,n)=>{if(t.setValid(e,n!=null))return i(t,e,n)}}const sa=(i,t,e)=>{i[t]=Math.floor(e/864e5)},ls=(i,t,e,n)=>{if(e+1<t.length){const r=P(t[e]),s=P(t[e+1]);i.set(n.subarray(0,s-r),r)}},oa=({offset:i,values:t},e,n)=>{const r=i+e;n?t[r>>3]|=1<<r%8:t[r>>3]&=~(1<<r%8)},kt=({values:i},t,e)=>{i[t]=e},An=({values:i},t,e)=>{i[t]=e},us=({values:i},t,e)=>{i[t]=ra(e)},aa=(i,t,e)=>{switch(i.type.precision){case J.HALF:return us(i,t,e);case J.SINGLE:case J.DOUBLE:return An(i,t,e)}},ds=({values:i},t,e)=>{sa(i,t,e.valueOf())},hs=({values:i},t,e)=>{i[t]=BigInt(e)},ca=({stride:i,values:t},e,n)=>{t.set(n.subarray(0,i),i*e)},fs=({values:i,valueOffsets:t},e,n)=>ls(i,t,e,n),ps=({values:i,valueOffsets:t},e,n)=>ls(i,t,e,In(n)),la=(i,t,e)=>{i.type.unit===gt.DAY?ds(i,t,e):hs(i,t,e)},ys=({values:i},t,e)=>{i[t]=BigInt(e/1e3)},gs=({values:i},t,e)=>{i[t]=BigInt(e)},ms=({values:i},t,e)=>{i[t]=BigInt(e*1e3)},_s=({values:i},t,e)=>{i[t]=BigInt(e*1e6)},ua=(i,t,e)=>{switch(i.type.unit){case _.SECOND:return ys(i,t,e);case _.MILLISECOND:return gs(i,t,e);case _.MICROSECOND:return ms(i,t,e);case _.NANOSECOND:return _s(i,t,e)}},bs=({values:i},t,e)=>{i[t]=e},ws=({values:i},t,e)=>{i[t]=e},Ss=({values:i},t,e)=>{i[t]=e},Is=({values:i},t,e)=>{i[t]=e},da=(i,t,e)=>{switch(i.type.unit){case _.SECOND:return bs(i,t,e);case _.MILLISECOND:return ws(i,t,e);case _.MICROSECOND:return Ss(i,t,e);case _.NANOSECOND:return Is(i,t,e)}},ha=({values:i,stride:t},e,n)=>{i.set(n.subarray(0,t),t*e)},fa=(i,t,e)=>{const n=i.children[0],r=i.valueOffsets,s=mt.getVisitFn(n);if(Array.isArray(e))for(let o=-1,a=r[t],c=r[t+1];a<c;)s(n,a++,e[++o]);else for(let o=-1,a=r[t],c=r[t+1];a<c;)s(n,a++,e.get(++o))},pa=(i,t,e)=>{const n=i.children[0],{valueOffsets:r}=i,s=mt.getVisitFn(n);let{[t]:o,[t+1]:a}=r;const c=e instanceof Map?e.entries():Object.entries(e);for(const u of c)if(s(n,o,u),++o>=a)break},ya=(i,t)=>(e,n,r,s)=>n&&e(n,i,t[s]),ga=(i,t)=>(e,n,r,s)=>n&&e(n,i,t.get(s)),ma=(i,t)=>(e,n,r,s)=>n&&e(n,i,t.get(r.name)),_a=(i,t)=>(e,n,r,s)=>n&&e(n,i,t[r.name]),ba=(i,t,e)=>{const n=i.type.children.map(s=>mt.getVisitFn(s.type)),r=e instanceof Map?ma(t,e):e instanceof L?ga(t,e):Array.isArray(e)?ya(t,e):_a(t,e);i.type.children.forEach((s,o)=>r(n[o],i.children[o],s,o))},wa=(i,t,e)=>{i.type.mode===K.Dense?vs(i,t,e):Es(i,t,e)},vs=(i,t,e)=>{const n=i.type.typeIdToChildIndex[i.typeIds[t]],r=i.children[n];mt.visit(r,i.valueOffsets[t],e)},Es=(i,t,e)=>{const n=i.type.typeIdToChildIndex[i.typeIds[t]],r=i.children[n];mt.visit(r,t,e)},Sa=(i,t,e)=>{var n;(n=i.dictionary)===null||n===void 0||n.set(i.values[t],e)},Ia=(i,t,e)=>{i.type.unit===Rt.DAY_TIME?Bs(i,t,e):As(i,t,e)},Bs=({values:i},t,e)=>{i.set(e.subarray(0,2),2*t)},As=({values:i},t,e)=>{i[t]=e[0]*12+e[1]%12},Os=({values:i},t,e)=>{i[t]=e},Ds=({values:i},t,e)=>{i[t]=e},Ts=({values:i},t,e)=>{i[t]=e},Rs=({values:i},t,e)=>{i[t]=e},va=(i,t,e)=>{switch(i.type.unit){case _.SECOND:return Os(i,t,e);case _.MILLISECOND:return Ds(i,t,e);case _.MICROSECOND:return Ts(i,t,e);case _.NANOSECOND:return Rs(i,t,e)}},Ea=(i,t,e)=>{const{stride:n}=i,r=i.children[0],s=mt.getVisitFn(r);if(Array.isArray(e))for(let o=-1,a=t*n;++o<n;)s(r,a+o,e[o]);else for(let o=-1,a=t*n;++o<n;)s(r,a+o,e.get(o))};b.prototype.visitBool=I(oa);b.prototype.visitInt=I(kt);b.prototype.visitInt8=I(kt);b.prototype.visitInt16=I(kt);b.prototype.visitInt32=I(kt);b.prototype.visitInt64=I(kt);b.prototype.visitUint8=I(kt);b.prototype.visitUint16=I(kt);b.prototype.visitUint32=I(kt);b.prototype.visitUint64=I(kt);b.prototype.visitFloat=I(aa);b.prototype.visitFloat16=I(us);b.prototype.visitFloat32=I(An);b.prototype.visitFloat64=I(An);b.prototype.visitUtf8=I(ps);b.prototype.visitLargeUtf8=I(ps);b.prototype.visitBinary=I(fs);b.prototype.visitLargeBinary=I(fs);b.prototype.visitFixedSizeBinary=I(ca);b.prototype.visitDate=I(la);b.prototype.visitDateDay=I(ds);b.prototype.visitDateMillisecond=I(hs);b.prototype.visitTimestamp=I(ua);b.prototype.visitTimestampSecond=I(ys);b.prototype.visitTimestampMillisecond=I(gs);b.prototype.visitTimestampMicrosecond=I(ms);b.prototype.visitTimestampNanosecond=I(_s);b.prototype.visitTime=I(da);b.prototype.visitTimeSecond=I(bs);b.prototype.visitTimeMillisecond=I(ws);b.prototype.visitTimeMicrosecond=I(Ss);b.prototype.visitTimeNanosecond=I(Is);b.prototype.visitDecimal=I(ha);b.prototype.visitList=I(fa);b.prototype.visitStruct=I(ba);b.prototype.visitUnion=I(wa);b.prototype.visitDenseUnion=I(vs);b.prototype.visitSparseUnion=I(Es);b.prototype.visitDictionary=I(Sa);b.prototype.visitInterval=I(Ia);b.prototype.visitIntervalDayTime=I(Bs);b.prototype.visitIntervalYearMonth=I(As);b.prototype.visitDuration=I(va);b.prototype.visitDurationSecond=I(Os);b.prototype.visitDurationMillisecond=I(Ds);b.prototype.visitDurationMicrosecond=I(Ts);b.prototype.visitDurationNanosecond=I(Rs);b.prototype.visitFixedSizeList=I(Ea);b.prototype.visitMap=I(pa);const mt=new b,_t=Symbol.for("parent"),we=Symbol.for("rowIndex");class On{constructor(t,e){return this[_t]=t,this[we]=e,new Proxy(this,new Aa)}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[we],e=this[_t],n=e.type.children,r={};for(let s=-1,o=n.length;++s<o;)r[n[s].name]=ot.visit(e.children[s],t);return r}toString(){return`{${[...this].map(([t,e])=>`${Pe(t)}: ${Pe(e)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new Ba(this[_t],this[we])}}class Ba{constructor(t,e){this.childIndex=0,this.children=t.children,this.rowIndex=e,this.childFields=t.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const t=this.childIndex;return t<this.numChildren?(this.childIndex=t+1,{done:!1,value:[this.childFields[t].name,ot.visit(this.children[t],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(On.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[_t]:{writable:!0,enumerable:!1,configurable:!1,value:null},[we]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class Aa{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[_t].type.children.map(e=>e.name)}has(t,e){return t[_t].type.children.findIndex(n=>n.name===e)!==-1}getOwnPropertyDescriptor(t,e){if(t[_t].type.children.findIndex(n=>n.name===e)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const n=t[_t].type.children.findIndex(r=>r.name===e);if(n!==-1){const r=ot.visit(t[_t].children[n],t[we]);return Reflect.set(t,e,r),r}}set(t,e,n){const r=t[_t].type.children.findIndex(s=>s.name===e);return r!==-1?(mt.visit(t[_t].children[r],t[we],n),Reflect.set(t,e,n)):Reflect.has(t,e)||typeof e=="symbol"?Reflect.set(t,e,n):!1}}class p extends O{}function w(i){return(t,e)=>t.getValid(e)?i(t,e):null}const Oa=(i,t)=>864e5*i[t],Da=(i,t)=>null,Ns=(i,t,e)=>{if(e+1>=t.length)return null;const n=P(t[e]),r=P(t[e+1]);return i.subarray(n,r)},Ta=({offset:i,values:t},e)=>{const n=i+e;return(t[n>>3]&1<<n%8)!==0},Fs=({values:i},t)=>Oa(i,t),Ls=({values:i},t)=>P(i[t]),Jt=({stride:i,values:t},e)=>t[i*e],Ra=({stride:i,values:t},e)=>cs(t[i*e]),Us=({values:i},t)=>i[t],Na=({stride:i,values:t},e)=>t.subarray(i*e,i*(e+1)),Ms=({values:i,valueOffsets:t},e)=>Ns(i,t,e),Cs=({values:i,valueOffsets:t},e)=>{const n=Ns(i,t,e);return n!==null?an(n):null},Fa=({values:i},t)=>i[t],La=({type:i,values:t},e)=>i.precision!==J.HALF?t[e]:cs(t[e]),Ua=(i,t)=>i.type.unit===gt.DAY?Fs(i,t):Ls(i,t),xs=({values:i},t)=>1e3*P(i[t]),ks=({values:i},t)=>P(i[t]),Ps=({values:i},t)=>xr(i[t],BigInt(1e3)),Vs=({values:i},t)=>xr(i[t],BigInt(1e6)),Ma=(i,t)=>{switch(i.type.unit){case _.SECOND:return xs(i,t);case _.MILLISECOND:return ks(i,t);case _.MICROSECOND:return Ps(i,t);case _.NANOSECOND:return Vs(i,t)}},zs=({values:i},t)=>i[t],$s=({values:i},t)=>i[t],js=({values:i},t)=>i[t],Ws=({values:i},t)=>i[t],Ca=(i,t)=>{switch(i.type.unit){case _.SECOND:return zs(i,t);case _.MILLISECOND:return $s(i,t);case _.MICROSECOND:return js(i,t);case _.NANOSECOND:return Ws(i,t)}},xa=({values:i,stride:t},e)=>Bn.decimal(i.subarray(t*e,t*(e+1))),ka=(i,t)=>{const{valueOffsets:e,stride:n,children:r}=i,{[t*n]:s,[t*n+1]:o}=e,c=r[0].slice(s,o-s);return new L([c])},Pa=(i,t)=>{const{valueOffsets:e,children:n}=i,{[t]:r,[t+1]:s}=e,o=n[0];return new Dn(o.slice(r,s-r))},Va=(i,t)=>new On(i,t),za=(i,t)=>i.type.mode===K.Dense?qs(i,t):Hs(i,t),qs=(i,t)=>{const e=i.type.typeIdToChildIndex[i.typeIds[t]],n=i.children[e];return ot.visit(n,i.valueOffsets[t])},Hs=(i,t)=>{const e=i.type.typeIdToChildIndex[i.typeIds[t]],n=i.children[e];return ot.visit(n,t)},$a=(i,t)=>{var e;return(e=i.dictionary)===null||e===void 0?void 0:e.get(i.values[t])},ja=(i,t)=>i.type.unit===Rt.DAY_TIME?Ys(i,t):Gs(i,t),Ys=({values:i},t)=>i.subarray(2*t,2*(t+1)),Gs=({values:i},t)=>{const e=i[t],n=new Int32Array(2);return n[0]=Math.trunc(e/12),n[1]=Math.trunc(e%12),n},Qs=({values:i},t)=>i[t],Js=({values:i},t)=>i[t],Ks=({values:i},t)=>i[t],Xs=({values:i},t)=>i[t],Wa=(i,t)=>{switch(i.type.unit){case _.SECOND:return Qs(i,t);case _.MILLISECOND:return Js(i,t);case _.MICROSECOND:return Ks(i,t);case _.NANOSECOND:return Xs(i,t)}},qa=(i,t)=>{const{stride:e,children:n}=i,s=n[0].slice(t*e,e);return new L([s])};p.prototype.visitNull=w(Da);p.prototype.visitBool=w(Ta);p.prototype.visitInt=w(Fa);p.prototype.visitInt8=w(Jt);p.prototype.visitInt16=w(Jt);p.prototype.visitInt32=w(Jt);p.prototype.visitInt64=w(Us);p.prototype.visitUint8=w(Jt);p.prototype.visitUint16=w(Jt);p.prototype.visitUint32=w(Jt);p.prototype.visitUint64=w(Us);p.prototype.visitFloat=w(La);p.prototype.visitFloat16=w(Ra);p.prototype.visitFloat32=w(Jt);p.prototype.visitFloat64=w(Jt);p.prototype.visitUtf8=w(Cs);p.prototype.visitLargeUtf8=w(Cs);p.prototype.visitBinary=w(Ms);p.prototype.visitLargeBinary=w(Ms);p.prototype.visitFixedSizeBinary=w(Na);p.prototype.visitDate=w(Ua);p.prototype.visitDateDay=w(Fs);p.prototype.visitDateMillisecond=w(Ls);p.prototype.visitTimestamp=w(Ma);p.prototype.visitTimestampSecond=w(xs);p.prototype.visitTimestampMillisecond=w(ks);p.prototype.visitTimestampMicrosecond=w(Ps);p.prototype.visitTimestampNanosecond=w(Vs);p.prototype.visitTime=w(Ca);p.prototype.visitTimeSecond=w(zs);p.prototype.visitTimeMillisecond=w($s);p.prototype.visitTimeMicrosecond=w(js);p.prototype.visitTimeNanosecond=w(Ws);p.prototype.visitDecimal=w(xa);p.prototype.visitList=w(ka);p.prototype.visitStruct=w(Va);p.prototype.visitUnion=w(za);p.prototype.visitDenseUnion=w(qs);p.prototype.visitSparseUnion=w(Hs);p.prototype.visitDictionary=w($a);p.prototype.visitInterval=w(ja);p.prototype.visitIntervalDayTime=w(Ys);p.prototype.visitIntervalYearMonth=w(Gs);p.prototype.visitDuration=w(Wa);p.prototype.visitDurationSecond=w(Qs);p.prototype.visitDurationMillisecond=w(Js);p.prototype.visitDurationMicrosecond=w(Ks);p.prototype.visitDurationNanosecond=w(Xs);p.prototype.visitFixedSizeList=w(qa);p.prototype.visitMap=w(Pa);const ot=new p,fe=Symbol.for("keys"),Se=Symbol.for("vals"),pe=Symbol.for("kKeysAsStrings"),fn=Symbol.for("_kKeysAsStrings");class Dn{constructor(t){return this[fe]=new L([t.children[0]]).memoize(),this[Se]=t.children[1],new Proxy(this,new Ya)}get[pe](){return this[fn]||(this[fn]=Array.from(this[fe].toArray(),String))}[Symbol.iterator](){return new Ha(this[fe],this[Se])}get size(){return this[fe].length}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[fe],e=this[Se],n={};for(let r=-1,s=t.length;++r<s;)n[t.get(r)]=ot.visit(e,r);return n}toString(){return`{${[...this].map(([t,e])=>`${Pe(t)}: ${Pe(e)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class Ha{constructor(t,e){this.keys=t,this.vals=e,this.keyIndex=0,this.numKeys=t.length}[Symbol.iterator](){return this}next(){const t=this.keyIndex;return t===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(t),ot.visit(this.vals,t)]})}}class Ya{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[pe]}has(t,e){return t[pe].includes(e)}getOwnPropertyDescriptor(t,e){if(t[pe].indexOf(e)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const n=t[pe].indexOf(e);if(n!==-1){const r=ot.visit(Reflect.get(t,Se),n);return Reflect.set(t,e,r),r}}set(t,e,n){const r=t[pe].indexOf(e);return r!==-1?(mt.visit(Reflect.get(t,Se),r,n),Reflect.set(t,e,n)):Reflect.has(t,e)?Reflect.set(t,e,n):!1}}Object.defineProperties(Dn.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[fe]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Se]:{writable:!0,enumerable:!1,configurable:!1,value:null},[fn]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let lr;function Zs(i,t,e,n){const{length:r=0}=i;let s=typeof t!="number"?0:t,o=typeof e!="number"?r:e;return s<0&&(s=(s%r+r)%r),o<0&&(o=(o%r+r)%r),o<s&&(lr=s,s=o,o=lr),o>r&&(o=r),n?n(i,s,o):[s,o]}const Tn=(i,t)=>i<0?t+i:i,ur=i=>i!==i;function De(i){if(typeof i!=="object"||i===null)return ur(i)?ur:e=>e===i;if(i instanceof Date){const e=i.valueOf();return n=>n instanceof Date?n.valueOf()===e:!1}return ArrayBuffer.isView(i)?e=>e?qo(i,e):!1:i instanceof Map?Qa(i):Array.isArray(i)?Ga(i):i instanceof L?Ja(i):Ka(i,!0)}function Ga(i){const t=[];for(let e=-1,n=i.length;++e<n;)t[e]=De(i[e]);return ji(t)}function Qa(i){let t=-1;const e=[];for(const n of i.values())e[++t]=De(n);return ji(e)}function Ja(i){const t=[];for(let e=-1,n=i.length;++e<n;)t[e]=De(i.get(e));return ji(t)}function Ka(i,t=!1){const e=Object.keys(i);if(!t&&e.length===0)return()=>!1;const n=[];for(let r=-1,s=e.length;++r<s;)n[r]=De(i[e[r]]);return ji(n,e)}function ji(i,t){return e=>{if(!e||typeof e!="object")return!1;switch(e.constructor){case Array:return Xa(i,e);case Map:return dr(i,e,e.keys());case Dn:case On:case Object:case void 0:return dr(i,e,t||Object.keys(e))}return e instanceof L?Za(i,e):!1}}function Xa(i,t){const e=i.length;if(t.length!==e)return!1;for(let n=-1;++n<e;)if(!i[n](t[n]))return!1;return!0}function Za(i,t){const e=i.length;if(t.length!==e)return!1;for(let n=-1;++n<e;)if(!i[n](t.get(n)))return!1;return!0}function dr(i,t,e){const n=e[Symbol.iterator](),r=t instanceof Map?t.keys():Object.keys(t)[Symbol.iterator](),s=t instanceof Map?t.values():Object.values(t)[Symbol.iterator]();let o=0;const a=i.length;let c=s.next(),u=n.next(),d=r.next();for(;o<a&&!u.done&&!d.done&&!c.done&&!(u.value!==d.value||!i[o](c.value));++o,u=n.next(),d=r.next(),c=s.next());return o===a&&u.done&&d.done&&c.done?!0:(n.return&&n.return(),r.return&&r.return(),s.return&&s.return(),!1)}function to(i,t,e,n){return(e&1<<n)!==0}function tc(i,t,e,n){return(e&1<<n)>>n}function Ni(i,t,e){const n=e.byteLength+7&-8;if(i>0||e.byteLength<n){const r=new Uint8Array(n);return r.set(i%8===0?e.subarray(i>>3):Fi(new Rn(e,i,t,null,to)).subarray(0,n)),r}return e}function Fi(i){const t=[];let e=0,n=0,r=0;for(const o of i)o&&(r|=1<<n),++n===8&&(t[e++]=r,r=n=0);(e===0||n>0)&&(t[e++]=r);const s=new Uint8Array(t.length+7&-8);return s.set(t),s}class Rn{constructor(t,e,n,r,s){this.bytes=t,this.length=n,this.context=r,this.get=s,this.bit=e%8,this.byteIndex=e>>3,this.byte=t[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function pn(i,t,e){if(e-t<=0)return 0;if(e-t<8){let s=0;for(const o of new Rn(i,t,e-t,i,tc))s+=o;return s}const n=e>>3<<3,r=t+(t%8===0?0:8-t%8);return pn(i,t,r)+pn(i,n,e)+ec(i,r>>3,n-r>>3)}function ec(i,t,e){let n=0,r=Math.trunc(t);const s=new DataView(i.buffer,i.byteOffset,i.byteLength),o=e===void 0?i.byteLength:r+e;for(;o-r>=4;)n+=Ki(s.getUint32(r)),r+=4;for(;o-r>=2;)n+=Ki(s.getUint16(r)),r+=2;for(;o-r>=1;)n+=Ki(s.getUint8(r)),r+=1;return n}function Ki(i){let t=Math.trunc(i);return t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),(t+(t>>>4)&252645135)*16843009>>>24}const ic=-1;class C{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){const{type:t}=this;return f.isSparseUnion(t)?this.children.some(e=>e.nullable):f.isDenseUnion(t)?this.children.some(e=>e.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let t=0;const{valueOffsets:e,values:n,nullBitmap:r,typeIds:s}=this;return e&&(t+=e.byteLength),n&&(t+=n.byteLength),r&&(t+=r.byteLength),s&&(t+=s.byteLength),this.children.reduce((o,a)=>o+a.byteLength,t)}get nullCount(){if(f.isUnion(this.type))return this.children.reduce((n,r)=>n+r.nullCount,0);let t=this._nullCount,e;return t<=ic&&(e=this.nullBitmap)&&(this._nullCount=t=e.length===0?0:this.length-pn(e,this.offset,this.offset+this.length)),t}constructor(t,e,n,r,s,o=[],a){this.type=t,this.children=o,this.dictionary=a,this.offset=Math.floor(Math.max(e||0,0)),this.length=Math.floor(Math.max(n||0,0)),this._nullCount=Math.floor(Math.max(r||0,-1));let c;s instanceof C?(this.stride=s.stride,this.values=s.values,this.typeIds=s.typeIds,this.nullBitmap=s.nullBitmap,this.valueOffsets=s.valueOffsets):(this.stride=Mt(t),s&&((c=s[0])&&(this.valueOffsets=c),(c=s[1])&&(this.values=c),(c=s[2])&&(this.nullBitmap=c),(c=s[3])&&(this.typeIds=c)))}getValid(t){const{type:e}=this;if(f.isUnion(e)){const n=e,r=this.children[n.typeIdToChildIndex[this.typeIds[t]]],s=n.mode===K.Dense?this.valueOffsets[t]:t;return r.getValid(s)}if(this.nullable&&this.nullCount>0){const n=this.offset+t;return(this.nullBitmap[n>>3]&1<<n%8)!==0}return!0}setValid(t,e){let n;const{type:r}=this;if(f.isUnion(r)){const s=r,o=this.children[s.typeIdToChildIndex[this.typeIds[t]]],a=s.mode===K.Dense?this.valueOffsets[t]:t;n=o.getValid(a),o.setValid(a,e)}else{let{nullBitmap:s}=this;const{offset:o,length:a}=this,c=o+t,u=1<<c%8,d=c>>3;(!s||s.byteLength<=d)&&(s=new Uint8Array((o+a+63&-64)>>3).fill(255),this.nullCount>0?(s.set(Ni(o,a,this.nullBitmap),0),Object.assign(this,{nullBitmap:s})):Object.assign(this,{nullBitmap:s,_nullCount:0}));const h=s[d];n=(h&u)!==0,s[d]=e?h|u:h&~u}return n!==!!e&&(this._nullCount=this.nullCount+(e?-1:1)),e}clone(t=this.type,e=this.offset,n=this.length,r=this._nullCount,s=this,o=this.children){return new C(t,e,n,r,s,o,this.dictionary)}slice(t,e){const{stride:n,typeId:r,children:s}=this,o=+(this._nullCount===0)-1,a=r===16?n:1,c=this._sliceBuffers(t,e,n,r);return this.clone(this.type,this.offset+t,e,o,c,s.length===0||this.valueOffsets?s:this._sliceChildren(s,a*t,a*e))}_changeLengthAndBackfillNullBitmap(t){if(this.typeId===l.Null)return this.clone(this.type,0,t,0);const{length:e,nullCount:n}=this,r=new Uint8Array((t+63&-64)>>3).fill(255,0,e>>3);r[e>>3]=(1<<e-(e&-8))-1,n>0&&r.set(Ni(this.offset,e,this.nullBitmap),0);const s=this.buffers;return s[Ut.VALIDITY]=r,this.clone(this.type,0,t,n+(t-e),s)}_sliceBuffers(t,e,n,r){let s;const{buffers:o}=this;return(s=o[Ut.TYPE])&&(o[Ut.TYPE]=s.subarray(t,t+e)),(s=o[Ut.OFFSET])&&(o[Ut.OFFSET]=s.subarray(t,t+e+1))||(s=o[Ut.DATA])&&(o[Ut.DATA]=r===6?s:s.subarray(n*t,n*(t+e))),o}_sliceChildren(t,e,n){return t.map(r=>r.slice(e,n))}}C.prototype.children=Object.freeze([]);class ke extends O{visit(t){return this.getVisitFn(t.type).call(this,t)}visitNull(t){const{["type"]:e,["offset"]:n=0,["length"]:r=0}=t;return new C(e,n,r,r)}visitBool(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.nullBitmap),s=k(e.ArrayType,t.data),{["length"]:o=s.length>>3,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,s,r])}visitInt(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.nullBitmap),s=k(e.ArrayType,t.data),{["length"]:o=s.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,s,r])}visitFloat(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.nullBitmap),s=k(e.ArrayType,t.data),{["length"]:o=s.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,s,r])}visitUtf8(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.data),s=T(t.nullBitmap),o=Te(t.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new C(e,n,a,c,[o,r,s])}visitLargeUtf8(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.data),s=T(t.nullBitmap),o=Xn(t.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new C(e,n,a,c,[o,r,s])}visitBinary(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.data),s=T(t.nullBitmap),o=Te(t.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new C(e,n,a,c,[o,r,s])}visitLargeBinary(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.data),s=T(t.nullBitmap),o=Xn(t.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new C(e,n,a,c,[o,r,s])}visitFixedSizeBinary(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.nullBitmap),s=k(e.ArrayType,t.data),{["length"]:o=s.length/Mt(e),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,s,r])}visitDate(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.nullBitmap),s=k(e.ArrayType,t.data),{["length"]:o=s.length/Mt(e),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,s,r])}visitTimestamp(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.nullBitmap),s=k(e.ArrayType,t.data),{["length"]:o=s.length/Mt(e),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,s,r])}visitTime(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.nullBitmap),s=k(e.ArrayType,t.data),{["length"]:o=s.length/Mt(e),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,s,r])}visitDecimal(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.nullBitmap),s=k(e.ArrayType,t.data),{["length"]:o=s.length/Mt(e),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,s,r])}visitList(t){const{["type"]:e,["offset"]:n=0,["child"]:r}=t,s=T(t.nullBitmap),o=Te(t.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new C(e,n,a,c,[o,void 0,s],[r])}visitStruct(t){const{["type"]:e,["offset"]:n=0,["children"]:r=[]}=t,s=T(t.nullBitmap),{length:o=r.reduce((c,{length:u})=>Math.max(c,u),0),nullCount:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,void 0,s],r)}visitUnion(t){const{["type"]:e,["offset"]:n=0,["children"]:r=[]}=t,s=k(e.ArrayType,t.typeIds),{["length"]:o=s.length,["nullCount"]:a=-1}=t;if(f.isSparseUnion(e))return new C(e,n,o,a,[void 0,void 0,void 0,s],r);const c=Te(t.valueOffsets);return new C(e,n,o,a,[c,void 0,void 0,s],r)}visitDictionary(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.nullBitmap),s=k(e.indices.ArrayType,t.data),{["dictionary"]:o=new L([new ke().visit({type:e.dictionary})])}=t,{["length"]:a=s.length,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new C(e,n,a,c,[void 0,s,r],[],o)}visitInterval(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.nullBitmap),s=k(e.ArrayType,t.data),{["length"]:o=s.length/Mt(e),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,s,r])}visitDuration(t){const{["type"]:e,["offset"]:n=0}=t,r=T(t.nullBitmap),s=k(e.ArrayType,t.data),{["length"]:o=s.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,s,r])}visitFixedSizeList(t){const{["type"]:e,["offset"]:n=0,["child"]:r=new ke().visit({type:e.valueType})}=t,s=T(t.nullBitmap),{["length"]:o=r.length/Mt(e),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new C(e,n,o,a,[void 0,void 0,s],[r])}visitMap(t){const{["type"]:e,["offset"]:n=0,["child"]:r=new ke().visit({type:e.childType})}=t,s=T(t.nullBitmap),o=Te(t.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new C(e,n,a,c,[o,void 0,s],[r])}}const nc=new ke;function D(i){return nc.visit(i)}class hr{constructor(t=0,e){this.numChunks=t,this.getChunkIterator=e,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const t=this.chunkIterator.next();if(!t.done)return t;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function rc(i){return i.some(t=>t.nullable)}function eo(i){return i.reduce((t,e)=>t+e.nullCount,0)}function io(i){return i.reduce((t,e,n)=>(t[n+1]=t[n]+e.length,t),new Uint32Array(i.length+1))}function no(i,t,e,n){const r=[];for(let s=-1,o=i.length;++s<o;){const a=i[s],c=t[s],{length:u}=a;if(c>=n)break;if(e>=c+u)continue;if(c>=e&&c+u<=n){r.push(a);continue}const d=Math.max(0,e-c),h=Math.min(n-c,u);r.push(a.slice(d,h-d))}return r.length===0&&r.push(i[0].slice(0,0)),r}function Nn(i,t,e,n){let r=0,s=0,o=t.length-1;do{if(r>=o-1)return e<t[o]?n(i,r,e-t[r]):null;s=r+Math.trunc((o-r)*.5),e<t[s]?o=s:r=s}while(r<o)}function Fn(i,t){return i.getValid(t)}function Li(i){function t(e,n,r){return i(e[n],r)}return function(e){const n=this.data;return Nn(n,this._offsets,e,t)}}function ro(i){let t;function e(n,r,s){return i(n[r],s,t)}return function(n,r){const s=this.data;t=r;const o=Nn(s,this._offsets,n,e);return t=void 0,o}}function so(i){let t;function e(n,r,s){let o=s,a=0,c=0;for(let u=r-1,d=n.length;++u<d;){const h=n[u];if(~(a=i(h,t,o)))return c+a;o=0,c+=h.length}return-1}return function(n,r){t=n;const s=this.data,o=typeof r!="number"?e(s,0,0):Nn(s,this._offsets,r,e);return t=void 0,o}}class y extends O{}function sc(i,t){return t===null&&i.length>0?0:-1}function oc(i,t){const{nullBitmap:e}=i;if(!e||i.nullCount<=0)return-1;let n=0;for(const r of new Rn(e,i.offset+(t||0),i.length,e,to)){if(!r)return n;++n}return-1}function v(i,t,e){if(t===void 0)return-1;if(t===null)switch(i.typeId){case l.Union:break;case l.Dictionary:break;default:return oc(i,e)}const n=ot.getVisitFn(i),r=De(t);for(let s=(e||0)-1,o=i.length;++s<o;)if(r(n(i,s)))return s;return-1}function oo(i,t,e){const n=ot.getVisitFn(i),r=De(t);for(let s=(e||0)-1,o=i.length;++s<o;)if(r(n(i,s)))return s;return-1}y.prototype.visitNull=sc;y.prototype.visitBool=v;y.prototype.visitInt=v;y.prototype.visitInt8=v;y.prototype.visitInt16=v;y.prototype.visitInt32=v;y.prototype.visitInt64=v;y.prototype.visitUint8=v;y.prototype.visitUint16=v;y.prototype.visitUint32=v;y.prototype.visitUint64=v;y.prototype.visitFloat=v;y.prototype.visitFloat16=v;y.prototype.visitFloat32=v;y.prototype.visitFloat64=v;y.prototype.visitUtf8=v;y.prototype.visitLargeUtf8=v;y.prototype.visitBinary=v;y.prototype.visitLargeBinary=v;y.prototype.visitFixedSizeBinary=v;y.prototype.visitDate=v;y.prototype.visitDateDay=v;y.prototype.visitDateMillisecond=v;y.prototype.visitTimestamp=v;y.prototype.visitTimestampSecond=v;y.prototype.visitTimestampMillisecond=v;y.prototype.visitTimestampMicrosecond=v;y.prototype.visitTimestampNanosecond=v;y.prototype.visitTime=v;y.prototype.visitTimeSecond=v;y.prototype.visitTimeMillisecond=v;y.prototype.visitTimeMicrosecond=v;y.prototype.visitTimeNanosecond=v;y.prototype.visitDecimal=v;y.prototype.visitList=v;y.prototype.visitStruct=v;y.prototype.visitUnion=v;y.prototype.visitDenseUnion=oo;y.prototype.visitSparseUnion=oo;y.prototype.visitDictionary=v;y.prototype.visitInterval=v;y.prototype.visitIntervalDayTime=v;y.prototype.visitIntervalYearMonth=v;y.prototype.visitDuration=v;y.prototype.visitDurationSecond=v;y.prototype.visitDurationMillisecond=v;y.prototype.visitDurationMicrosecond=v;y.prototype.visitDurationNanosecond=v;y.prototype.visitFixedSizeList=v;y.prototype.visitMap=v;const Ui=new y;class g extends O{}function S(i){const{type:t}=i;if(i.nullCount===0&&i.stride===1&&(f.isInt(t)&&t.bitWidth!==64||f.isTime(t)&&t.bitWidth!==64||f.isFloat(t)&&t.precision!==J.HALF))return new hr(i.data.length,n=>{const r=i.data[n];return r.values.subarray(0,r.length)[Symbol.iterator]()});let e=0;return new hr(i.data.length,n=>{const s=i.data[n].length,o=i.slice(e,e+s);return e+=s,new ac(o)})}class ac{constructor(t){this.vector=t,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}g.prototype.visitNull=S;g.prototype.visitBool=S;g.prototype.visitInt=S;g.prototype.visitInt8=S;g.prototype.visitInt16=S;g.prototype.visitInt32=S;g.prototype.visitInt64=S;g.prototype.visitUint8=S;g.prototype.visitUint16=S;g.prototype.visitUint32=S;g.prototype.visitUint64=S;g.prototype.visitFloat=S;g.prototype.visitFloat16=S;g.prototype.visitFloat32=S;g.prototype.visitFloat64=S;g.prototype.visitUtf8=S;g.prototype.visitLargeUtf8=S;g.prototype.visitBinary=S;g.prototype.visitLargeBinary=S;g.prototype.visitFixedSizeBinary=S;g.prototype.visitDate=S;g.prototype.visitDateDay=S;g.prototype.visitDateMillisecond=S;g.prototype.visitTimestamp=S;g.prototype.visitTimestampSecond=S;g.prototype.visitTimestampMillisecond=S;g.prototype.visitTimestampMicrosecond=S;g.prototype.visitTimestampNanosecond=S;g.prototype.visitTime=S;g.prototype.visitTimeSecond=S;g.prototype.visitTimeMillisecond=S;g.prototype.visitTimeMicrosecond=S;g.prototype.visitTimeNanosecond=S;g.prototype.visitDecimal=S;g.prototype.visitList=S;g.prototype.visitStruct=S;g.prototype.visitUnion=S;g.prototype.visitDenseUnion=S;g.prototype.visitSparseUnion=S;g.prototype.visitDictionary=S;g.prototype.visitInterval=S;g.prototype.visitIntervalDayTime=S;g.prototype.visitIntervalYearMonth=S;g.prototype.visitDuration=S;g.prototype.visitDurationSecond=S;g.prototype.visitDurationMillisecond=S;g.prototype.visitDurationMicrosecond=S;g.prototype.visitDurationNanosecond=S;g.prototype.visitFixedSizeList=S;g.prototype.visitMap=S;const Ln=new g;var ao;const co={},lo={};class L{constructor(t){var e,n,r;const s=t[0]instanceof L?t.flatMap(a=>a.data):t;if(s.length===0||s.some(a=>!(a instanceof C)))throw new TypeError("Vector constructor expects an Array of Data instances.");const o=(e=s[0])===null||e===void 0?void 0:e.type;switch(s.length){case 0:this._offsets=[0];break;case 1:{const{get:a,set:c,indexOf:u}=co[o.typeId],d=s[0];this.isValid=h=>Fn(d,h),this.get=h=>a(d,h),this.set=(h,F)=>c(d,h,F),this.indexOf=h=>u(d,h),this._offsets=[0,d.length];break}default:Object.setPrototypeOf(this,lo[o.typeId]),this._offsets=io(s);break}this.data=s,this.type=o,this.stride=Mt(o),this.numChildren=(r=(n=o.children)===null||n===void 0?void 0:n.length)!==null&&r!==void 0?r:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((t,e)=>t+e.byteLength,0)}get nullable(){return rc(this.data)}get nullCount(){return eo(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${l[this.type.typeId]}Vector`}isValid(t){return!1}get(t){return null}at(t){return this.get(Tn(t,this.length))}set(t,e){}indexOf(t,e){return-1}includes(t,e){return this.indexOf(t,e)>-1}[Symbol.iterator](){return Ln.visit(this)}concat(...t){return new L(this.data.concat(t.flatMap(e=>e.data).flat(Number.POSITIVE_INFINITY)))}slice(t,e){return new L(Zs(this,t,e,({data:n,_offsets:r},s,o)=>no(n,r,s,o)))}toJSON(){return[...this]}toArray(){const{type:t,data:e,length:n,stride:r,ArrayType:s}=this;switch(t.typeId){case l.Int:case l.Float:case l.Decimal:case l.Time:case l.Timestamp:switch(e.length){case 0:return new s;case 1:return e[0].values.subarray(0,n*r);default:return e.reduce((o,{values:a,length:c})=>(o.array.set(a.subarray(0,c*r),o.offset),o.offset+=c*r,o),{array:new s(n*r),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(t){var e;return this.getChildAt((e=this.type.children)===null||e===void 0?void 0:e.findIndex(n=>n.name===t))}getChildAt(t){return t>-1&&t<this.numChildren?new L(this.data.map(({children:e})=>e[t])):null}get isMemoized(){return f.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(f.isDictionary(this.type)){const t=new Mi(this.data[0].dictionary),e=this.data.map(n=>{const r=n.clone();return r.dictionary=t,r});return new L(e)}return new Mi(this)}unmemoize(){if(f.isDictionary(this.type)&&this.isMemoized){const t=this.data[0].dictionary.unmemoize(),e=this.data.map(n=>{const r=n.clone();return r.dictionary=t,r});return new L(e)}return this}}ao=Symbol.toStringTag;L[ao]=(i=>{i.type=f.prototype,i.data=[],i.length=0,i.stride=1,i.numChildren=0,i._offsets=new Uint32Array([0]),i[Symbol.isConcatSpreadable]=!0;const t=Object.keys(l).map(e=>l[e]).filter(e=>typeof e=="number"&&e!==l.NONE);for(const e of t){const n=ot.getVisitFnByTypeId(e),r=mt.getVisitFnByTypeId(e),s=Ui.getVisitFnByTypeId(e);co[e]={get:n,set:r,indexOf:s},lo[e]=Object.create(i,{isValid:{value:Li(Fn)},get:{value:Li(ot.getVisitFnByTypeId(e))},set:{value:ro(mt.getVisitFnByTypeId(e))},indexOf:{value:so(Ui.getVisitFnByTypeId(e))}})}return"Vector"})(L.prototype);class Mi extends L{constructor(t){super(t.data);const e=this.get,n=this.set,r=this.slice,s=new Array(this.length);Object.defineProperty(this,"get",{value(o){const a=s[o];if(a!==void 0)return a;const c=e.call(this,o);return s[o]=c,c}}),Object.defineProperty(this,"set",{value(o,a){n.call(this,o,a),s[o]=a}}),Object.defineProperty(this,"slice",{value:(o,a)=>new Mi(r.call(this,o,a))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new L(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}class yn{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,e,n,r){return t.prep(8,24),t.writeInt64(BigInt(r??0)),t.pad(4),t.writeInt32(n),t.writeInt64(BigInt(e??0)),t.offset()}}class at{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFooter(t,e){return(e||new at).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,e){return t.setPosition(t.position()+M),(e||new at).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):q.V1}schema(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new It).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}dictionaries(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new yn).__init(this.bb.__vector(this.bb_pos+n)+t*24,this.bb):null}dictionariesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,e){const n=this.bb.__offset(this.bb_pos,10);return n?(e||new yn).__init(this.bb.__vector(this.bb_pos+n)+t*24,this.bb):null}recordBatchesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,12);return n?(e||new G).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,q.V1)}static addSchema(t,e){t.addFieldOffset(1,e,0)}static addDictionaries(t,e){t.addFieldOffset(2,e,0)}static startDictionariesVector(t,e){t.startVector(24,e,8)}static addRecordBatches(t,e){t.addFieldOffset(3,e,0)}static startRecordBatchesVector(t,e){t.startVector(24,e,8)}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endFooter(t){return t.endObject()}static finishFooterBuffer(t,e){t.finish(e)}static finishSizePrefixedFooterBuffer(t,e){t.finish(e,void 0,!0)}}class U{constructor(t=[],e,n,r=q.V5){this.fields=t||[],this.metadata=e||new Map,n||(n=gn(this.fields)),this.dictionaries=n,this.metadataVersion=r}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(t=>t.name)}toString(){return`Schema<{ ${this.fields.map((t,e)=>`${e}: ${t}`).join(", ")} }>`}select(t){const e=new Set(t),n=this.fields.filter(r=>e.has(r.name));return new U(n,this.metadata)}selectAt(t){const e=t.map(n=>this.fields[n]).filter(Boolean);return new U(e,this.metadata)}assign(...t){const e=t[0]instanceof U?t[0]:Array.isArray(t[0])?new U(t[0]):new U(t),n=[...this.fields],r=Xe(Xe(new Map,this.metadata),e.metadata),s=e.fields.filter(a=>{const c=n.findIndex(u=>u.name===a.name);return~c?(n[c]=a.clone({metadata:Xe(Xe(new Map,n[c].metadata),a.metadata)}))&&!1:!0}),o=gn(s,new Map);return new U([...n,...s],r,new Map([...this.dictionaries,...o]))}}U.prototype.fields=null;U.prototype.metadata=null;U.prototype.dictionaries=null;class z{static new(...t){let[e,n,r,s]=t;return t[0]&&typeof t[0]=="object"&&({name:e}=t[0],n===void 0&&(n=t[0].type),r===void 0&&(r=t[0].nullable),s===void 0&&(s=t[0].metadata)),new z(`${e}`,n,r,s)}constructor(t,e,n=!1,r){this.name=t,this.type=e,this.nullable=n,this.metadata=r||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...t){let[e,n,r,s]=t;return!t[0]||typeof t[0]!="object"?[e=this.name,n=this.type,r=this.nullable,s=this.metadata]=t:{name:e=this.name,type:n=this.type,nullable:r=this.nullable,metadata:s=this.metadata}=t[0],z.new(e,n,r,s)}}z.prototype.type=null;z.prototype.name=null;z.prototype.nullable=null;z.prototype.metadata=null;function Xe(i,t){return new Map([...i||new Map,...t||new Map])}function gn(i,t=new Map){for(let e=-1,n=i.length;++e<n;){const s=i[e].type;if(f.isDictionary(s)){if(!t.has(s.id))t.set(s.id,s.dictionary);else if(t.get(s.id)!==s.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}s.children&&s.children.length>0&&gn(s.children,t)}return t}var cc=Lr,lc=Ie;class je{static decode(t){t=new lc(T(t));const e=at.getRootAsFooter(t),n=U.decode(e.schema(),new Map,e.version());return new uc(n,e)}static encode(t){const e=new cc,n=U.encode(e,t.schema);at.startRecordBatchesVector(e,t.numRecordBatches);for(const o of[...t.recordBatches()].slice().reverse())Yt.encode(e,o);const r=e.endVector();at.startDictionariesVector(e,t.numDictionaries);for(const o of[...t.dictionaryBatches()].slice().reverse())Yt.encode(e,o);const s=e.endVector();return at.startFooter(e),at.addSchema(e,n),at.addVersion(e,q.V5),at.addRecordBatches(e,r),at.addDictionaries(e,s),at.finishFooterBuffer(e,at.endFooter(e)),e.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(t,e=q.V5,n,r){this.schema=t,this.version=e,n&&(this._recordBatches=n),r&&(this._dictionaryBatches=r)}*recordBatches(){for(let t,e=-1,n=this.numRecordBatches;++e<n;)(t=this.getRecordBatch(e))&&(yield t)}*dictionaryBatches(){for(let t,e=-1,n=this.numDictionaries;++e<n;)(t=this.getDictionaryBatch(e))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}}class uc extends je{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(t,e){super(t,e.version()),this._footer=e}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){const e=this._footer.recordBatches(t);if(e)return Yt.decode(e)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){const e=this._footer.dictionaries(t);if(e)return Yt.decode(e)}return null}}class Yt{static decode(t){return new Yt(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,e){const{metaDataLength:n}=e,r=BigInt(e.offset),s=BigInt(e.bodyLength);return yn.createBlock(t,r,n,s)}constructor(t,e,n){this.metaDataLength=t,this.offset=P(n),this.bodyLength=P(e)}}const j=Object.freeze({done:!0,value:void 0});class fr{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class Un{tee(){return this._getDOMStream().tee()}pipe(t,e){return this._getNodeStream().pipe(t,e)}pipeTo(t,e){return this._getDOMStream().pipeTo(t,e)}pipeThrough(t,e){return this._getDOMStream().pipeThrough(t,e)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class dc extends Un{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}get closed(){return this._closedPromise}cancel(t){return E(this,void 0,void 0,function*(){yield this.return(t)})}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){const{resolvers:t}=this;for(;t.length>0;)t.shift().resolve(j);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return ht.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return ht.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return E(this,void 0,void 0,function*(){return yield this.abort(t),j})}return(t){return E(this,void 0,void 0,function*(){return yield this.close(),j})}read(t){return E(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return E(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((e,n)=>{this.resolvers.push({resolve:e,reject:n})}):Promise.resolve(j)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class ai extends dc{write(t){if((t=T(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?an(this.toUint8Array(!0)):this.toUint8Array(!1).then(an)}toUint8Array(t=!1){return t?Tt(this._values)[0]:E(this,void 0,void 0,function*(){var e,n,r,s;const o=[];let a=0;try{for(var c=!0,u=Zt(this),d;d=yield u.next(),e=d.done,!e;c=!0){s=d.value,c=!1;const h=s;o.push(h),a+=h.byteLength}}catch(h){n={error:h}}finally{try{!c&&!e&&(r=u.return)&&(yield r.call(u))}finally{if(n)throw n.error}}return Tt(o,a)[0]})}}class Ci{constructor(t){t&&(this.source=new hc(ht.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class Be{constructor(t){t instanceof Be?this.source=t.source:t instanceof ai?this.source=new Kt(ht.fromAsyncIterable(t)):Tr(t)?this.source=new Kt(ht.fromNodeStream(t)):vn(t)?this.source=new Kt(ht.fromDOMStream(t)):Dr(t)?this.source=new Kt(ht.fromDOMStream(t.body)):qe(t)?this.source=new Kt(ht.fromIterable(t)):te(t)?this.source=new Kt(ht.fromAsyncIterable(t)):Oe(t)&&(this.source=new Kt(ht.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class hc{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,e="read"){return this.source.next({cmd:e,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||j)}return(t){return Object.create(this.source.return&&this.source.return(t)||j)}}class Kt{constructor(t){this.source=t,this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}cancel(t){return E(this,void 0,void 0,function*(){yield this.return(t)})}get closed(){return this._closedPromise}read(t){return E(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return E(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(t){return E(this,arguments,void 0,function*(e,n="read"){return yield this.source.next({cmd:n,size:e})})}throw(t){return E(this,void 0,void 0,function*(){const e=this.source.throw&&(yield this.source.throw(t))||j;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)})}return(t){return E(this,void 0,void 0,function*(){const e=this.source.return&&(yield this.source.return(t))||j;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)})}}class pr extends Ci{constructor(t,e){super(),this.position=0,this.buffer=T(t),this.size=e===void 0?this.buffer.byteLength:e}readInt32(t){const{buffer:e,byteOffset:n}=this.readAt(t,4);return new DataView(e,n).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){const{buffer:e,size:n,position:r}=this;return e&&r<n?(typeof t!="number"&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(n,r+Math.min(n-r,t)),e.subarray(r,this.position)):null}readAt(t,e){const n=this.buffer,r=Math.min(this.size,t+e);return n?n.subarray(t,r):new Uint8Array(e)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}}class xi extends Be{constructor(t,e){super(),this.position=0,this._handle=t,typeof e=="number"?this.size=e:this._pending=E(this,void 0,void 0,function*(){this.size=(yield t.stat()).size,delete this._pending})}readInt32(t){return E(this,void 0,void 0,function*(){const{buffer:e,byteOffset:n}=yield this.readAt(t,4);return new DataView(e,n).getInt32(0,!0)})}seek(t){return E(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size})}read(t){return E(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:e,size:n,position:r}=this;if(e&&r<n){typeof t!="number"&&(t=Number.POSITIVE_INFINITY);let s=r,o=0,a=0;const c=Math.min(n,s+Math.min(n-s,t)),u=new Uint8Array(Math.max(0,(this.position=c)-s));for(;(s+=a)<c&&(o+=a)<u.byteLength;)({bytesRead:a}=yield e.read(u,o,u.byteLength-o,s));return u}return null})}readAt(t,e){return E(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:n,size:r}=this;if(n&&t+e<r){const s=Math.min(r,t+e),o=new Uint8Array(s-t);return(yield n.read(o,0,e,t)).buffer}return new Uint8Array(e)})}close(){return E(this,void 0,void 0,function*(){const t=this._handle;this._handle=null,t&&(yield t.close())})}throw(t){return E(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}return(t){return E(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}}const fc=65536;function ye(i){return i<0&&(i=4294967295+i+1),`0x${i.toString(16)}`}const Ae=8,Mn=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class uo{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){const e=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),n=new Uint32Array([t.buffer[1]>>>16,t.buffer[1]&65535,t.buffer[0]>>>16,t.buffer[0]&65535]);let r=e[3]*n[3];this.buffer[0]=r&65535;let s=r>>>16;return r=e[2]*n[3],s+=r,r=e[3]*n[2]>>>0,s+=r,this.buffer[0]+=s<<16,this.buffer[1]=s>>>0<r?fc:0,this.buffer[1]+=s>>>16,this.buffer[1]+=e[1]*n[3]+e[2]*n[2]+e[3]*n[1],this.buffer[1]+=e[0]*n[3]+e[1]*n[2]+e[2]*n[1]+e[3]*n[0]<<16,this}_plus(t){const e=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],e<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=e}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${ye(this.buffer[1])} ${ye(this.buffer[0])}`}}class x extends uo{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,e=new Uint32Array(2)){return x.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return x.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const n=t.length,r=new x(e);for(let s=0;s<n;){const o=Ae<n-s?Ae:n-s,a=new x(new Uint32Array([Number.parseInt(t.slice(s,s+o),10),0])),c=new x(new Uint32Array([Mn[o],0]));r.times(c),r.plus(a),s+=o}return r}static convertArray(t){const e=new Uint32Array(t.length*2);for(let n=-1,r=t.length;++n<r;)x.from(t[n],new Uint32Array(e.buffer,e.byteOffset+2*n*4,2));return e}static multiply(t,e){return new x(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new x(new Uint32Array(t.buffer)).plus(e)}}class it extends uo{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){const e=this.buffer[1]<<0,n=t.buffer[1]<<0;return e<n||e===n&&this.buffer[0]<t.buffer[0]}static from(t,e=new Uint32Array(2)){return it.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return it.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const n=t.startsWith("-"),r=t.length,s=new it(e);for(let o=n?1:0;o<r;){const a=Ae<r-o?Ae:r-o,c=new it(new Uint32Array([Number.parseInt(t.slice(o,o+a),10),0])),u=new it(new Uint32Array([Mn[a],0]));s.times(u),s.plus(c),o+=a}return n?s.negate():s}static convertArray(t){const e=new Uint32Array(t.length*2);for(let n=-1,r=t.length;++n<r;)it.from(t[n],new Uint32Array(e.buffer,e.byteOffset+2*n*4,2));return e}static multiply(t,e){return new it(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new it(new Uint32Array(t.buffer)).plus(e)}}class vt{constructor(t){this.buffer=t}high(){return new it(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new it(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(t){const e=new x(new Uint32Array([this.buffer[3],0])),n=new x(new Uint32Array([this.buffer[2],0])),r=new x(new Uint32Array([this.buffer[1],0])),s=new x(new Uint32Array([this.buffer[0],0])),o=new x(new Uint32Array([t.buffer[3],0])),a=new x(new Uint32Array([t.buffer[2],0])),c=new x(new Uint32Array([t.buffer[1],0])),u=new x(new Uint32Array([t.buffer[0],0]));let d=x.multiply(s,u);this.buffer[0]=d.low();const h=new x(new Uint32Array([d.high(),0]));return d=x.multiply(r,u),h.plus(d),d=x.multiply(s,c),h.plus(d),this.buffer[1]=h.low(),this.buffer[3]=h.lessThan(d)?1:0,this.buffer[2]=h.high(),new x(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(x.multiply(n,u)).plus(x.multiply(r,c)).plus(x.multiply(s,a)),this.buffer[3]+=x.multiply(e,u).plus(x.multiply(n,c)).plus(x.multiply(r,a)).plus(x.multiply(s,o)).low(),this}plus(t){const e=new Uint32Array(4);return e[3]=this.buffer[3]+t.buffer[3]>>>0,e[2]=this.buffer[2]+t.buffer[2]>>>0,e[1]=this.buffer[1]+t.buffer[1]>>>0,e[0]=this.buffer[0]+t.buffer[0]>>>0,e[0]<this.buffer[0]>>>0&&++e[1],e[1]<this.buffer[1]>>>0&&++e[2],e[2]<this.buffer[2]>>>0&&++e[3],this.buffer[3]=e[3],this.buffer[2]=e[2],this.buffer[1]=e[1],this.buffer[0]=e[0],this}hex(){return`${ye(this.buffer[3])} ${ye(this.buffer[2])} ${ye(this.buffer[1])} ${ye(this.buffer[0])}`}static multiply(t,e){return new vt(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new vt(new Uint32Array(t.buffer)).plus(e)}static from(t,e=new Uint32Array(4)){return vt.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(4)){return vt.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(4)){const n=t.startsWith("-"),r=t.length,s=new vt(e);for(let o=n?1:0;o<r;){const a=Ae<r-o?Ae:r-o,c=new vt(new Uint32Array([Number.parseInt(t.slice(o,o+a),10),0,0,0])),u=new vt(new Uint32Array([Mn[a],0,0,0]));s.times(u),s.plus(c),o+=a}return n?s.negate():s}static convertArray(t){const e=new Uint32Array(t.length*4);for(let n=-1,r=t.length;++n<r;)vt.from(t[n],new Uint32Array(e.buffer,e.byteOffset+4*4*n,4));return e}}class ho extends O{constructor(t,e,n,r,s=q.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=e,this.buffers=n,this.dictionaries=r,this.metadataVersion=s}visit(t){return super.visit(t instanceof z?t.type:t)}visitNull(t,{length:e}=this.nextFieldNode()){return D({type:t,length:e})}visitBool(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitInt(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFloat(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitUtf8(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeUtf8(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeBinary(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDate(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTimestamp(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTime(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDecimal(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitList(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),children:this.visitMany(t.children)})}visitUnion(t,{length:e,nullCount:n}=this.nextFieldNode()){return this.metadataVersion<q.V5&&this.readNullBitmap(t,n),t.mode===K.Sparse?this.visitSparseUnion(t,{length:e,nullCount:n}):this.visitDenseUnion(t,{length:e,nullCount:n})}visitDenseUnion(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDuration(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFixedSizeList(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),child:this.visit(t.children[0])})}visitMap(t,{length:e,nullCount:n}=this.nextFieldNode()){return D({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,e,n=this.nextBufferRange()){return e>0&&this.readData(t,n)||new Uint8Array(0)}readOffsets(t,e){return this.readData(t,e)}readTypeIds(t,e){return this.readData(t,e)}readData(t,{length:e,offset:n}=this.nextBufferRange()){return this.bytes.subarray(n,n+e)}readDictionary(t){return this.dictionaries.get(t.id)}}class pc extends ho{constructor(t,e,n,r,s){super(new Uint8Array(0),e,n,r,s),this.sources=t}readNullBitmap(t,e,{offset:n}=this.nextBufferRange()){return e<=0?new Uint8Array(0):Fi(this.sources[n])}readOffsets(t,{offset:e}=this.nextBufferRange()){return k(Uint8Array,k(t.OffsetArrayType,this.sources[e]))}readTypeIds(t,{offset:e}=this.nextBufferRange()){return k(Uint8Array,k(t.ArrayType,this.sources[e]))}readData(t,{offset:e}=this.nextBufferRange()){const{sources:n}=this;return f.isTimestamp(t)||(f.isInt(t)||f.isTime(t))&&t.bitWidth===64||f.isDuration(t)||f.isDate(t)&&t.unit===gt.MILLISECOND?k(Uint8Array,it.convertArray(n[e])):f.isDecimal(t)?k(Uint8Array,vt.convertArray(n[e])):f.isBinary(t)||f.isLargeBinary(t)||f.isFixedSizeBinary(t)?yc(n[e]):f.isBool(t)?Fi(n[e]):f.isUtf8(t)||f.isLargeUtf8(t)?In(n[e].join("")):k(Uint8Array,k(t.ArrayType,n[e].map(r=>+r)))}}function yc(i){const t=i.join(""),e=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2)e[n>>1]=Number.parseInt(t.slice(n,n+2),16);return e}class m extends O{compareSchemas(t,e){return t===e||e instanceof t.constructor&&this.compareManyFields(t.fields,e.fields)}compareManyFields(t,e){return t===e||Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((n,r)=>this.compareFields(n,e[r]))}compareFields(t,e){return t===e||e instanceof t.constructor&&t.name===e.name&&t.nullable===e.nullable&&this.visit(t.type,e.type)}}function et(i,t){return t instanceof i.constructor}function ie(i,t){return i===t||et(i,t)}function Pt(i,t){return i===t||et(i,t)&&i.bitWidth===t.bitWidth&&i.isSigned===t.isSigned}function Wi(i,t){return i===t||et(i,t)&&i.precision===t.precision}function gc(i,t){return i===t||et(i,t)&&i.byteWidth===t.byteWidth}function Cn(i,t){return i===t||et(i,t)&&i.unit===t.unit}function He(i,t){return i===t||et(i,t)&&i.unit===t.unit&&i.timezone===t.timezone}function Ye(i,t){return i===t||et(i,t)&&i.unit===t.unit&&i.bitWidth===t.bitWidth}function mc(i,t){return i===t||et(i,t)&&i.children.length===t.children.length&&Gt.compareManyFields(i.children,t.children)}function _c(i,t){return i===t||et(i,t)&&i.children.length===t.children.length&&Gt.compareManyFields(i.children,t.children)}function xn(i,t){return i===t||et(i,t)&&i.mode===t.mode&&i.typeIds.every((e,n)=>e===t.typeIds[n])&&Gt.compareManyFields(i.children,t.children)}function bc(i,t){return i===t||et(i,t)&&i.id===t.id&&i.isOrdered===t.isOrdered&&Gt.visit(i.indices,t.indices)&&Gt.visit(i.dictionary,t.dictionary)}function kn(i,t){return i===t||et(i,t)&&i.unit===t.unit}function Ge(i,t){return i===t||et(i,t)&&i.unit===t.unit}function wc(i,t){return i===t||et(i,t)&&i.listSize===t.listSize&&i.children.length===t.children.length&&Gt.compareManyFields(i.children,t.children)}function Sc(i,t){return i===t||et(i,t)&&i.keysSorted===t.keysSorted&&i.children.length===t.children.length&&Gt.compareManyFields(i.children,t.children)}m.prototype.visitNull=ie;m.prototype.visitBool=ie;m.prototype.visitInt=Pt;m.prototype.visitInt8=Pt;m.prototype.visitInt16=Pt;m.prototype.visitInt32=Pt;m.prototype.visitInt64=Pt;m.prototype.visitUint8=Pt;m.prototype.visitUint16=Pt;m.prototype.visitUint32=Pt;m.prototype.visitUint64=Pt;m.prototype.visitFloat=Wi;m.prototype.visitFloat16=Wi;m.prototype.visitFloat32=Wi;m.prototype.visitFloat64=Wi;m.prototype.visitUtf8=ie;m.prototype.visitLargeUtf8=ie;m.prototype.visitBinary=ie;m.prototype.visitLargeBinary=ie;m.prototype.visitFixedSizeBinary=gc;m.prototype.visitDate=Cn;m.prototype.visitDateDay=Cn;m.prototype.visitDateMillisecond=Cn;m.prototype.visitTimestamp=He;m.prototype.visitTimestampSecond=He;m.prototype.visitTimestampMillisecond=He;m.prototype.visitTimestampMicrosecond=He;m.prototype.visitTimestampNanosecond=He;m.prototype.visitTime=Ye;m.prototype.visitTimeSecond=Ye;m.prototype.visitTimeMillisecond=Ye;m.prototype.visitTimeMicrosecond=Ye;m.prototype.visitTimeNanosecond=Ye;m.prototype.visitDecimal=ie;m.prototype.visitList=mc;m.prototype.visitStruct=_c;m.prototype.visitUnion=xn;m.prototype.visitDenseUnion=xn;m.prototype.visitSparseUnion=xn;m.prototype.visitDictionary=bc;m.prototype.visitInterval=kn;m.prototype.visitIntervalDayTime=kn;m.prototype.visitIntervalYearMonth=kn;m.prototype.visitDuration=Ge;m.prototype.visitDurationSecond=Ge;m.prototype.visitDurationMillisecond=Ge;m.prototype.visitDurationMicrosecond=Ge;m.prototype.visitDurationNanosecond=Ge;m.prototype.visitFixedSizeList=wc;m.prototype.visitMap=Sc;const Gt=new m;function mn(i,t){return Gt.compareSchemas(i,t)}function Xi(i,t){return Ic(i,t.map(e=>e.data.concat()))}function Ic(i,t){const e=[...i.fields],n=[],r={numBatches:t.reduce((h,F)=>Math.max(h,F.length),0)};let s=0,o=0,a=-1;const c=t.length;let u,d=[];for(;r.numBatches-- >0;){for(o=Number.POSITIVE_INFINITY,a=-1;++a<c;)d[a]=u=t[a].shift(),o=Math.min(o,u?u.length:o);Number.isFinite(o)&&(d=vc(e,o,d,t,r),o>0&&(n[s++]=D({type:new Z(e),length:o,nullCount:0,children:d.slice()})))}return[i=i.assign(e),n.map(h=>new rt(i,h))]}function vc(i,t,e,n,r){var s;const o=(t+63&-64)>>3;for(let a=-1,c=n.length;++a<c;){const u=e[a],d=u==null?void 0:u.length;if(d>=t)d===t?e[a]=u:(e[a]=u.slice(0,t),r.numBatches=Math.max(r.numBatches,n[a].unshift(u.slice(t,d-t))));else{const h=i[a];i[a]=h.clone({nullable:!0}),e[a]=(s=u==null?void 0:u._changeLengthAndBackfillNullBitmap(t))!==null&&s!==void 0?s:D({type:h.type,length:t,nullCount:t,nullBitmap:new Uint8Array(o)})}}return e}var fo;class X{constructor(...t){var e,n;if(t.length===0)return this.batches=[],this.schema=new U([]),this._offsets=[0],this;let r,s;t[0]instanceof U&&(r=t.shift()),t.at(-1)instanceof Uint32Array&&(s=t.pop());const o=c=>{if(c){if(c instanceof rt)return[c];if(c instanceof X)return c.batches;if(c instanceof C){if(c.type instanceof Z)return[new rt(new U(c.type.children),c)]}else{if(Array.isArray(c))return c.flatMap(u=>o(u));if(typeof c[Symbol.iterator]=="function")return[...c].flatMap(u=>o(u));if(typeof c=="object"){const u=Object.keys(c),d=u.map(B=>new L([c[B]])),h=r??new U(u.map((B,H)=>new z(String(B),d[H].type,d[H].nullable))),[,F]=Xi(h,d);return F.length===0?[new rt(c)]:F}}}return[]},a=t.flatMap(c=>o(c));if(r=(n=r??((e=a[0])===null||e===void 0?void 0:e.schema))!==null&&n!==void 0?n:new U([]),!(r instanceof U))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const c of a){if(!(c instanceof rt))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!mn(r,c.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=r,this.batches=a,this._offsets=s??io(this.data)}get data(){return this.batches.map(({data:t})=>t)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((t,e)=>t+e.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=eo(this.data)),this._nullCount}isValid(t){return!1}get(t){return null}at(t){return this.get(Tn(t,this.numRows))}set(t,e){}indexOf(t,e){return-1}[Symbol.iterator](){return this.batches.length>0?Ln.visit(new L(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...t){const e=this.schema,n=this.data.concat(t.flatMap(({data:r})=>r));return new X(e,n.map(r=>new rt(e,r)))}slice(t,e){const n=this.schema;[t,e]=Zs({length:this.numRows},t,e);const r=no(this.data,this._offsets,t,e);return new X(n,r.map(s=>new rt(n,s)))}getChild(t){return this.getChildAt(this.schema.fields.findIndex(e=>e.name===t))}getChildAt(t){if(t>-1&&t<this.schema.fields.length){const e=this.data.map(n=>n.children[t]);if(e.length===0){const{type:n}=this.schema.fields[t],r=D({type:n,length:0,nullCount:0});e.push(r._changeLengthAndBackfillNullBitmap(this.numRows))}return new L(e)}return null}setChild(t,e){var n;return this.setChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(r=>r.name===t),e)}setChildAt(t,e){let n=this.schema,r=[...this.batches];if(t>-1&&t<this.numCols){e||(e=new L([D({type:new Ht,length:this.numRows})]));const s=n.fields.slice(),o=s[t].clone({type:e.type}),a=this.schema.fields.map((c,u)=>this.getChildAt(u));[s[t],a[t]]=[o,e],[n,r]=Xi(n,a)}return new X(n,r)}select(t){const e=this.schema.fields.reduce((n,r,s)=>n.set(r.name,s),new Map);return this.selectAt(t.map(n=>e.get(n)).filter(n=>n>-1))}selectAt(t){const e=this.schema.selectAt(t),n=this.batches.map(r=>r.selectAt(t));return new X(e,n)}assign(t){const e=this.schema.fields,[n,r]=t.schema.fields.reduce((a,c,u)=>{const[d,h]=a,F=e.findIndex(B=>B.name===c.name);return~F?h[F]=u:d.push(u),a},[[],[]]),s=this.schema.assign(t.schema),o=[...e.map((a,c)=>[c,r[c]]).map(([a,c])=>c===void 0?this.getChildAt(a):t.getChildAt(c)),...n.map(a=>t.getChildAt(a))].filter(Boolean);return new X(...Xi(s,o))}}fo=Symbol.toStringTag;X[fo]=(i=>(i.schema=null,i.batches=[],i._offsets=new Uint32Array([0]),i._nullCount=-1,i[Symbol.isConcatSpreadable]=!0,i.isValid=Li(Fn),i.get=Li(ot.getVisitFn(l.Struct)),i.set=ro(mt.getVisitFn(l.Struct)),i.indexOf=so(Ui.getVisitFn(l.Struct)),"Table"))(X.prototype);var po;let rt=class xe{constructor(...t){switch(t.length){case 2:{if([this.schema]=t,!(this.schema instanceof U))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=D({nullCount:0,type:new Z(this.schema.fields),children:this.schema.fields.map(e=>D({type:e.type,nullCount:0}))})]=t,!(this.data instanceof C))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=yr(this.schema,this.data.children);break}case 1:{const[e]=t,{fields:n,children:r,length:s}=Object.keys(e).reduce((c,u,d)=>(c.children[d]=e[u],c.length=Math.max(c.length,e[u].length),c.fields[d]=z.new({name:u,type:e[u].type,nullable:!0}),c),{length:0,fields:new Array,children:new Array}),o=new U(n),a=D({type:new Z(n),length:s,children:r,nullCount:0});[this.schema,this.data]=yr(o,a.children,s);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=yo(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(t){return this.data.getValid(t)}get(t){return ot.visit(this.data,t)}at(t){return this.get(Tn(t,this.numRows))}set(t,e){return mt.visit(this.data,t,e)}indexOf(t,e){return Ui.visit(this.data,t,e)}[Symbol.iterator](){return Ln.visit(new L([this.data]))}toArray(){return[...this]}concat(...t){return new X(this.schema,[this,...t])}slice(t,e){const[n]=new L([this.data]).slice(t,e).data;return new xe(this.schema,n)}getChild(t){var e;return this.getChildAt((e=this.schema.fields)===null||e===void 0?void 0:e.findIndex(n=>n.name===t))}getChildAt(t){return t>-1&&t<this.schema.fields.length?new L([this.data.children[t]]):null}setChild(t,e){var n;return this.setChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(r=>r.name===t),e)}setChildAt(t,e){let n=this.schema,r=this.data;if(t>-1&&t<this.numCols){e||(e=new L([D({type:new Ht,length:this.numRows})]));const s=n.fields.slice(),o=r.children.slice(),a=s[t].clone({type:e.type});[s[t],o[t]]=[a,e.data[0]],n=new U(s,new Map(this.schema.metadata)),r=D({type:new Z(s),children:o})}return new xe(n,r)}select(t){const e=this.schema.select(t),n=new Z(e.fields),r=[];for(const s of t){const o=this.schema.fields.findIndex(a=>a.name===s);~o&&(r[o]=this.data.children[o])}return new xe(e,D({type:n,length:this.numRows,children:r}))}selectAt(t){const e=this.schema.selectAt(t),n=t.map(s=>this.data.children[s]).filter(Boolean),r=D({type:new Z(e.fields),length:this.numRows,children:n});return new xe(e,r)}};po=Symbol.toStringTag;rt[po]=(i=>(i._nullCount=-1,i[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(rt.prototype);function yr(i,t,e=t.reduce((n,r)=>Math.max(n,r.length),0)){var n;const r=[...i.fields],s=[...t],o=(e+63&-64)>>3;for(const[a,c]of i.fields.entries()){const u=t[a];(!u||u.length!==e)&&(r[a]=c.clone({nullable:!0}),s[a]=(n=u==null?void 0:u._changeLengthAndBackfillNullBitmap(e))!==null&&n!==void 0?n:D({type:c.type,length:e,nullCount:e,nullBitmap:new Uint8Array(o)}))}return[i.assign(r),D({type:new Z(r),length:e,children:s})]}function yo(i,t,e=new Map){var n,r;if(((n=i==null?void 0:i.length)!==null&&n!==void 0?n:0)>0&&(i==null?void 0:i.length)===(t==null?void 0:t.length))for(let s=-1,o=i.length;++s<o;){const{type:a}=i[s],c=t[s];for(const u of[c,...((r=c==null?void 0:c.dictionary)===null||r===void 0?void 0:r.data)||[]])yo(a.children,u==null?void 0:u.children,e);if(f.isDictionary(a)){const{id:u}=a;if(!e.has(u))c!=null&&c.dictionary&&e.set(u,c.dictionary);else if(e.get(u)!==c.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return e}class Pn extends rt{constructor(t){const e=t.fields.map(r=>D({type:r.type})),n=D({type:new Z(t.fields),nullCount:0,children:e});super(t,n)}}let $t=class St{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMessage(t,e){return(e||new St).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,e){return t.setPosition(t.position()+M),(e||new St).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):q.V1}headerType(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):N.NONE}header(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__union(t,this.bb_pos+e):null}bodyLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,12);return n?(e||new G).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,q.V1)}static addHeaderType(t,e){t.addFieldInt8(1,e,N.NONE)}static addHeader(t,e){t.addFieldOffset(2,e,0)}static addBodyLength(t,e){t.addFieldInt64(3,e,BigInt("0"))}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endMessage(t){return t.endObject()}static finishMessageBuffer(t,e){t.finish(e)}static finishSizePrefixedMessageBuffer(t,e){t.finish(e,void 0,!0)}static createMessage(t,e,n,r,s,o){return St.startMessage(t),St.addVersion(t,e),St.addHeaderType(t,n),St.addHeader(t,r),St.addBodyLength(t,s),St.addCustomMetadata(t,o),St.endMessage(t)}};class Ec extends O{visit(t,e){return t==null||e==null?void 0:super.visit(t,e)}visitNull(t,e){return or.startNull(e),or.endNull(e)}visitInt(t,e){return ct.startInt(e),ct.addBitWidth(e,t.bitWidth),ct.addIsSigned(e,t.isSigned),ct.endInt(e)}visitFloat(t,e){return Bt.startFloatingPoint(e),Bt.addPrecision(e,t.precision),Bt.endFloatingPoint(e)}visitBinary(t,e){return er.startBinary(e),er.endBinary(e)}visitLargeBinary(t,e){return nr.startLargeBinary(e),nr.endLargeBinary(e)}visitBool(t,e){return ir.startBool(e),ir.endBool(e)}visitUtf8(t,e){return ar.startUtf8(e),ar.endUtf8(e)}visitLargeUtf8(t,e){return rr.startLargeUtf8(e),rr.endLargeUtf8(e)}visitDecimal(t,e){return ae.startDecimal(e),ae.addScale(e,t.scale),ae.addPrecision(e,t.precision),ae.addBitWidth(e,t.bitWidth),ae.endDecimal(e)}visitDate(t,e){return ei.startDate(e),ei.addUnit(e,t.unit),ei.endDate(e)}visitTime(t,e){return ft.startTime(e),ft.addUnit(e,t.unit),ft.addBitWidth(e,t.bitWidth),ft.endTime(e)}visitTimestamp(t,e){const n=t.timezone&&e.createString(t.timezone)||void 0;return pt.startTimestamp(e),pt.addUnit(e,t.unit),n!==void 0&&pt.addTimezone(e,n),pt.endTimestamp(e)}visitInterval(t,e){return At.startInterval(e),At.addUnit(e,t.unit),At.endInterval(e)}visitDuration(t,e){return ii.startDuration(e),ii.addUnit(e,t.unit),ii.endDuration(e)}visitList(t,e){return sr.startList(e),sr.endList(e)}visitStruct(t,e){return Xt.startStruct_(e),Xt.endStruct_(e)}visitUnion(t,e){nt.startTypeIdsVector(e,t.typeIds.length);const n=nt.createTypeIdsVector(e,t.typeIds);return nt.startUnion(e),nt.addMode(e,t.mode),nt.addTypeIds(e,n),nt.endUnion(e)}visitDictionary(t,e){const n=this.visit(t.indices,e);return xt.startDictionaryEncoding(e),xt.addId(e,BigInt(t.id)),xt.addIsOrdered(e,t.isOrdered),n!==void 0&&xt.addIndexType(e,n),xt.endDictionaryEncoding(e)}visitFixedSizeBinary(t,e){return ni.startFixedSizeBinary(e),ni.addByteWidth(e,t.byteWidth),ni.endFixedSizeBinary(e)}visitFixedSizeList(t,e){return ri.startFixedSizeList(e),ri.addListSize(e,t.listSize),ri.endFixedSizeList(e)}visitMap(t,e){return si.startMap(e),si.addKeysSorted(e,t.keysSorted),si.endMap(e)}}const Zi=new Ec;function Bc(i,t=new Map){return new U(Oc(i,t),ci(i.metadata),t)}function go(i){return new lt(i.count,mo(i.columns),_o(i.columns))}function Ac(i){return new Nt(go(i.data),i.id,i.isDelta)}function Oc(i,t){return(i.fields||[]).filter(Boolean).map(e=>z.fromJSON(e,t))}function gr(i,t){return(i.children||[]).filter(Boolean).map(e=>z.fromJSON(e,t))}function mo(i){return(i||[]).reduce((t,e)=>[...t,new Qt(e.count,Dc(e.VALIDITY)),...mo(e.children)],[])}function _o(i,t=[]){for(let e=-1,n=(i||[]).length;++e<n;){const r=i[e];r.VALIDITY&&t.push(new Dt(t.length,r.VALIDITY.length)),r.TYPE_ID&&t.push(new Dt(t.length,r.TYPE_ID.length)),r.OFFSET&&t.push(new Dt(t.length,r.OFFSET.length)),r.DATA&&t.push(new Dt(t.length,r.DATA.length)),t=_o(r.children,t)}return t}function Dc(i){return(i||[]).reduce((t,e)=>t+ +(e===0),0)}function Tc(i,t){let e,n,r,s,o,a;return!t||!(s=i.dictionary)?(o=_r(i,gr(i,t)),r=new z(i.name,o,i.nullable,ci(i.metadata))):t.has(e=s.id)?(n=(n=s.indexType)?mr(n):new $e,a=new Ee(t.get(e),n,e,s.isOrdered),r=new z(i.name,a,i.nullable,ci(i.metadata))):(n=(n=s.indexType)?mr(n):new $e,t.set(e,o=_r(i,gr(i,t))),a=new Ee(o,n,e,s.isOrdered),r=new z(i.name,a,i.nullable,ci(i.metadata))),r||null}function ci(i=[]){return new Map(i.map(({key:t,value:e})=>[t,e]))}function mr(i){return new ee(i.isSigned,i.bitWidth)}function _r(i,t){const e=i.type.name;switch(e){case"NONE":return new Ht;case"null":return new Ht;case"binary":return new yi;case"largebinary":return new gi;case"utf8":return new mi;case"largeutf8":return new _i;case"bool":return new bi;case"list":return new Ai((t||[])[0]);case"struct":return new Z(t||[]);case"struct_":return new Z(t||[])}switch(e){case"int":{const n=i.type;return new ee(n.isSigned,n.bitWidth)}case"floatingpoint":{const n=i.type;return new pi(J[n.precision])}case"decimal":{const n=i.type;return new wi(n.scale,n.precision,n.bitWidth)}case"date":{const n=i.type;return new Si(gt[n.unit])}case"time":{const n=i.type;return new Ii(_[n.unit],n.bitWidth)}case"timestamp":{const n=i.type;return new vi(_[n.unit],n.timezone)}case"interval":{const n=i.type;return new Ei(Rt[n.unit])}case"duration":{const n=i.type;return new Bi(_[n.unit])}case"union":{const n=i.type,[r,...s]=(n.mode+"").toLowerCase(),o=r.toUpperCase()+s.join("");return new Oi(K[o],n.typeIds||[],t||[])}case"fixedsizebinary":{const n=i.type;return new Di(n.byteWidth)}case"fixedsizelist":{const n=i.type;return new Ti(n.listSize,(t||[])[0])}case"map":{const n=i.type;return new Ri((t||[])[0],n.keysSorted)}}throw new Error(`Unrecognized type: "${e}"`)}var Rc=Lr,Nc=Ie;class tt{static fromJSON(t,e){const n=new tt(0,q.V5,e);return n._createHeader=Fc(t,e),n}static decode(t){t=new Nc(T(t));const e=$t.getRootAsMessage(t),n=e.bodyLength(),r=e.version(),s=e.headerType(),o=new tt(n,r,s);return o._createHeader=Lc(e,s),o}static encode(t){const e=new Rc;let n=-1;return t.isSchema()?n=U.encode(e,t.header()):t.isRecordBatch()?n=lt.encode(e,t.header()):t.isDictionaryBatch()&&(n=Nt.encode(e,t.header())),$t.startMessage(e),$t.addVersion(e,q.V5),$t.addHeader(e,n),$t.addHeaderType(e,t.headerType),$t.addBodyLength(e,BigInt(t.bodyLength)),$t.finishMessageBuffer(e,$t.endMessage(e)),e.asUint8Array()}static from(t,e=0){if(t instanceof U)return new tt(0,q.V5,N.Schema,t);if(t instanceof lt)return new tt(e,q.V5,N.RecordBatch,t);if(t instanceof Nt)return new tt(e,q.V5,N.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===N.Schema}isRecordBatch(){return this.headerType===N.RecordBatch}isDictionaryBatch(){return this.headerType===N.DictionaryBatch}constructor(t,e,n,r){this._version=e,this._headerType=n,this.body=new Uint8Array(0),r&&(this._createHeader=()=>r),this._bodyLength=P(t)}}class lt{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(t,e,n){this._nodes=e,this._buffers=n,this._length=P(t)}}class Nt{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(t,e,n=!1){this._data=t,this._isDelta=n,this._id=P(e)}}class Dt{constructor(t,e){this.offset=P(t),this.length=P(e)}}class Qt{constructor(t,e){this.length=P(t),this.nullCount=P(e)}}function Fc(i,t){return()=>{switch(t){case N.Schema:return U.fromJSON(i);case N.RecordBatch:return lt.fromJSON(i);case N.DictionaryBatch:return Nt.fromJSON(i)}throw new Error(`Unrecognized Message type: { name: ${N[t]}, type: ${t} }`)}}function Lc(i,t){return()=>{switch(t){case N.Schema:return U.decode(i.header(new It),new Map,i.version());case N.RecordBatch:return lt.decode(i.header(new Lt),i.version());case N.DictionaryBatch:return Nt.decode(i.header(new se),i.version())}throw new Error(`Unrecognized Message type: { name: ${N[t]}, type: ${t} }`)}}z.encode=Wc;z.decode=$c;z.fromJSON=Tc;U.encode=jc;U.decode=Uc;U.fromJSON=Bc;lt.encode=qc;lt.decode=Mc;lt.fromJSON=go;Nt.encode=Hc;Nt.decode=Cc;Nt.fromJSON=Ac;Qt.encode=Yc;Qt.decode=kc;Dt.encode=Gc;Dt.decode=xc;function Uc(i,t=new Map,e=q.V5){const n=zc(i,t);return new U(n,li(i),t,e)}function Mc(i,t=q.V5){if(i.compression()!==null)throw new Error("Record batch compression not implemented");return new lt(i.length(),Pc(i),Vc(i,t))}function Cc(i,t=q.V5){return new Nt(lt.decode(i.data(),t),i.id(),i.isDelta())}function xc(i){return new Dt(i.offset(),i.length())}function kc(i){return new Qt(i.length(),i.nullCount())}function Pc(i){const t=[];for(let e,n=-1,r=-1,s=i.nodesLength();++n<s;)(e=i.nodes(n))&&(t[++r]=Qt.decode(e));return t}function Vc(i,t){const e=[];for(let n,r=-1,s=-1,o=i.buffersLength();++r<o;)(n=i.buffers(r))&&(t<q.V4&&(n.bb_pos+=8*(r+1)),e[++s]=Dt.decode(n));return e}function zc(i,t){const e=[];for(let n,r=-1,s=-1,o=i.fieldsLength();++r<o;)(n=i.fields(r))&&(e[++s]=z.decode(n,t));return e}function br(i,t){const e=[];for(let n,r=-1,s=-1,o=i.childrenLength();++r<o;)(n=i.children(r))&&(e[++s]=z.decode(n,t));return e}function $c(i,t){let e,n,r,s,o,a;return!t||!(a=i.dictionary())?(r=Sr(i,br(i,t)),n=new z(i.name(),r,i.nullable(),li(i))):t.has(e=P(a.id()))?(s=(s=a.indexType())?wr(s):new $e,o=new Ee(t.get(e),s,e,a.isOrdered()),n=new z(i.name(),o,i.nullable(),li(i))):(s=(s=a.indexType())?wr(s):new $e,t.set(e,r=Sr(i,br(i,t))),o=new Ee(r,s,e,a.isOrdered()),n=new z(i.name(),o,i.nullable(),li(i))),n||null}function li(i){const t=new Map;if(i)for(let e,n,r=-1,s=Math.trunc(i.customMetadataLength());++r<s;)(e=i.customMetadata(r))&&(n=e.key())!=null&&t.set(n,e.value());return t}function wr(i){return new ee(i.isSigned(),i.bitWidth())}function Sr(i,t){const e=i.typeType();switch(e){case V.NONE:return new Ht;case V.Null:return new Ht;case V.Binary:return new yi;case V.LargeBinary:return new gi;case V.Utf8:return new mi;case V.LargeUtf8:return new _i;case V.Bool:return new bi;case V.List:return new Ai((t||[])[0]);case V.Struct_:return new Z(t||[])}switch(e){case V.Int:{const n=i.type(new ct);return new ee(n.isSigned(),n.bitWidth())}case V.FloatingPoint:{const n=i.type(new Bt);return new pi(n.precision())}case V.Decimal:{const n=i.type(new ae);return new wi(n.scale(),n.precision(),n.bitWidth())}case V.Date:{const n=i.type(new ei);return new Si(n.unit())}case V.Time:{const n=i.type(new ft);return new Ii(n.unit(),n.bitWidth())}case V.Timestamp:{const n=i.type(new pt);return new vi(n.unit(),n.timezone())}case V.Interval:{const n=i.type(new At);return new Ei(n.unit())}case V.Duration:{const n=i.type(new ii);return new Bi(n.unit())}case V.Union:{const n=i.type(new nt);return new Oi(n.mode(),n.typeIdsArray()||[],t||[])}case V.FixedSizeBinary:{const n=i.type(new ni);return new Di(n.byteWidth())}case V.FixedSizeList:{const n=i.type(new ri);return new Ti(n.listSize(),(t||[])[0])}case V.Map:{const n=i.type(new si);return new Ri((t||[])[0],n.keysSorted())}}throw new Error(`Unrecognized type: "${V[e]}" (${e})`)}function jc(i,t){const e=t.fields.map(s=>z.encode(i,s));It.startFieldsVector(i,e.length);const n=It.createFieldsVector(i,e),r=t.metadata&&t.metadata.size>0?It.createCustomMetadataVector(i,[...t.metadata].map(([s,o])=>{const a=i.createString(`${s}`),c=i.createString(`${o}`);return G.startKeyValue(i),G.addKey(i,a),G.addValue(i,c),G.endKeyValue(i)})):-1;return It.startSchema(i),It.addFields(i,n),It.addEndianness(i,Qc?ve.Little:ve.Big),r!==-1&&It.addCustomMetadata(i,r),It.endSchema(i)}function Wc(i,t){let e=-1,n=-1,r=-1;const s=t.type;let o=t.typeId;f.isDictionary(s)?(o=s.dictionary.typeId,r=Zi.visit(s,i),n=Zi.visit(s.dictionary,i)):n=Zi.visit(s,i);const a=(s.children||[]).map(d=>z.encode(i,d)),c=dt.createChildrenVector(i,a),u=t.metadata&&t.metadata.size>0?dt.createCustomMetadataVector(i,[...t.metadata].map(([d,h])=>{const F=i.createString(`${d}`),B=i.createString(`${h}`);return G.startKeyValue(i),G.addKey(i,F),G.addValue(i,B),G.endKeyValue(i)})):-1;return t.name&&(e=i.createString(t.name)),dt.startField(i),dt.addType(i,n),dt.addTypeType(i,o),dt.addChildren(i,c),dt.addNullable(i,!!t.nullable),e!==-1&&dt.addName(i,e),r!==-1&&dt.addDictionary(i,r),u!==-1&&dt.addCustomMetadata(i,u),dt.endField(i)}function qc(i,t){const e=t.nodes||[],n=t.buffers||[];Lt.startNodesVector(i,e.length);for(const o of e.slice().reverse())Qt.encode(i,o);const r=i.endVector();Lt.startBuffersVector(i,n.length);for(const o of n.slice().reverse())Dt.encode(i,o);const s=i.endVector();return Lt.startRecordBatch(i),Lt.addLength(i,BigInt(t.length)),Lt.addNodes(i,r),Lt.addBuffers(i,s),Lt.endRecordBatch(i)}function Hc(i,t){const e=lt.encode(i,t.data);return se.startDictionaryBatch(i),se.addId(i,BigInt(t.id)),se.addIsDelta(i,t.isDelta),se.addData(i,e),se.endDictionaryBatch(i)}function Yc(i,t){return Cr.createFieldNode(i,BigInt(t.length),BigInt(t.nullCount))}function Gc(i,t){return Mr.createBuffer(i,BigInt(t.offset),BigInt(t.length))}const Qc=(()=>{const i=new ArrayBuffer(2);return new DataView(i).setInt16(0,256,!0),new Int16Array(i)[0]===256})(),Vn=i=>`Expected ${N[i]} Message in stream, but was null or length 0.`,zn=i=>`Header pointer of flatbuffer-encoded ${N[i]} Message is null or length 0.`,bo=(i,t)=>`Expected to read ${i} metadata bytes, but only read ${t}.`,wo=(i,t)=>`Expected to read ${i} bytes for message body, but only read ${t}.`;class So{constructor(t){this.source=t instanceof Ci?t:new Ci(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done||t.value===-1&&(t=this.readMetadataLength()).done||(t=this.readMetadata(t.value)).done?j:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let e;if((e=this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(Vn(t));return e.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);const e=T(this.source.read(t));if(e.byteLength<t)throw new Error(wo(t,e.byteLength));return e.byteOffset%8===0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()}readSchema(t=!1){const e=N.Schema,n=this.readMessage(e),r=n==null?void 0:n.header();if(t&&!r)throw new Error(zn(e));return r}readMetadataLength(){const t=this.source.read(qi),e=t&&new Ie(t),n=(e==null?void 0:e.readInt32(0))||0;return{done:n===0,value:n}}readMetadata(t){const e=this.source.read(t);if(!e)return j;if(e.byteLength<t)throw new Error(bo(t,e.byteLength));return{done:!1,value:tt.decode(e)}}}class Jc{constructor(t,e){this.source=t instanceof Be?t:Or(t)?new xi(t,e):new Be(t)}[Symbol.asyncIterator](){return this}next(){return E(this,void 0,void 0,function*(){let t;return(t=yield this.readMetadataLength()).done||t.value===-1&&(t=yield this.readMetadataLength()).done||(t=yield this.readMetadata(t.value)).done?j:t})}throw(t){return E(this,void 0,void 0,function*(){return yield this.source.throw(t)})}return(t){return E(this,void 0,void 0,function*(){return yield this.source.return(t)})}readMessage(t){return E(this,void 0,void 0,function*(){let e;if((e=yield this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(Vn(t));return e.value})}readMessageBody(t){return E(this,void 0,void 0,function*(){if(t<=0)return new Uint8Array(0);const e=T(yield this.source.read(t));if(e.byteLength<t)throw new Error(wo(t,e.byteLength));return e.byteOffset%8===0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()})}readSchema(){return E(this,arguments,void 0,function*(t=!1){const e=N.Schema,n=yield this.readMessage(e),r=n==null?void 0:n.header();if(t&&!r)throw new Error(zn(e));return r})}readMetadataLength(){return E(this,void 0,void 0,function*(){const t=yield this.source.read(qi),e=t&&new Ie(t),n=(e==null?void 0:e.readInt32(0))||0;return{done:n===0,value:n}})}readMetadata(t){return E(this,void 0,void 0,function*(){const e=yield this.source.read(t);if(!e)return j;if(e.byteLength<t)throw new Error(bo(t,e.byteLength));return{done:!1,value:tt.decode(e)}})}}class Kc extends So{constructor(t){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof fr?t:new fr(t)}next(){const{_json:t}=this;if(!this._schema)return this._schema=!0,{done:!1,value:tt.fromJSON(t.schema,N.Schema)};if(this._dictionaryIndex<t.dictionaries.length){const e=t.dictionaries[this._dictionaryIndex++];return this._body=e.data.columns,{done:!1,value:tt.fromJSON(e,N.DictionaryBatch)}}if(this._batchIndex<t.batches.length){const e=t.batches[this._batchIndex++];return this._body=e.columns,{done:!1,value:tt.fromJSON(e,N.RecordBatch)}}return this._body=[],j}readMessageBody(t){return e(this._body);function e(n){return(n||[]).reduce((r,s)=>[...r,...s.VALIDITY&&[s.VALIDITY]||[],...s.TYPE_ID&&[s.TYPE_ID]||[],...s.OFFSET&&[s.OFFSET]||[],...s.DATA&&[s.DATA]||[],...e(s.children)],[])}}readMessage(t){let e;if((e=this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(Vn(t));return e.value}readSchema(){const t=N.Schema,e=this.readMessage(t),n=e==null?void 0:e.header();if(!e||!n)throw new Error(zn(t));return n}}const qi=4,_n="ARROW1",We=new Uint8Array(_n.length);for(let i=0;i<_n.length;i+=1)We[i]=_n.codePointAt(i);function $n(i,t=0){for(let e=-1,n=We.length;++e<n;)if(We[e]!==i[t+e])return!1;return!0}const Qe=We.length,Io=Qe+qi,Xc=Qe*2+qi;class yt extends Un{constructor(t){super(),this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){const e=this._impl.open(t);return te(e)?e.then(()=>this):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return ht.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return ht.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,e){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof yt?t:cn(t)?il(t):Or(t)?sl(t):te(t)?E(this,void 0,void 0,function*(){return yield yt.from(yield t)}):Dr(t)||vn(t)||Tr(t)||Oe(t)?rl(new Be(t)):nl(new Ci(t))}static readAll(t){return t instanceof yt?t.isSync()?Ir(t):vr(t):cn(t)||ArrayBuffer.isView(t)||qe(t)||Ar(t)?Ir(t):vr(t)}}class ki extends yt{constructor(t){super(t),this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return Ot(this,arguments,function*(){yield A(yield*ti(Zt(this[Symbol.iterator]())))})}}class Pi extends yt{constructor(t){super(t),this._impl=t}readAll(){return E(this,void 0,void 0,function*(){var t,e,n,r;const s=new Array;try{for(var o=!0,a=Zt(this),c;c=yield a.next(),t=c.done,!t;o=!0){r=c.value,o=!1;const u=r;s.push(u)}}catch(u){e={error:u}}finally{try{!o&&!t&&(n=a.return)&&(yield n.call(a))}finally{if(e)throw e.error}}return s})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class vo extends ki{constructor(t){super(t),this._impl=t}}class Zc extends Pi{constructor(t){super(t),this._impl=t}}class Eo{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,e){const n=this._loadVectors(t,e,this.schema.fields),r=D({type:new Z(this.schema.fields),length:t.length,children:n});return new rt(this.schema,r)}_loadDictionaryBatch(t,e){const{id:n,isDelta:r}=t,{dictionaries:s,schema:o}=this,a=s.get(n),c=o.dictionaries.get(n),u=this._loadVectors(t.data,e,[c]);return(a&&r?a.concat(new L(u)):new L(u)).memoize()}_loadVectors(t,e,n){return new ho(e,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}}class Vi extends Eo{constructor(t,e){super(e),this._reader=cn(t)?new Kc(this._handle=t):new So(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=Ao(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):j}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):j}next(){if(this.closed)return j;let t;const{_reader:e}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;const n=t.header(),r=e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,r)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;const n=t.header(),r=e.readMessageBody(t.bodyLength),s=this._loadDictionaryBatch(n,r);this.dictionaries.set(n.id,s)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Pn(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}}class zi extends Eo{constructor(t,e){super(e),this._reader=new Jc(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return E(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(t){return E(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=Ao(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(t){return E(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):j})}return(t){return E(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):j})}next(){return E(this,void 0,void 0,function*(){if(this.closed)return j;let t;const{_reader:e}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;const n=t.header(),r=yield e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,r)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;const n=t.header(),r=yield e.readMessageBody(t.bodyLength),s=this._loadDictionaryBatch(n,r);this.dictionaries.set(n.id,s)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Pn(this.schema)}):yield this.return()})}_readNextMessageAndValidate(t){return E(this,void 0,void 0,function*(){return yield this._reader.readMessage(t)})}}class Bo extends Vi{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,e){super(t instanceof pr?t:new pr(t),e)}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const e of this._footer.dictionaryBatches())e&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var e;if(this.closed)return null;this._footer||this.open();const n=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(t);if(n&&this._handle.seek(n.offset)){const r=this._reader.readMessage(N.RecordBatch);if(r!=null&&r.isRecordBatch()){const s=r.header(),o=this._reader.readMessageBody(r.bodyLength);return this._loadRecordBatch(s,o)}}return null}_readDictionaryBatch(t){var e;const n=(e=this._footer)===null||e===void 0?void 0:e.getDictionaryBatch(t);if(n&&this._handle.seek(n.offset)){const r=this._reader.readMessage(N.DictionaryBatch);if(r!=null&&r.isDictionaryBatch()){const s=r.header(),o=this._reader.readMessageBody(r.bodyLength),a=this._loadDictionaryBatch(s,o);this.dictionaries.set(s.id,a)}}}_readFooter(){const{_handle:t}=this,e=t.size-Io,n=t.readInt32(e),r=t.readAt(e-n,n);return je.decode(r)}_readNextMessageAndValidate(t){var e;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const n=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(this._recordBatchIndex);if(n&&this._handle.seek(n.offset))return this._reader.readMessage(t)}return null}}class tl extends zi{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,...e){const n=typeof e[0]!="number"?e.shift():void 0,r=e[0]instanceof Map?e.shift():void 0;super(t instanceof xi?t:new xi(t,n),r)}isFile(){return!0}isAsync(){return!0}open(t){const e=Object.create(null,{open:{get:()=>super.open}});return E(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const n of this._footer.dictionaryBatches())n&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield e.open.call(this,t)})}readRecordBatch(t){return E(this,void 0,void 0,function*(){var e;if(this.closed)return null;this._footer||(yield this.open());const n=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(t);if(n&&(yield this._handle.seek(n.offset))){const r=yield this._reader.readMessage(N.RecordBatch);if(r!=null&&r.isRecordBatch()){const s=r.header(),o=yield this._reader.readMessageBody(r.bodyLength);return this._loadRecordBatch(s,o)}}return null})}_readDictionaryBatch(t){return E(this,void 0,void 0,function*(){var e;const n=(e=this._footer)===null||e===void 0?void 0:e.getDictionaryBatch(t);if(n&&(yield this._handle.seek(n.offset))){const r=yield this._reader.readMessage(N.DictionaryBatch);if(r!=null&&r.isDictionaryBatch()){const s=r.header(),o=yield this._reader.readMessageBody(r.bodyLength),a=this._loadDictionaryBatch(s,o);this.dictionaries.set(s.id,a)}}})}_readFooter(){return E(this,void 0,void 0,function*(){const{_handle:t}=this;t._pending&&(yield t._pending);const e=t.size-Io,n=yield t.readInt32(e),r=yield t.readAt(e-n,n);return je.decode(r)})}_readNextMessageAndValidate(t){return E(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const e=this._footer.getRecordBatch(this._recordBatchIndex);if(e&&(yield this._handle.seek(e.offset)))return yield this._reader.readMessage(t)}return null})}}class el extends Vi{constructor(t,e){super(t,e)}_loadVectors(t,e,n){return new pc(e,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}}function Ao(i,t){return t&&typeof t.autoDestroy=="boolean"?t.autoDestroy:i.autoDestroy}function*Ir(i){const t=yt.from(i);try{if(!t.open({autoDestroy:!1}).closed)do yield t;while(!t.reset().open().closed)}finally{t.cancel()}}function vr(i){return Ot(this,arguments,function*(){const e=yield A(yt.from(i));try{if(!(yield A(e.open({autoDestroy:!1}))).closed)do yield yield A(e);while(!(yield A(e.reset().open())).closed)}finally{yield A(e.cancel())}})}function il(i){return new ki(new el(i))}function nl(i){const t=i.peek(Qe+7&-8);return t&&t.byteLength>=4?$n(t)?new vo(new Bo(i.read())):new ki(new Vi(i)):new ki(new Vi(function*(){}()))}function rl(i){return E(this,void 0,void 0,function*(){const t=yield i.peek(Qe+7&-8);return t&&t.byteLength>=4?$n(t)?new vo(new Bo(yield i.read())):new Pi(new zi(i)):new Pi(new zi(function(){return Ot(this,arguments,function*(){})}()))})}function sl(i){return E(this,void 0,void 0,function*(){const{size:t}=yield i.stat(),e=new xi(i,t);return t>=Xc&&$n(yield e.readAt(0,Qe+7&-8))?new Zc(new tl(e)):new Pi(new zi(e))})}class W extends O{static assemble(...t){const e=r=>r.flatMap(s=>Array.isArray(s)?e(s):s instanceof rt?s.data.children:s.data),n=new W;return n.visitMany(e(t)),n}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(t){if(t instanceof L)return this.visitMany(t.data),this;const{type:e}=t;if(!f.isDictionary(e)){const{length:n}=t;if(n>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(f.isUnion(e))this.nodes.push(new Qt(n,0));else{const{nullCount:r}=t;f.isNull(e)||bt.call(this,r<=0?new Uint8Array(0):Ni(t.offset,n,t.nullBitmap)),this.nodes.push(new Qt(n,r))}}return super.visit(t)}visitNull(t){return this}visitDictionary(t){return this.visit(t.clone(t.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function bt(i){const t=i.byteLength+7&-8;return this.buffers.push(i),this.bufferRegions.push(new Dt(this._byteLength,t)),this._byteLength+=t,this}function ol(i){var t;const{type:e,length:n,typeIds:r,valueOffsets:s}=i;if(bt.call(this,r),e.mode===K.Sparse)return bn.call(this,i);if(e.mode===K.Dense){if(i.offset<=0)return bt.call(this,s),bn.call(this,i);{const o=new Int32Array(n),a=Object.create(null),c=Object.create(null);for(let u,d,h=-1;++h<n;)(u=r[h])!==void 0&&((d=a[u])===void 0&&(d=a[u]=s[h]),o[h]=s[h]-d,c[u]=((t=c[u])!==null&&t!==void 0?t:0)+1);bt.call(this,o),this.visitMany(i.children.map((u,d)=>{const h=e.typeIds[d],F=a[h],B=c[h];return u.slice(F,Math.min(n,B))}))}}return this}function al(i){let t;return i.nullCount>=i.length?bt.call(this,new Uint8Array(0)):(t=i.values)instanceof Uint8Array?bt.call(this,Ni(i.offset,i.length,t)):bt.call(this,Fi(i.values))}function Vt(i){return bt.call(this,i.values.subarray(0,i.length*i.stride))}function Hi(i){const{length:t,values:e,valueOffsets:n}=i,r=P(n[0]),s=P(n[t]),o=Math.min(s-r,e.byteLength-r);return bt.call(this,Nr(-r,t+1,n)),bt.call(this,e.subarray(r,r+o)),this}function jn(i){const{length:t,valueOffsets:e}=i;if(e){const{[0]:n,[t]:r}=e;return bt.call(this,Nr(-n,t+1,e)),this.visit(i.children[0].slice(n,r-n))}return this.visit(i.children[0])}function bn(i){return this.visitMany(i.type.children.map((t,e)=>i.children[e]).filter(Boolean))[0]}W.prototype.visitBool=al;W.prototype.visitInt=Vt;W.prototype.visitFloat=Vt;W.prototype.visitUtf8=Hi;W.prototype.visitLargeUtf8=Hi;W.prototype.visitBinary=Hi;W.prototype.visitLargeBinary=Hi;W.prototype.visitFixedSizeBinary=Vt;W.prototype.visitDate=Vt;W.prototype.visitTimestamp=Vt;W.prototype.visitTime=Vt;W.prototype.visitDecimal=Vt;W.prototype.visitList=jn;W.prototype.visitStruct=bn;W.prototype.visitUnion=ol;W.prototype.visitInterval=Vt;W.prototype.visitDuration=Vt;W.prototype.visitFixedSizeList=jn;W.prototype.visitMap=jn;class Oo extends Un{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,e){throw new Error('"throughDOM" not available in this environment')}constructor(t){super(),this._position=0,this._started=!1,this._sink=new ai,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,st(t)||(t={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy=typeof t.autoDestroy=="boolean"?t.autoDestroy:!0,this._writeLegacyIpcFormat=typeof t.writeLegacyIpcFormat=="boolean"?t.writeLegacyIpcFormat:!1}toString(t=!1){return this._sink.toString(t)}toUint8Array(t=!1){return this._sink.toUint8Array(t)}writeAll(t){return te(t)?t.then(e=>this.writeAll(e)):Oe(t)?Yn(this,t):Hn(this,t)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(t){return this._sink.toDOMStream(t)}toNodeStream(t){return this._sink.toNodeStream(t)}close(){return this.reset()._sink.close()}abort(t){return this.reset()._sink.abort(t)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(t=this._sink,e=null){return t===this._sink||t instanceof ai?this._sink=t:(this._sink=new ai,t&&ko(t)?this.toDOMStream({type:"bytes"}).pipeTo(t):t&&Po(t)&&this.toNodeStream({objectMode:!1}).pipe(t)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,(!e||!mn(e,this._schema))&&(e==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=e,this._writeSchema(e))),this}write(t){let e=null;if(this._sink){if(t==null)return this.finish()&&void 0;if(t instanceof X&&!(e=t.schema))return this.finish()&&void 0;if(t instanceof rt&&!(e=t.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(e&&!mn(e,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,e)}t instanceof rt?t instanceof Pn||this._writeRecordBatch(t):t instanceof X?this.writeAll(t.batches):qe(t)&&this.writeAll(t)}_writeMessage(t,e=8){const n=e-1,r=tt.encode(t),s=r.byteLength,o=this._writeLegacyIpcFormat?4:8,a=s+o+n&~n,c=a-s-o;return t.headerType===N.RecordBatch?this._recordBatchBlocks.push(new Yt(a,t.bodyLength,this._position)):t.headerType===N.DictionaryBatch&&this._dictionaryBlocks.push(new Yt(a,t.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(a-o)),s>0&&this._write(r),this._writePadding(c)}_write(t){if(this._started){const e=T(t);e&&e.byteLength>0&&(this._sink.write(e),this._position+=e.byteLength)}return this}_writeSchema(t){return this._writeMessage(tt.from(t))}_writeFooter(t){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(We)}_writePadding(t){return t>0?this._write(new Uint8Array(t)):this}_writeRecordBatch(t){const{byteLength:e,nodes:n,bufferRegions:r,buffers:s}=W.assemble(t),o=new lt(t.numRows,n,r),a=tt.from(o,e);return this._writeDictionaries(t)._writeMessage(a)._writeBodyBuffers(s)}_writeDictionaryBatch(t,e,n=!1){const{byteLength:r,nodes:s,bufferRegions:o,buffers:a}=W.assemble(new L([t])),c=new lt(t.length,s,o),u=new Nt(c,e,n),d=tt.from(u,r);return this._writeMessage(d)._writeBodyBuffers(a)}_writeBodyBuffers(t){let e,n,r;for(let s=-1,o=t.length;++s<o;)(e=t[s])&&(n=e.byteLength)>0&&(this._write(e),(r=(n+7&-8)-n)>0&&this._writePadding(r));return this}_writeDictionaries(t){var e,n;for(const[r,s]of t.dictionaries){const o=(e=s==null?void 0:s.data)!==null&&e!==void 0?e:[],a=this._seenDictionaries.get(r),c=(n=this._dictionaryDeltaOffsets.get(r))!==null&&n!==void 0?n:0;if(!a||a.data[0]!==o[0])for(const[u,d]of o.entries())this._writeDictionaryBatch(d,r,u>0);else if(c<o.length)for(const u of o.slice(c))this._writeDictionaryBatch(u,r,!0);this._seenDictionaries.set(r,s),this._dictionaryDeltaOffsets.set(r,o.length)}return this}}class Wn extends Oo{static writeAll(t,e){const n=new Wn(e);return te(t)?t.then(r=>n.writeAll(r)):Oe(t)?Yn(n,t):Hn(n,t)}}class qn extends Oo{static writeAll(t){const e=new qn;return te(t)?t.then(n=>e.writeAll(n)):Oe(t)?Yn(e,t):Hn(e,t)}constructor(){super(),this._autoDestroy=!0}_writeSchema(t){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(t,e,n=!1){if(!n&&this._seenDictionaries.has(e))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(t,e,n)}_writeFooter(t){const e=je.encode(new je(t,q.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(t)._write(e)._write(Int32Array.of(e.byteLength))._writeMagic()}}function Hn(i,t){let e=t;t instanceof X&&(e=t.batches,i.reset(void 0,t.schema));for(const n of e)i.write(n);return i.finish()}function Yn(i,t){return E(this,void 0,void 0,function*(){var e,n,r,s,o,a,c;try{for(e=!0,n=Zt(t);r=yield n.next(),s=r.done,!s;e=!0){c=r.value,e=!1;const u=c;i.write(u)}}catch(u){o={error:u}}finally{try{!e&&!s&&(a=n.return)&&(yield a.call(n))}finally{if(o)throw o.error}}return i.finish()})}function cl(i,t="stream"){return(t==="stream"?Wn:qn).writeAll(i).toUint8Array(!0)}var ll=Object.create,Do=Object.defineProperty,ul=Object.getOwnPropertyDescriptor,dl=Object.getOwnPropertyNames,hl=Object.getPrototypeOf,fl=Object.prototype.hasOwnProperty,pl=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports),yl=(i,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of dl(t))!fl.call(i,r)&&r!==e&&Do(i,r,{get:()=>t[r],enumerable:!(n=ul(t,r))||n.enumerable});return i},gl=(i,t,e)=>(e=i!=null?ll(hl(i)):{},yl(!i||!i.__esModule?Do(e,"default",{value:i,enumerable:!0}):e,i)),ml=pl((i,t)=>{t.exports=Worker}),_l=(i=>(i[i.UNDEFINED=0]="UNDEFINED",i[i.AUTOMATIC=1]="AUTOMATIC",i[i.READ_ONLY=2]="READ_ONLY",i[i.READ_WRITE=3]="READ_WRITE",i))(_l||{}),bl=(i=>(i[i.IDENTIFIER=0]="IDENTIFIER",i[i.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",i[i.STRING_CONSTANT=2]="STRING_CONSTANT",i[i.OPERATOR=3]="OPERATOR",i[i.KEYWORD=4]="KEYWORD",i[i.COMMENT=5]="COMMENT",i))(bl||{}),wl=(i=>(i[i.NONE=0]="NONE",i[i.DEBUG=1]="DEBUG",i[i.INFO=2]="INFO",i[i.WARNING=3]="WARNING",i[i.ERROR=4]="ERROR",i))(wl||{}),Sl=(i=>(i[i.NONE=0]="NONE",i[i.CONNECT=1]="CONNECT",i[i.DISCONNECT=2]="DISCONNECT",i[i.OPEN=3]="OPEN",i[i.QUERY=4]="QUERY",i[i.INSTANTIATE=5]="INSTANTIATE",i))(Sl||{}),Il=(i=>(i[i.NONE=0]="NONE",i[i.OK=1]="OK",i[i.ERROR=2]="ERROR",i[i.START=3]="START",i[i.RUN=4]="RUN",i[i.CAPTURE=5]="CAPTURE",i))(Il||{}),vl=(i=>(i[i.NONE=0]="NONE",i[i.WEB_WORKER=1]="WEB_WORKER",i[i.NODE_WORKER=2]="NODE_WORKER",i[i.BINDINGS=3]="BINDINGS",i[i.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",i))(vl||{}),El=class{constructor(i=2){this.level=i}log(i){i.level>=this.level&&console.log(i)}},Bl=(i=>(i[i.SUCCESS=0]="SUCCESS",i))(Bl||{}),Al=class{constructor(i,t){this._bindings=i,this._conn=t}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(i){return i(this._bindings,this._conn)}async query(i){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:i});let t=await this._bindings.runQuery(this._conn,i),e=yt.from(t);return console.assert(e.isSync(),"Reader is not sync"),console.assert(e.isFile(),"Reader is not file"),new X(e)}async send(i){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:i});let t=await this._bindings.startPendingQuery(this._conn,i);for(;t==null;)t=await this._bindings.pollPendingQuery(this._conn);let e=new To(this._bindings,this._conn,t),n=await yt.from(e);return console.assert(n.isAsync()),console.assert(n.isStream()),n}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(i){return await this._bindings.getTableNames(this._conn,i)}async prepare(i){let t=await this._bindings.createPrepared(this._conn,i);return new Ol(this._bindings,this._conn,t)}async insertArrowTable(i,t){let e=cl(i,"stream");await this.insertArrowFromIPCStream(e,t)}async insertArrowFromIPCStream(i,t){await this._bindings.insertArrowFromIPCStream(this._conn,i,t)}async insertCSVFromPath(i,t){await this._bindings.insertCSVFromPath(this._conn,i,t)}async insertJSONFromPath(i,t){await this._bindings.insertJSONFromPath(this._conn,i,t)}},To=class{constructor(i,t,e){this.db=i,this.conn=t,this.header=e,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let i;return this._inFlight!=null?(i=await this._inFlight,this._inFlight=null):i=await this.db.fetchQueryResults(this.conn),this._depleted=i.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:i}}[Symbol.asyncIterator](){return this}},Ol=class{constructor(i,t,e){this.bindings=i,this.connectionId=t,this.statementId=e}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...i){let t=await this.bindings.runPrepared(this.connectionId,this.statementId,i),e=yt.from(t);return console.assert(e.isSync()),console.assert(e.isFile()),new X(e)}async send(...i){let t=await this.bindings.sendPrepared(this.connectionId,this.statementId,i),e=new To(this.bindings,this.connectionId,t),n=await yt.from(e);return console.assert(n.isAsync()),console.assert(n.isStream()),n}},Dl=(i=>(i.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",i.CLOSE_PREPARED="CLOSE_PREPARED",i.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",i.CONNECT="CONNECT",i.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",i.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",i.CREATE_PREPARED="CREATE_PREPARED",i.DISCONNECT="DISCONNECT",i.DROP_FILE="DROP_FILE",i.DROP_FILES="DROP_FILES",i.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",i.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",i.FLUSH_FILES="FLUSH_FILES",i.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",i.GET_TABLE_NAMES="GET_TABLE_NAMES",i.GET_VERSION="GET_VERSION",i.GLOB_FILE_INFOS="GLOB_FILE_INFOS",i.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",i.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",i.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",i.INSTANTIATE="INSTANTIATE",i.OPEN="OPEN",i.PING="PING",i.POLL_PENDING_QUERY="POLL_PENDING_QUERY",i.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",i.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",i.REGISTER_FILE_URL="REGISTER_FILE_URL",i.RESET="RESET",i.RUN_PREPARED="RUN_PREPARED",i.RUN_QUERY="RUN_QUERY",i.SEND_PREPARED="SEND_PREPARED",i.START_PENDING_QUERY="START_PENDING_QUERY",i.TOKENIZE="TOKENIZE",i))(Dl||{}),Tl=(i=>(i.CONNECTION_INFO="CONNECTION_INFO",i.ERROR="ERROR",i.FEATURE_FLAGS="FEATURE_FLAGS",i.FILE_BUFFER="FILE_BUFFER",i.FILE_INFOS="FILE_INFOS",i.FILE_SIZE="FILE_SIZE",i.FILE_STATISTICS="FILE_STATISTICS",i.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",i.LOG="LOG",i.OK="OK",i.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",i.QUERY_PLAN="QUERY_PLAN",i.QUERY_RESULT="QUERY_RESULT",i.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",i.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",i.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",i.REGISTERED_FILE="REGISTERED_FILE",i.SCRIPT_TOKENS="SCRIPT_TOKENS",i.SUCCESS="SUCCESS",i.TABLE_NAMES="TABLE_NAMES",i.VERSION_STRING="VERSION_STRING",i))(Tl||{}),R=class{constructor(i,t){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=i,this.data=t,this.promise=new Promise((e,n)=>{this.promiseResolver=e,this.promiseRejecter=n})}};function ui(i){switch(i.typeId){case l.Binary:return{sqlType:"binary"};case l.Bool:return{sqlType:"bool"};case l.Date:return{sqlType:"date"};case l.DateDay:return{sqlType:"date32[d]"};case l.DateMillisecond:return{sqlType:"date64[ms]"};case l.Decimal:{let t=i;return{sqlType:"decimal",precision:t.precision,scale:t.scale}}case l.Float:return{sqlType:"float"};case l.Float16:return{sqlType:"float16"};case l.Float32:return{sqlType:"float32"};case l.Float64:return{sqlType:"float64"};case l.Int:return{sqlType:"int32"};case l.Int16:return{sqlType:"int16"};case l.Int32:return{sqlType:"int32"};case l.Int64:return{sqlType:"int64"};case l.Uint16:return{sqlType:"uint16"};case l.Uint32:return{sqlType:"uint32"};case l.Uint64:return{sqlType:"uint64"};case l.Uint8:return{sqlType:"uint8"};case l.IntervalDayTime:return{sqlType:"interval[dt]"};case l.IntervalYearMonth:return{sqlType:"interval[m]"};case l.List:return{sqlType:"list",valueType:ui(i.valueType)};case l.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:i.byteWidth};case l.Null:return{sqlType:"null"};case l.Utf8:return{sqlType:"utf8"};case l.Struct:return{sqlType:"struct",fields:i.children.map(t=>wn(t.name,t.type))};case l.Map:{let t=i;return{sqlType:"map",keyType:ui(t.keyType),valueType:ui(t.valueType)}}case l.Time:return{sqlType:"time[s]"};case l.TimeMicrosecond:return{sqlType:"time[us]"};case l.TimeMillisecond:return{sqlType:"time[ms]"};case l.TimeNanosecond:return{sqlType:"time[ns]"};case l.TimeSecond:return{sqlType:"time[s]"};case l.Timestamp:return{sqlType:"timestamp",timezone:i.timezone||void 0};case l.TimestampSecond:return{sqlType:"timestamp[s]",timezone:i.timezone||void 0};case l.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:i.timezone||void 0};case l.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:i.timezone||void 0};case l.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:i.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(i.toString()))}function wn(i,t){let e=ui(t);return e.name=i,e}var Rl=new TextEncoder,Nl=class{constructor(i,t=null){this._onInstantiationProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=i,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),t!=null&&this.attach(t)}get logger(){return this._logger}attach(i){this._worker=i,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((t,e)=>{this._workerShutdownResolver=t})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(i,t=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!");return}let e=this._nextMessageId++;return this._pendingRequests.set(e,i),this._worker.postMessage({messageId:e,type:i.type,data:i.data},t),await i.promise}onMessage(i){var t;let e=i.data;switch(e.type){case"LOG":{this._logger.log(e.data);return}case"INSTANTIATE_PROGRESS":{for(let r of this._onInstantiationProgress)r(e.data);return}}let n=this._pendingRequests.get(e.requestId);if(!n){console.warn("unassociated response: [".concat(e.requestId,", ").concat(e.type.toString(),"]"));return}if(this._pendingRequests.delete(e.requestId),e.type=="ERROR"){let r=new Error(e.data.message);r.name=e.data.name,(t=Object.getOwnPropertyDescriptor(r,"stack"))!=null&&t.writable&&(r.stack=e.data.stack),n.promiseRejecter(r);return}switch(n.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(e.type=="OK"){n.promiseResolver(e.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],e.type=="OK"){n.promiseResolver(e.data);return}break;case"GLOB_FILE_INFOS":if(e.type=="FILE_INFOS"){n.promiseResolver(e.data);return}break;case"GET_VERSION":if(e.type=="VERSION_STRING"){n.promiseResolver(e.data);return}break;case"GET_FEATURE_FLAGS":if(e.type=="FEATURE_FLAGS"){n.promiseResolver(e.data);return}break;case"GET_TABLE_NAMES":if(e.type=="TABLE_NAMES"){n.promiseResolver(e.data);return}break;case"TOKENIZE":if(e.type=="SCRIPT_TOKENS"){n.promiseResolver(e.data);return}break;case"COPY_FILE_TO_BUFFER":if(e.type=="FILE_BUFFER"){n.promiseResolver(e.data);return}break;case"EXPORT_FILE_STATISTICS":if(e.type=="FILE_STATISTICS"){n.promiseResolver(e.data);return}break;case"CONNECT":if(e.type=="CONNECTION_INFO"){n.promiseResolver(e.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(e.type=="QUERY_RESULT"){n.promiseResolver(e.data);return}break;case"SEND_PREPARED":if(e.type=="QUERY_RESULT_HEADER"){n.promiseResolver(e.data);return}break;case"START_PENDING_QUERY":if(e.type=="QUERY_RESULT_HEADER_OR_NULL"){n.promiseResolver(e.data);return}break;case"POLL_PENDING_QUERY":if(e.type=="QUERY_RESULT_HEADER_OR_NULL"){n.promiseResolver(e.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],e.type=="SUCCESS"){n.promiseResolver(e.data);return}break;case"FETCH_QUERY_RESULTS":if(e.type=="QUERY_RESULT_CHUNK"){n.promiseResolver(e.data);return}break;case"CREATE_PREPARED":if(e.type=="PREPARED_STATEMENT_ID"){n.promiseResolver(e.data);return}break}n.promiseRejecter(new Error("unexpected response type: ".concat(e.type.toString())))}onError(i){console.error(i),console.error("error in duckdb worker: ".concat(i.message)),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"));return}this._pendingRequests.clear()}async reset(){let i=new R("RESET",null);return await this.postTask(i)}async ping(){let i=new R("PING",null);await this.postTask(i)}async dropFile(i){let t=new R("DROP_FILE",i);return await this.postTask(t)}async dropFiles(){let i=new R("DROP_FILES",null);return await this.postTask(i)}async flushFiles(){let i=new R("FLUSH_FILES",null);return await this.postTask(i)}async instantiate(i,t=null,e=n=>{}){this._onInstantiationProgress.push(e);let n=new R("INSTANTIATE",[i,t]);return await this.postTask(n)}async getVersion(){let i=new R("GET_VERSION",null);return await this.postTask(i)}async getFeatureFlags(){let i=new R("GET_FEATURE_FLAGS",null);return await this.postTask(i)}async open(i){let t=new R("OPEN",i);await this.postTask(t)}async tokenize(i){let t=new R("TOKENIZE",i);return await this.postTask(t)}async connectInternal(){let i=new R("CONNECT",null);return await this.postTask(i)}async connect(){let i=await this.connectInternal();return new Al(this,i)}async disconnect(i){let t=new R("DISCONNECT",i);await this.postTask(t)}async runQuery(i,t){let e=new R("RUN_QUERY",[i,t]);return await this.postTask(e)}async startPendingQuery(i,t){let e=new R("START_PENDING_QUERY",[i,t]);return await this.postTask(e)}async pollPendingQuery(i){let t=new R("POLL_PENDING_QUERY",i);return await this.postTask(t)}async cancelPendingQuery(i){let t=new R("CANCEL_PENDING_QUERY",i);return await this.postTask(t)}async fetchQueryResults(i){let t=new R("FETCH_QUERY_RESULTS",i);return await this.postTask(t)}async getTableNames(i,t){let e=new R("GET_TABLE_NAMES",[i,t]);return await this.postTask(e)}async createPrepared(i,t){let e=new R("CREATE_PREPARED",[i,t]);return await this.postTask(e)}async closePrepared(i,t){let e=new R("CLOSE_PREPARED",[i,t]);await this.postTask(e)}async runPrepared(i,t,e){let n=new R("RUN_PREPARED",[i,t,e]);return await this.postTask(n)}async sendPrepared(i,t,e){let n=new R("SEND_PREPARED",[i,t,e]);return await this.postTask(n)}async globFiles(i){let t=new R("GLOB_FILE_INFOS",i);return await this.postTask(t)}async registerFileText(i,t){let e=Rl.encode(t);await this.registerFileBuffer(i,e)}async registerFileURL(i,t,e,n){t===void 0&&(t=i);let r=new R("REGISTER_FILE_URL",[i,t,e,n]);await this.postTask(r)}async registerEmptyFileBuffer(i){}async registerFileBuffer(i,t){let e=new R("REGISTER_FILE_BUFFER",[i,t]);await this.postTask(e,[t.buffer])}async registerFileHandle(i,t,e,n){let r=new R("REGISTER_FILE_HANDLE",[i,t,e,n]);await this.postTask(r,[])}async collectFileStatistics(i,t){let e=new R("COLLECT_FILE_STATISTICS",[i,t]);await this.postTask(e,[])}async exportFileStatistics(i){let t=new R("EXPORT_FILE_STATISTICS",i);return await this.postTask(t,[])}async copyFileToBuffer(i){let t=new R("COPY_FILE_TO_BUFFER",i);return await this.postTask(t)}async copyFileToPath(i,t){let e=new R("COPY_FILE_TO_PATH",[i,t]);await this.postTask(e)}async insertArrowFromIPCStream(i,t,e){if(t.length==0)return;let n=new R("INSERT_ARROW_FROM_IPC_STREAM",[i,t,e]);await this.postTask(n,[t.buffer])}async insertCSVFromPath(i,t,e){if(e.columns!==void 0){let r=[];for(let s in e.columns){let o=e.columns[s];r.push(wn(s,o))}e.columnsFlat=r,delete e.columns}let n=new R("IMPORT_CSV_FROM_PATH",[i,t,e]);await this.postTask(n)}async insertJSONFromPath(i,t,e){if(e.columns!==void 0){let r=[];for(let s in e.columns){let o=e.columns[s];r.push(wn(s,o))}e.columnsFlat=r,delete e.columns}let n=new R("IMPORT_JSON_FROM_PATH",[i,t,e]);await this.postTask(n)}},Fl=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),Ll=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),Ul=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),Ml=()=>(async i=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(i)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),Gn={name:"@duckdb/duckdb-wasm",version:"1.29.0"},Cl=Gn.name,xl=Gn.version,Qn=Gn.version.split(".");Qn[0];Qn[1];Qn[2];var kl=()=>typeof navigator>"u";function Pl(){let i="https://cdn.jsdelivr.net/npm/".concat(Cl,"@").concat(xl,"/dist/");return{mvp:{mainModule:"".concat(i,"duckdb-mvp.wasm"),mainWorker:"".concat(i,"duckdb-browser-mvp.worker.js")},eh:{mainModule:"".concat(i,"duckdb-eh.wasm"),mainWorker:"".concat(i,"duckdb-browser-eh.worker.js")}}}var tn=null,en=null,nn=null,rn=null,sn=null;async function Vl(){return tn==null&&(tn=typeof BigInt64Array<"u"),en==null&&(en=await Ll()),nn==null&&(nn=await Ml()),rn==null&&(rn=await Ul()),sn==null&&(sn=await Fl()),{bigInt64Array:tn,crossOriginIsolated:kl()||globalThis.crossOriginIsolated||!1,wasmExceptions:en,wasmSIMD:rn,wasmThreads:nn,wasmBulkMemory:sn}}async function zl(i){let t=await Vl();if(t.wasmExceptions){if(t.wasmSIMD&&t.wasmThreads&&t.crossOriginIsolated&&i.coi)return{mainModule:i.coi.mainModule,mainWorker:i.coi.mainWorker,pthreadWorker:i.coi.pthreadWorker};if(i.eh)return{mainModule:i.eh.mainModule,mainWorker:i.eh.mainWorker,pthreadWorker:null}}return{mainModule:i.mvp.mainModule,mainWorker:i.mvp.mainWorker,pthreadWorker:null}}var $l=gl(ml());async function jl(i){let t=new Request(i),e=await fetch(t),n=URL.createObjectURL(await e.blob());return new $l.default(n)}function Wl(){let i=new TextDecoder;return t=>(typeof SharedArrayBuffer<"u"&&t.buffer instanceof SharedArrayBuffer&&(t=new Uint8Array(t)),i.decode(t))}Wl();var ql=(i=>(i[i.BUFFER=0]="BUFFER",i[i.NODE_FS=1]="NODE_FS",i[i.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",i[i.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",i[i.HTTP=4]="HTTP",i[i.S3=5]="S3",i))(ql||{});class Hl{constructor(t,e,n){$(this,"mainBundle",null);$(this,"db",null);$(this,"logger");$(this,"errorHandler");this.config=t,this.logger=e.createChildLogger("DuckDB"),this.errorHandler=n}async initialize(){try{if(this.logger.info("Initializing DuckDB..."),this.mainBundle||(this.logger.info("Loading DuckDB bundle..."),this.mainBundle=await zl(Pl()),this.logger.info("Bundle loaded successfully")),!this.db){this.logger.info("Creating DuckDB worker...");const t=await jl(this.mainBundle.mainWorker);this.db=new Nl(new El,t),await this.db.instantiate(this.mainBundle.mainModule,this.mainBundle.pthreadWorker),await this.db.open({query:this.config.queryConfig}),this.logger.info("DuckDB-WASM initialized successfully")}}catch(t){throw this.errorHandler.createError(Q.databaseInitialization("初期化に失敗しました",t))}}async createConnection(){if(!this.db)throw this.errorHandler.createError(Q.databaseInitialization("データベースが初期化されていません"));try{const t=await this.db.connect();return this.logger.info("DuckDB connection established"),t}catch(t){throw this.errorHandler.createError(Q.databaseInitialization("接続の作成に失敗しました",t))}}async testCapabilities(t){var e;try{this.logger.info("Testing DuckDB capabilities...");const r=(await t.query("SELECT version();")).toArray();this.logger.info("DuckDB version",(e=r[0])==null?void 0:e.toJSON());const o=(await t.query(`SELECT function_name FROM duckdb_functions() 
         WHERE function_name LIKE '%arrow%' OR function_name LIKE '%ipc%' OR function_name LIKE '%read%' 
         LIMIT 20;`)).toArray();this.logger.debug("Available functions",o.map(a=>a.toJSON()))}catch(n){this.logger.warn("DuckDB capabilities test failed",n.message)}}async registerFileBuffer(t,e){if(!this.db)throw this.errorHandler.createError(Q.databaseInitialization("データベースが初期化されていません"));try{await this.db.registerFileBuffer(t,e),this.logger.info(`File registered: ${t}`)}catch(n){throw this.errorHandler.createError(Q.dataRegistration(`ファイル登録に失敗しました: ${t}`,n))}}async executeQuery(t,e){try{this.logger.debug("Executing SQL",{sql:e.substring(0,200)+"..."});const r=(await t.query(e)).toArray().map(s=>s.toJSON());return this.logger.info(`Query executed successfully, ${r.length} rows returned`),r}catch(n){throw this.errorHandler.createError(Q.sqlExecution(n.message,n))}}async cleanup(){if(this.db)try{this.logger.info("DuckDB cleanup completed")}catch(t){this.logger.warn("Error during DuckDB cleanup",t.message)}}}class Yl{constructor(t,e,n,r){$(this,"logger");$(this,"errorHandler");this.config=t,this.duckDBManager=e,this.logger=n.createChildLogger("ArrowLoader"),this.errorHandler=r}async loadArrowData(t,e,n="ohlc_data"){this.logger.info("Starting Arrow data loading",{bufferSize:e.byteLength,tableName:n}),this.config.supportedMethods.length>0&&this.logArrowBufferInfo(e),await this.validateArrowBuffer(e);for(const r of this.config.supportedMethods)try{this.logger.info(`Trying method: ${r}`);const s=await this.tryLoadMethod(t,e,n,r);if(s.success)return this.logger.info(`Successfully loaded data using method: ${r}`),s}catch(s){this.logger.warn(`Method ${r} failed`,s.message);continue}throw this.errorHandler.createError(Q.dataRegistration("すべてのArrowデータ読み込み方法が失敗しました"))}logArrowBufferInfo(t){this.logger.debug("Arrow buffer info",{size:t.byteLength,firstBytes:Array.from(t.slice(0,100)).map(e=>e.toString(16).padStart(2,"0")).join(" ")})}async validateArrowBuffer(t){try{const n=(await import("./assets/worker-chunk-DUotd2L4.js")).tableFromIPC(t);this.logger.info("Arrow table validation",{schema:n.schema.fields.map(r=>({name:r.name,type:r.type.toString()})),numRows:n.numRows,numCols:n.numCols,sampleRow:n.numRows>0?n.get(0):null})}catch(e){this.logger.warn("Arrow buffer validation failed",e.message)}}async tryLoadMethod(t,e,n,r){switch(r){case"manual_table_creation":return await this.loadViaManualTableCreation(t,e,n);case"insertArrowFromIPCStream":return await this.loadViaInsertArrowFromIPCStream(t,e,n);case"file_registration_read_arrow":return await this.loadViaFileRegistration(t,e,n,"read_arrow");case"file_registration_arrow_scan":return await this.loadViaFileRegistration(t,e,n,"arrow_scan");case"file_registration_parquet":return await this.loadViaFileRegistration(t,e,n,"read_parquet");default:throw new Error(`Unknown load method: ${r}`)}}async loadViaManualTableCreation(t,e,n){const s=(await import("./assets/worker-chunk-DUotd2L4.js")).tableFromIPC(e),o=s.schema.fields,a=o.map(h=>{let F="VARCHAR";const B=h.type.toString().toLowerCase();return B.includes("int")||B.includes("bigint")?F="BIGINT":B.includes("float")||B.includes("double")?F="DOUBLE":(B.includes("date")||B.includes("timestamp"))&&(F="DATE"),`"${h.name}" ${F}`}).join(", "),c=`CREATE OR REPLACE TABLE ${n} (${a});`;await this.duckDBManager.executeQuery(t,c);const u=Math.min(s.numRows,this.config.maxTestRows),d=[];for(let h=0;h<u;h++){const F=s.get(h),B=o.map(H=>{const ut=F[H.name];return ut==null?"NULL":typeof ut=="string"?`'${ut.replace(/'/g,"''")}'`:String(ut)});d.push(`(${B.join(", ")})`)}if(d.length>0){const h=`INSERT INTO ${n} VALUES ${d.join(", ")}`;await this.duckDBManager.executeQuery(t,h)}return{success:!0,method:"manual_table_creation",rowCount:d.length}}async loadViaInsertArrowFromIPCStream(t,e,n){return await t.insertArrowFromIPCStream(e,{name:n,create:!0}),await this.duckDBManager.executeQuery(t,`SELECT COUNT(*) FROM ${n};`),{success:!0,method:"insertArrowFromIPCStream"}}async loadViaFileRegistration(t,e,n,r){const s="input_arrow.arrow";await this.duckDBManager.registerFileBuffer(s,e);const o=`CREATE OR REPLACE TABLE ${n} AS SELECT * FROM ${r}('${s}');`;return await this.duckDBManager.executeQuery(t,o),{success:!0,method:`file_registration_${r}`}}async verifyTable(t,e="ohlc_data"){var n,r;try{const s=await this.duckDBManager.executeQuery(t,"SHOW TABLES;");if(this.logger.debug("Available tables",s),!s.some(u=>u.name===e||u.table_name===e))if(s.length>0){const u=s[0],d=u.name||u.table_name;this.logger.info(`Creating view ${e} from ${d}`);const h=`CREATE OR REPLACE VIEW ${e} AS SELECT * FROM "${d}";`;await this.duckDBManager.executeQuery(t,h)}else return{exists:!1};const a=await this.duckDBManager.executeQuery(t,`SELECT COUNT(*) as count FROM ${e} LIMIT 1;`),c=await this.duckDBManager.executeQuery(t,`DESCRIBE ${e};`);return this.logger.info("Table verification completed",{tableName:e,rowCount:(n=a[0])==null?void 0:n.count,columns:c.length}),{exists:!0,rowCount:(r=a[0])==null?void 0:r.count,structure:c}}catch(s){throw this.logger.error("Table verification failed",s.message),this.errorHandler.createError(Q.dataRegistration(`テーブル ${e} の検証に失敗しました: ${s.message}`))}}}class ge extends Error{constructor(t,e){super(t),this.details=e,this.name="AstToSqlError"}}function Gl(i,t){const e=i.args.map(r=>typeof r=="number"?r.toString():typeof r=="object"&&r.value?r.value:"unknown").join("_"),n=`${i.name}_${e}`.replace(/\./g,"");switch(i.name){case"ma":if(i.args.length===1&&typeof i.args[0]=="number"){const a=i.args[0];return`${n} AS (
  SELECT base.date, AVG(base.close) OVER (ORDER BY base.date ROWS BETWEEN ${a-1} PRECEDING AND CURRENT ROW) AS value
  FROM ${t} base
)`}else if(i.args.length===2&&typeof i.args[0]=="number"&&typeof i.args[1]=="object"&&i.args[1].kind==="IDENT"){const a=i.args[0],c=i.args[1].value;return`${n} AS (
  SELECT base.date, AVG(base.${c}) OVER (ORDER BY base.date ROWS BETWEEN ${a-1} PRECEDING AND CURRENT ROW) AS value
  FROM ${t} base
)`}else throw new ge("Invalid MA arguments",i.args);case"rsi":if(i.args.length!==2||typeof i.args[0]!="number"||typeof i.args[1]!="object"||i.args[1].kind!=="IDENT")throw new ge("Invalid RSI arguments",i.args);const r=i.args[0],s=i.args[1].value;return`${n}_diffs AS (
  SELECT base.date, base.${s} - LAG(base.${s}) OVER (ORDER BY base.date) AS diff
  FROM ${t} base
),
${n} AS (
  SELECT 
    d.date, 
    100.0 - (100.0 / (1.0 + SUM(CASE WHEN d.diff > 0 THEN d.diff ELSE 0 END) OVER (ORDER BY d.date ROWS BETWEEN ${r-1} PRECEDING AND CURRENT ROW) / 
                           NULLIF(SUM(CASE WHEN d.diff < 0 THEN ABS(d.diff) ELSE 0 END) OVER (ORDER BY d.date ROWS BETWEEN ${r-1} PRECEDING AND CURRENT ROW), 0)))
    AS value
  FROM ${n}_diffs d
)`;case"atr":if(i.args.length!==1||typeof i.args[0]!="number")throw new ge("Invalid ATR arguments",i.args);const o=i.args[0];return`${n}_tr AS (
  SELECT 
    base.date, 
    GREATEST(
      base.high - base.low, 
      ABS(base.high - LAG(base.close) OVER (ORDER BY base.date)), 
      ABS(base.low - LAG(base.close) OVER (ORDER BY base.date))
    ) AS tr
  FROM ${t} base
),
${n} AS (
  SELECT tr.date, AVG(tr.tr) OVER (ORDER BY tr.date ROWS BETWEEN ${o-1} PRECEDING AND CURRENT ROW) AS value
  FROM ${n}_tr tr
)`;default:throw new ge(`Unsupported function: ${i.name}`)}}function me(i,t){switch(i.type){case"Logical":const e=me(i.left,t),n=me(i.right,t);return`(${e} ${i.op} ${n})`;case"Binary":const r=me(i.left,t),s=me(i.right,t);return`(${r} ${i.op} ${s})`;case"Func":const o=i.args.map(c=>typeof c=="number"?c:c.value).join("_"),a=`${i.name}_${o}`.replace(/\./g,"");return t.has(a)||t.set(a,i),`${a}.value`;case"Value":return i.kind==="NUMBER"?i.value.toString():`base.${i.value}`;default:throw new ge("Unknown AST node type")}}function Ql(i,t,e,n){const r=new Map,s=me(i.entry.ast,r),o=me(i.exit.ast,r),a=[];r.forEach(d=>{a.push(Gl(d,n))});let c="";return a.length>0&&(c=`WITH
${a.join(`,
`)},
`),`
${c}
${c?"":"WITH "}signals AS (
  SELECT 
    base.date,
    base.close,
    base.high,
    base.low,
    base.volume,
    ${s} as entry_signal,
    ${o} as exit_signal
  FROM ${n} base
  ${a.length>0?a.map((d,h)=>{const F=Array.from(r.keys())[h];return`LEFT JOIN ${F} ON base.date = ${F}.date`}).join(`
  `):""}
  ORDER BY base.date
),

-- Trade state management with position tracking
position_changes AS (
  SELECT 
    s.date,
    s.close,
    s.entry_signal,
    s.exit_signal,
    ROW_NUMBER() OVER (ORDER BY s.date) as row_num,
    CASE 
      WHEN s.entry_signal AND NOT COALESCE(LAG(s.entry_signal) OVER (ORDER BY s.date), false) THEN 'ENTER'
      WHEN s.exit_signal AND COALESCE(LAG(s.entry_signal) OVER (ORDER BY s.date), false) THEN 'EXIT'
      ELSE 'HOLD'
    END as action
  FROM signals s
),

-- Generate actual trades with entry/exit pairs
trade_pairs AS (
  SELECT 
    p1.date as entry_date,
    p1.close as entry_price,
    p2.date as exit_date,
    p2.close as exit_price,
    ROW_NUMBER() OVER (ORDER BY p1.date) as trade_id
  FROM position_changes p1
  JOIN position_changes p2 ON p2.row_num > p1.row_num
  WHERE p1.action = 'ENTER' 
    AND p2.action = 'EXIT'
    AND NOT EXISTS (
      SELECT 1 FROM position_changes p3 
      WHERE p3.row_num > p1.row_num 
        AND p3.row_num < p2.row_num 
        AND p3.action IN ('ENTER', 'EXIT')
    )
),

-- Calculate trade metrics
trade_details AS (
  SELECT 
    trade_id,
    entry_date,
    exit_date,
    entry_price,
    exit_price,
    (${t} / entry_price) as qty,
    ((exit_price - entry_price) / entry_price) as return_pct,
    (exit_price - entry_price) * (${t} / entry_price) * (1 - ${e}/10000.0) as pnl,
    DATEDIFF('day', entry_date, exit_date) as duration
  FROM trade_pairs
),

-- Build equity curve
equity_curve AS (
  SELECT 
    s.date,
    s.close,
    COALESCE(
      ${t} + SUM(td.pnl) OVER (ORDER BY s.date ROWS UNBOUNDED PRECEDING),
      ${t}
    ) as equity
  FROM signals s
  LEFT JOIN trade_details td ON s.date >= td.exit_date
),

-- Calculate portfolio metrics
portfolio_stats AS (
  SELECT 
    COUNT(*) as total_trades,
    AVG(return_pct) as avg_return,
    STDDEV(return_pct) as return_std,
    MAX(equity) as max_equity,
    MIN(equity) as min_equity,
    (MAX(equity) - ${t}) / ${t} as total_return
  FROM trade_details
  CROSS JOIN (SELECT MAX(equity) as max_equity, MIN(equity) as min_equity FROM equity_curve)
),

-- Calculate final metrics
final_metrics AS (
  SELECT 
    POWER(1 + total_return, 365.0 / (julianday(MAX(ec.date)) - julianday(MIN(ec.date)))) - 1 as cagr,
    (min_equity - max_equity) / max_equity as max_drawdown,
    CASE 
      WHEN return_std > 0 THEN avg_return / return_std * SQRT(252)
      ELSE 0 
    END as sharpe_ratio
  FROM portfolio_stats ps
  CROSS JOIN equity_curve ec
)

-- Return results in REQUIREMENTS.md format
SELECT 'metrics' as type, 
       COALESCE(fm.cagr, 0) as cagr, 
       COALESCE(fm.max_drawdown, 0) as maxDd, 
       COALESCE(fm.sharpe_ratio, 0) as sharpe,
       NULL as date, 
       NULL as equity,
       NULL as id, NULL as code, NULL as side, NULL as entryDate, NULL as exitDate, 
       NULL as qty, NULL as entryPx, NULL as exitPx, NULL as slippageBp, 
       NULL as pnl, NULL as pnlPct, NULL as duration
FROM final_metrics fm
UNION ALL
SELECT 'equity_point' as type, 
       NULL as cagr, NULL as maxDd, NULL as sharpe,
       ec.date, 
       ec.equity,
       NULL as id, NULL as code, NULL as side, NULL as entryDate, NULL as exitDate, 
       NULL as qty, NULL as entryPx, NULL as exitPx, NULL as slippageBp, 
       NULL as pnl, NULL as pnlPct, NULL as duration
FROM equity_curve ec
UNION ALL  
SELECT 'trade_log' as type, 
       NULL as cagr, NULL as maxDd, NULL as sharpe,
       NULL as date, NULL as equity,
       td.trade_id as id, 
       '${i.universe[0]}' as code, 
       'long' as side, 
       td.entry_date as entryDate, 
       td.exit_date as exitDate,
       ROUND(td.qty, 0) as qty, 
       ROUND(td.entry_price, 2) as entryPx, 
       ROUND(td.exit_price, 2) as exitPx, 
       ${e} as slippageBp,
       ROUND(td.pnl, 2) as pnl, 
       ROUND(td.return_pct * 100, 2) as pnlPct, 
       td.duration as duration
FROM trade_details td;
`}class Jl{constructor(t,e,n){$(this,"logger");$(this,"errorHandler");this.duckDBManager=t,this.logger=e.createChildLogger("BacktestProcessor"),this.errorHandler=n}async executeBacktest(t,e,n,r="ohlc_data"){try{this.logger.info("Starting backtest execution",{initCash:n.initCash,slippageBp:n.slippageBp,tableName:r});const s=this.convertAstToSql(e,n,r),o=await this.executeSqlQuery(t,s),a=this.processResults(o);return this.logger.info("Backtest execution completed successfully"),a}catch(s){throw s instanceof Ze?s:this.errorHandler.createError(Q.resultProcessing(s.message,s))}}convertAstToSql(t,e,n){try{this.logger.info("Converting AST to SQL",{entry:t.entry,exit:t.exit});const r=Ql(t,e.initCash,e.slippageBp,n);return this.logger.debug("Generated SQL query",{query:r.substring(0,500)+(r.length>500?"...":""),fullLength:r.length}),r}catch(r){throw r instanceof ge?this.errorHandler.createError(Q.astToSqlConversion(r.message,r.details?{details:r.details}:void 0)):this.errorHandler.createError(Q.astToSqlConversion(r.message))}}async executeSqlQuery(t,e){try{this.logger.info("Executing backtest SQL query");const n=await this.duckDBManager.executeQuery(t,e);return this.logger.info("SQL execution completed",{resultCount:n.length,sampleResults:n.slice(0,3)}),n}catch(n){throw this.errorHandler.createError(Q.sqlExecution(n.message,n))}}processResults(t){try{if(this.logger.info("Processing backtest results",{totalResults:t.length}),!t||t.length===0)throw new Error("SQL実行結果が空です");const e=t.find(a=>a.type==="metrics"),n=e?{cagr:e.cagr??null,maxDd:e.maxDd??null,sharpe:e.sharpe??null}:null,r=t.filter(a=>a.type==="equity_point").map(a=>({date:a.date,equity:a.equity})),s=t.filter(a=>a.type==="trade_log").map(a=>({date:a.date,side:a.side,price:a.price,quantity:a.quantity,pnl:a.pnl})),o=t.filter(a=>a.type==="warning").map(a=>a.message);return this.logger.info("Results processed successfully",{hasMetrics:!!n,equityCurvePoints:r.length,tradesCount:s.length,warningsCount:o.length}),{metrics:n,equityCurve:r,trades:s,warnings:o}}catch(e){throw this.errorHandler.createError(Q.resultProcessing(e.message,e))}}validateResults(t){const e=[];t.metrics&&(t.metrics.cagr!==null&&isNaN(t.metrics.cagr)&&e.push("CAGR値が無効です"),t.metrics.maxDd!==null&&isNaN(t.metrics.maxDd)&&e.push("MaxDD値が無効です"),t.metrics.sharpe!==null&&isNaN(t.metrics.sharpe)&&e.push("Sharpe Ratio値が無効です")),t.equityCurve.length===0&&e.push("エクイティカーブデータがありません");const n=t.trades.filter(r=>typeof r.price!="number"||isNaN(r.price));return n.length>0&&e.push(`${n.length}件の無効なトレードデータがあります`),e.length>0&&this.logger.warn("Result validation issues found",e),e}}class Kl{constructor(t,e){$(this,"currentStep",0);$(this,"steps",[{percentage:10,message:"バックテスト処理開始..."},{percentage:20,message:"DB初期化・データ登録完了"},{percentage:40,message:"SQL生成完了"},{percentage:50,message:"DuckDB SQL実行中..."},{percentage:70,message:"バックテストSQL実行完了"},{percentage:90,message:"結果データ処理完了"},{percentage:100,message:"バックテスト処理終了"}]);this.req_id=t,this.postMessage=e}reportStep(t,e){if(t>=0&&t<this.steps.length){this.currentStep=t;const n=this.steps[t];this.postMessage({type:"progress",req_id:this.req_id,progress:n.percentage,message:e||n.message})}}reportCustomProgress(t,e){this.postMessage({type:"progress",req_id:this.req_id,progress:t,message:e})}start(){this.reportStep(0)}dbInitialized(){this.reportStep(1)}sqlGenerated(){this.reportStep(2)}sqlExecuting(){this.reportStep(3)}sqlCompleted(){this.reportStep(4)}resultsProcessed(){this.reportStep(5)}completed(){this.reportStep(6)}getCurrentPercentage(){return this.currentStep<this.steps.length?this.steps[this.currentStep].percentage:0}}class Xl{constructor(){$(this,"logger");$(this,"errorHandler");$(this,"duckDBManager");$(this,"arrowDataLoader");$(this,"backtestProcessor");$(this,"config",Uo());this.logger=new Sn("BacktestWorker",Er.INFO),this.errorHandler=new Lo(this.logger),this.duckDBManager=new Hl(this.config.duckdb,this.logger,this.errorHandler),this.arrowDataLoader=new Yl(this.config.arrow,this.duckDBManager,this.logger,this.errorHandler),this.backtestProcessor=new Jl(this.duckDBManager,this.logger,this.errorHandler)}async processRequest(t){const{req_id:e,dsl_ast:n,arrow:r,params:s}=t,o=new Kl(e,c=>self.postMessage(c));let a=null;try{o.start(),this.validateInput(t),await this.duckDBManager.initialize(),a=await this.duckDBManager.createConnection(),await this.duckDBManager.testCapabilities(a),await this.arrowDataLoader.loadArrowData(a,r),await this.arrowDataLoader.verifyTable(a),o.dbInitialized(),o.sqlExecuting();const c=await this.backtestProcessor.executeBacktest(a,n,s);o.sqlCompleted();const u=this.backtestProcessor.validateResults({metrics:c.metrics,equityCurve:c.equityCurve,trades:c.trades}),d={req_id:e,metrics:c.metrics,equityCurve:c.equityCurve,trades:c.trades,warnings:[...c.warnings,...u]};o.resultsProcessed(),self.postMessage({type:"result",...d}),o.completed()}catch(c){this.logger.error("Request processing failed",c),this.errorHandler.postError(e,this.errorHandler.handleError(c,"REQUEST_PROCESSING"),u=>self.postMessage(u))}finally{if(a)try{await a.close()}catch(c){this.logger.warn("Error closing DB connection",c.message)}}}validateInput(t){if(!t.dsl_ast)throw this.errorHandler.createError(Q.missingInput("戦略定義(dsl_ast)"));if(!t.arrow)throw this.errorHandler.createError(Q.missingInput("Arrowデータ(arrow)"));if(!t.params)throw this.errorHandler.createError(Q.missingInput("パラメータ(params)"))}}const on=new Xl;self.onmessage=async i=>{var t;try{on.logger.info("Received message",{req_id:i.data.req_id,hasArrow:!!i.data.arrow,hasDslAst:!!i.data.dsl_ast}),await on.processRequest(i.data)}catch(e){on.logger.error("Unhandled error in onmessage",e),self.postMessage({type:"error",req_id:((t=i.data)==null?void 0:t.req_id)||"unknown",message:`E3001: Worker内で予期せぬエラーが発生しました - ${e.message}`})}};console.log("BacktestWorker (リファクタリング版) loaded successfully");export{Ie as B,M as S,Ot as _,A as a,ti as b,Zt as c,E as d,Lr as e,tu as f};

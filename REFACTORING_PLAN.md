# リファクタリング実行計画

## 現在の状況分析

### ✅ 完了済み

- DuckDB-WASM の基本導入
- JSON-AST-DSL から SQL へのコンパイラ実装
- バックテストリクエスト/レスポンス処理
- 基本的な UI 実装
- 一部の unit テスト実装

### ⚠️ 部分完了/改善が必要

- ESLint 設定（新規作成、エラー修正が必要）
- テストカバレッジ（目標 85%未達成）
- パフォーマンステスト（未実装）
- E2E テスト（基本的な実装はあるが不完全）

### ❌ 未実装

- Bundle Size テスト（完全実装）
- テスト生成戦略
- CI/CD パイプラインの最適化
- 高度な戦略サポート

## リファクタリング実行計画

### Phase 1: コード品質の改善 (優先度: 高)

1. **ESLint エラーの修正**

   - 未使用変数の削除
   - console.log の適切な処理
   - 型安全性の向上

2. **TypeScript エラーの完全解消**
   - ビルドエラーがないことの確認
   - 型定義の改善

### Phase 2: テスト実装の完全化 (優先度: 高)

1. **Bundle Size テストの実装**

   - gzip < 3.7 MB の確認
   - チャンクサイズの最適化

2. **パフォーマンステストの実装**

   - `runBacktest(single-ticker-20y) < 2s @ P95` の達成
   - メモリ使用量の最適化

3. **E2E テストの拡充**
   - UI 応答性テスト
   - プログレス表示テスト

### Phase 3: テスト生成戦略の実装 (優先度: 中)

1. **Spec-driven synthesis**

   - JSON Schema からテストケース生成
   - 有効/無効パターンの自動生成

2. **Example-based mutation**
   - fixtures からの変異テスト
   - 回帰テストの実装

### Phase 4: アーキテクチャ改善 (優先度: 中)

1. **DuckDB-WASM 最適化**

   - メモリ効率の改善
   - 並列処理対応

2. **高度な戦略サポート**
   - lag/shift 関数の実装
   - ストップ高戦略の改善

## 今回の実行範囲

**Phase 1 を中心に実行し、Phase 2 の一部まで進める**

1. ESLint エラーの修正
2. TypeScript エラーの解消
3. Bundle Size テストの完全実装
4. パフォーマンステストの基本実装
